# 功能清单 ↔ PRD 对照表

> 目的：将《茶心阁小程序需求文档》中的 **五、功能清单（5.1/5.2/5.3）** 与 `doc/prd.md` 中的章节一一映射，并标记当前 PRD 设计状态，方便后续审查与排期。
>
> 状态字段说明：
>
> - `已在 PRD 设计`：需求已在 `doc/prd.md` 中有明确产品/技术说明，可直接指导开发。
> - `需补充 PRD`：需求在 PRD 中尚未单独成节或仅隐含提及，建议补一小节或专门文档。
> - `实现时关注`：需求在 PRD 中已有方向性描述，但实现细节（字段/接口/交互）需在开发阶段进一步细化。

> 记号说明：`[]` 未开始，`[x]` 表示设计完成，`[✅]` 表示功能完成。

---

## 5.1 小程序前端

| 完成 | 模块 | 需求文档功能点 | PRD 对应路径 | 状态 | 备注 |
| --- | --- | --- | --- | --- | --- |
| [x] | 首页 | Balance 主图、轮播、跳转 | `doc/prd.md` → `3.1.1 首页（产品需求细化）` | 已在 PRD 设计 | 含轮播图管理、跳转类型、埋点等 |
| [x] | 首页 | 会员横幅（未登录提示、非会员展示开通） | `doc/prd.md` → `3.1.1 首页` → 会员/合伙人展示区 | 已在 PRD 设计 | 覆盖未登录/非会员/合伙人多状态 |
| [x] | 首页 | 金刚区：堂食、外卖、商城 | `doc/prd.md` → `3.1.1 首页` → 金刚区（Quick Actions） | 已在 PRD 设计 | 与门店/商城入口联动 |
| [x] | 首页-商城 | 商城主图、金刚区分区（礼品茶/健康茶/口粮茶/散装/投资收藏）、最近上新、热销、商品详情 | `doc/prd.md` → `3.1.1 首页` + `3.1.2 产品分类` + 商品详情部分 | 已在 PRD 设计 | 推荐/热销/本地特色等均有描述 |
| [x] | 首页-标签区 | 活动列表、活动详情、我的活动 | `doc/prd.md` → `3.1.1 首页`（活动入口）+ `3.2.6 营销管理`（活动管理） | 已在 PRD 设计 | 活动报名/支付由后台活动+订单打通 |
| [x] | 首页-标签区 | 邀请好友得现金奖励 | `doc/prd.md` → `3.1.4 我的`（分享）+ `3.4 分销系统` | 已在 PRD 设计 | 分享关系 + 佣金结算已定义 |
| [x] | 首页-标签区 | 优惠券入口 | `doc/prd.md` → `3.1.4 我的`（优惠券）+ `3.2.6 营销管理` | 已在 PRD 设计 | 发券/用券规则在营销管理中 |
| [x] | 商品展示区 | 广告、茶心阁简介、推荐商品、本地商品、技术支持&版权 | `doc/prd.md` → `3.1.1 首页`（广告位/运营位）+ `3.2.6 营销管理` + `3.2.8 系统设置`（内容/版权） | 已在 PRD 设计 | 品牌介绍与版权由系统设置内容管理 |
| [x] | 分类 | 商城商品分类 + 产地/包装/价格筛选 | `doc/prd.md` → `3.1.2 产品分类（商城产品）` | 已在 PRD 设计 | 覆盖分类树、筛选、排序、接口 |
| [✅] | 门店 | 实体门店展示、按距离排序、门店详情（证照/导航/拨号）、门店商品/外卖列表 | `doc/prd.md` → `3.1.3 门店（产品需求细化）` | 功能完成 | 包含定位、导航、拨号、门店商品映射 |
| [✅] | 门店入口 | 扫码进店（入口参数解析 + 首页/分类入参接管） | `doc/prd.md` → `5.1 用户下单流程` → 扫码进店（最小版） | 功能完成 | 在 `app.tsx` 解析 `store_id`（query/scene/H5 URL），`index`/`category` 入参接管并持久化 `current_store_id`，商品详情页亦持久化；后续可扩展更多入口与控件 |
| [✅] | 购物车 | 按商城/门店商品服务/门店外卖/积分商城 + 按门店分组 | `doc/prd.md` → `3.1.5 购物车（补充说明）` | 功能完成 | 明确分组与拆单约束、接口与验收 |
| [✅] | 我的-个人中心 | 头像、昵称、账户、消息、等级展示 | `doc/prd.md` → `3.1.4 我的（个人中心）` | 功能完成 | 结合 `users` 模型与 summary 接口 |
| [✅] | 我的-开通 VIP/合伙人 | 选择等级→展示权益→支付→生效 | `doc/prd.md` → `3.1.4 我的` + `4.3 合伙人升级流程` + 分销结算设计 | 功能完成 | 礼包订单、升级逻辑、升级奖励均已描述 |
| [✅] | 我的-订单 | 各状态订单列表与详情、售后入口 | `doc/prd.md` → `3.1.4 我的`（订单中心）+ `4.1 用户下单流程` | 功能完成 | 与后台订单管理共用模型 |
| [x] | 我的-钱包 | 余额、茶币、账单、提现、银行卡管理 | `doc/prd.md` → `3.1.4 我的`（钱包）+ 分销结算设计 | 已在 PRD 设计 | 提现规则/流水在分销结算章中 |
| [x] | 我的-积分 | 积分余额、积分记录、积分商品展示 | `doc/prd.md` → `3.1.4 我的`（积分中心）+ `3.2.6 营销管理`（积分规则） | 已在 PRD 设计 | |
| [✅] | 我的-优惠券 | 待使用/已使用/已过期 | `doc/prd.md` → `3.1.4 我的`（优惠券）+ `3.2.6.1 小程序优惠券接口约定` | 功能完成 | 已实现小程序「我的-优惠券」只读页面，按来源拆分平台券/门店券 Tab，调用 `GET /api/v1/user/coupons` 展示当前账户可用优惠券（后续下单用券与本单可用优惠券选择在 3.2.6.1 中规划） |
| [✅] | 我的-客服 | 客服电话、意见反馈、帮助文档 | `doc/prd.md` → `3.1.4 我的`（客服） | 功能完成 | 小程序「我的」页提供“联系客服 / 意见反馈 / 帮助文档”入口；意见反馈页支持选择类型并点击“提交”创建工单（`POST /api/v1/tickets`），订单详情亦支持投诉提交；后台侧在 `/api/v1/admin/tickets` 统一处理与跟进 |
| [x] | 我的-分享 | 分享海报（多张）、绑定推荐关系 | `doc/prd.md` → `3.1.4 我的`（分享）+ `3.4 分销系统` | 已在 PRD 设计 | 二维码/ID 绑定关系在分销设计中 |
| [x] | 我的-设置 | 账号管理、登录管理、地址管理、关于我们、隐私/协议 | `doc/prd.md` → `3.1.4 我的`（设置）+ `3.2.8 系统设置`（协议与内容） | 已在 PRD 设计 | |
| [x] | 我的-门店管理 | 门店管理员入口 | `doc/prd.md` → `3.1.4 我的`（门店管理入口）+ `3.3 门店后台` | 已在 PRD 设计 | 由门店权限接口控制可见性 |

---

## 5.2 后台管理系统（平台）

| 完成 | 模块 | 需求文档功能点 | PRD 对应路径 | 状态 | 备注 |
| --- | --- | --- | --- | --- | --- |
| [✅] | 首页 | 左侧菜单栏（商品/订单/门店/会员/合伙人/营销/财务/系统） | `doc/prd.md` → `3.2.0 后台首页与总览` | 功能完成 | 已声明与权限体系绑定 |
| [✅] | 首页 | 顶部导航栏（快捷导航/搜索/消息通知/账户中心） | `doc/prd.md` → `3.2.0 后台首页与总览` | 功能完成 | |
| [✅] | 首页 | 数据看板（时间维度、订单量/销售额/用户数、排行/分析） | `doc/prd.md` → `3.2.0 后台首页与总览` | 功能完成 | 含跳转到明细页链接 |
| [✅] | 首页 | 订单动态（代发货、预警订单、售后待处理） | `doc/prd.md` → `3.2.0 后台首页與总览`（订单动态与待办） | 功能完成 | |
| [✅] | 首页 | 提现管理（提现待处理）、意见反馈待处理 | `doc/prd.md` → `3.2.0 后台首页与总览`（待办）+ `3.2.7 财务管理` | 功能完成 | 提现/反馈模块细节在后续模块中 |
| [✅] | 商品管理 | 全部商品（筛选、新增、上下架、删除、编辑、列表字段） | `doc/prd.md` → `3.2.1 后台商品管理` | 功能完成 | 包含商品字段、SKU、OSS 上传 |
| [✅] | 订单管理 | 订单列表/查找/发货/售后/调价 | `doc/prd.md` → `3.2.2 订单管理（平台端）` | 功能完成 | Admin-FE 订单操作区支持发货/取消/退款流转，并新增“调价”入口（未支付订单可修改支付金额，`POST /api/v1/orders/{id}/adjust`） |
| [✅] | 门店管理 | 门店列表/查看/新增/编辑/下架/冻结 | `doc/prd.md` → `3.2.3 门店管理` | 功能完成 | |
| [✅] | 用户管理 | 全部用户列表与筛选 | `doc/prd.md` → `3.2.4 会员管理`（列表/筛选） | 功能完成 | |
| [x] | 用户管理 | 合伙人管理 | `doc/prd.md` → `3.2.5 合伙人管理（分销/合伙人）` | 已在 PRD 设计 | |
| [✅] | 用户管理 | 黑名单（禁止部分权限） | `doc/prd.md` → `3.2.4 会员管理` → 黑名单/白名单管理 | 功能完成 | Admin-FE「用户管理」列表新增“拉黑/移出黑”操作与状态展示；后端新增 `POST /api/v1/admin/users/{id}/blacklist` 并通过 AuthMiddleware/AuthJWT 对黑名单用户拦截（禁止登录/访问鉴权接口）；变更请求体由 OperationLogMiddleware 记录审计 |
| [✅] | 用户管理 | 白名单（全部权限可用） | `doc/prd.md` → `3.2.4 会员管理` → 黑名单/白名单管理 | 功能完成 | Admin-FE「用户管理」列表新增“加白/移出白”操作与状态展示；后端新增 `POST /api/v1/admin/users/{id}/whitelist`（启用白名单会自动清除黑名单）；白名单可豁免黑名单/停用拦截；变更请求体由 OperationLogMiddleware 记录审计 |
| [✅] | 营销管理 | 广告管理（列表、编辑、上下架、新增、查找） | `doc/prd.md` → `3.2.6 营销管理`（轮播图与广告位管理） | 功能完成 | Admin-FE 新增「广告管理」页面（/banners），支持关键字查找、列表、新增/编辑、上架/下架、删除；后端新增 `GET/POST/PUT/DELETE /api/v1/admin/banners` 并接入权限 `marketing:banner:view/manage` 与 OperationLogMiddleware 审计 |
| [✅] | 营销管理 | 优惠券（列表/管理/新增/发布/结束） | `doc/prd.md` → `3.2.6 营销管理`（优惠券管理） | 功能完成 | |
| [✅] | 营销管理 | 活动管理（列表/查找/编辑/发布/报名管理/新增活动） | `doc/prd.md` → `3.2.6 营销管理`（活动管理） | 功能完成 | 与首页活动入口联动 |
| [✅] | 营销管理 | 充值管理（列表、查询、查看、冻结、充钱、扣钱） | `doc/prd.md` → `3.2.6 营销管理` → 充值管理与配置 | 功能完成 | Admin-FE 新增「充值管理」页面（/recharge）：输入用户ID后可查看余额/冻结与最近流水，并提供“冻结/解冻/充钱/扣钱”动作（提交即调用 API）；后端新增 `GET /api/v1/admin/recharge/records`、`GET /api/v1/admin/recharge/users/{id}/wallet`、`POST /api/v1/admin/recharge/users/{id}/freeze|unfreeze|credit|debit`，并接入权限 `marketing:recharge:view/manage`；所有变更接口均通过 OperationLogMiddleware 审计 |
| [✅] | 营销管理 | 充值配置（档位、赠送茶币/优惠券/产品服务） | `doc/prd.md` → `3.2.6 营销管理` → 充值管理与配置 | 功能完成 | Admin-FE「充值管理」页内提供“充值配置”Tab：可开关 `recharge.enabled`、维护 `recharge.packages` 档位（充值金额/赠送茶币/赠送券模板ID）；后端新增 `GET/PUT /api/v1/admin/recharge/configs`（SystemConfig 存储，仅允许写入 `recharge.*`），并接入权限 `marketing:recharge:view/manage` + OperationLogMiddleware |
| [✅] | 订单管理 & 门店管理 | 门店与订单联动链路（门店订单列表 → 订单操作区） | `docs/features/store-order-link.md` | 功能完成 | 已在 tea-api 与 Admin-FE 中落地，支持从门店订单列表一键带入全局订单操作区 |
| [✅] | 门店管理 & 财务管理 | 门店列表 → 钱包/提现（门店钱包/提现申请/记录） | `doc/prd.md` → `3.2.3 门店管理` + `3.3.4 财务管理` | 功能完成 | 已在 tea-api 与 Admin-FE 中实现，支持从门店列表进入门店钱包查看余额/提现记录并发起提现申请 |
| [✅] | 客服管理 | 客服记录、客服服务（方式、用户、问题类型、处理结果） | `doc/prd.md` → `3.2.9 客服与投诉管理（平台端）` | 功能完成 | 已在 tea-api 中实现 Ticket 工单模型与 `/api/v1/admin/tickets` 接口，Admin-FE 新增「客服工单」页面支持按类型/来源/状态/优先级筛选和处理工单，并通过 `GET /api/v1/admin/dashboard/todos` + Dashboard 待办卡片展示待处理工单数 |
| [✅] | 投诉建议 | 投诉建议管理 | `doc/prd.md` → `3.2.9 客服与投诉管理（平台端）` | 功能完成 | 投诉建议归一为 Ticket 中的 `complaint` 类型工单，支持从小程序订单详情页投诉入口（`type=order, source=miniapp_order`）生成工单，并在「客服工单」列表中统一查看与处理，计入首页待办中的「待处理工单数」统计 |
| [✅] | 财务管理 | 财务记录（筛选、收支记录） | `doc/prd.md` → `3.2.7 财务管理`（平台资金流水） | 功能完成 | 已在 tea-api 中提供 `/api/v1/admin/payments` 与 `/api/v1/admin/refunds` 接口，并在 Admin-FE 中实现「财务记录」页面（FinanceRecords），支持多条件筛选收款/退款流水及导出 CSV；支付方式与状态在前端已用中文标签展示，便于运营/财务使用 |
| [✅] | 财务管理 | 提现管理（审核、付款） | `doc/prd.md` → `3.2.7 财务管理` + 分销结算设计 | 功能完成 | 已在 tea-api 中实现提现申请/审核/完成全链路，并接入分销佣金冻结→解冻→提现登记逻辑；Admin-FE 已支持门店钱包提现与后台审核/打款及佣金一键回滚入口 |
| [✅] | 系统管理 | 会员配置 | `doc/prd.md` → `3.2.4 会员管理`（会员等级/权益配置） | 功能完成 | |
| [✅] | 系统管理 | 合伙人配置 | `doc/prd.md` → `3.2.5 合伙人管理`（等级与佣金配置） | 功能完成 | |
| [✅] | 系统管理 | 权限管理/管理员管理 | `doc/prd.md` → `3.2.8 系统设置`（权限管理） | 功能完成 | |
| [✅] | 系统管理 | 基本管理（logo、电话、版权） | `doc/prd.md` → `3.2.8 系统设置` → 基础配置管理 | 功能完成 | Admin-FE 新增「系统设置」页（基础配置 Tab）支持保存；后端新增 `GET/PUT /api/v1/admin/system/configs`（SystemConfig 存储），权限 `system:config:view/manage` |
| [x] | 系统管理 | 快递模板（模板管理/设置） | `doc/prd.md` → `3.2.8 系统设置` → 基础配置管理（快递模板） | 已在 PRD 设计 | |
| [✅] | 系统管理 | 内容管理（关于我们、帮助、协议） | `doc/prd.md` → `3.2.8 系统设置` → 内容管理 | 功能完成 | Admin-FE「系统设置」页（内容管理 Tab）支持编辑并保存 about/help/privacy/terms；后端同 `GET/PUT /api/v1/admin/system/configs` |
| [✅] | 系统管理 | 日志（操作日志） | `doc/prd.md` → `3.2.8 系统设置`（日志与审计） | 功能完成 | Admin-FE 新增「日志」页面（操作日志/访问日志 Tab），支持查询与导出；后端已提供 `/api/v1/admin/logs/operations` + `/api/v1/admin/logs/access`（含 export） |

---

## 5.3 门店后台（网页）

| 完成 | 模块 | 需求文档功能点 | PRD 对应路径 | 状态 | 备注 |
| --- | --- | --- | --- | --- | --- |
| [x] | 首页 | 左侧菜单栏（订单/商品/门店设置/财务/会员/系统） | `doc/prd.md` → `3.3.7 门店首页与经营参谋` | 已在 PRD 设计 | 菜单与门店角色权限绑定 |
| [x] | 首页 | 顶部导航栏（快捷导航/搜索/消息/账户中心） | `doc/prd.md` → `3.3.7 门店首页与经营参谋` | 已在 PRD 设计 | |
| [x] | 首页 | 经营参谋（多时间维度，订单/销售额等） | `doc/prd.md` → `3.3.7 门店首页与经营参谋` → 经营参谋 | 已在 PRD 设计 | 与门店订单/财务数据联动 |
| [x] | 首页 | 工作台（待处理订单、收银流程） | `doc/prd.md` → `3.3.7 门店首页与经营参谋` → 工作台 | 已在 PRD 设计 | 收银作为线下订单写入统一订单/财务模型 |
| [x] | 商家商城 | 商品分类、查找、购物车 | `doc/prd.md` → `3.3.6 商家商城（门店特供）` + `3.1.5 购物车` | 已在 PRD 设计 | 商家商城实质为门店特供商品 + 通用购物车 |
| [✅] | 商品管理 | 全部商品列表 | `doc/prd.md` → `3.3.2 商品管理` | 功能完成 | 已在 Admin-FE 提供「门店商品管理」页面（StoreProducts），支持按门店查看商品列表、按商品类型筛选、绑定/编辑门店库存与价格覆盖、解绑门店商品；后端已提供 `/api/v1/admin/stores/{id}/products`（GET/POST/DELETE）接口闭环 |
| [x] | 商品管理 | 商品管理（分类/上架中/已下架/草稿/新增） | `doc/prd.md` → `3.3.2 商品管理` | 已在 PRD 设计 | 可在实现时细化过滤条件 |
| [✅] | 商品管理 | 商品分类（服务商品/外卖商品/其他） | `doc/prd.md` → `3.3.2 商品管理` + `docs/prd-open-points.md` → 2.1 | 功能完成 | 已在 tea-api 中为 `store_products` 增加 `biz_type`（1服务/2外卖/3其他）并提供按类型筛选的门店库存接口，Admin-FE 中新增门店商品管理页（按商品类型展示与编辑） |
| [x] | 订单管理 | 订单列表/查找/接单/发货 | `doc/prd.md` → `3.3.1 订单管理` | 已在 PRD 设计 | |
| [x] | 订单管理 | 售后订单（退款/换货） | `doc/prd.md` → `3.3.1 订单管理`（售后处理） | 已在 PRD 设计 | |
| [✅] | 营销管理 | 活动管理（列表/查找/发布/编辑/报名） | 平台：`3.2.6 营销管理`；门店侧仅简要提及 | 功能完成 | 已在 tea-api 与 Admin-FE 中实现门店维度活动列表与创建/编辑（StoreActivities 页），后续如需报名/审核/退费流可在 PRD 中迭代 |
| [✅] | 营销管理 | 优惠券（列表/查找/新增/编辑/发布/查看） | `doc/prd.md` → `3.3.5 会员管理（门店维度）`（门店发券）+ `3.3.8.1 门店优惠券（已实现 — 最小闭环）` + `3.2.6 营销管理` | 功能完成 | 已在 tea-api 与 Admin-FE 中实现门店维度优惠券列表/创建/编辑/复制新建/一键禁用（StoreCoupons 页 + `/api/v1/stores/{id}/coupons`），门店可在本店维度自助配置与管理优惠券；更复杂人群/渠道/审核流由平台营销模块逐步扩展 |
| [✅] | 财务管理 | 财务记录（收支记录） | `doc/prd.md` → `3.3.4 财务管理`（账单查询） | 功能完成 | 已在 tea-api 中聚合门店维度收款/退款/提现流水，并在小程序 wx-fe 中新增「门店财务流水」页面（store-finance），支持按门店查看收支记录、按类型与时间范围筛选；后续若引入门店 Web 后台可直接复用该接口体系 |
| [✅] | 财务管理 | 账户管理（添加/编辑/删除） | `doc/prd.md` → `3.3.4 财务管理`（收款账户设置） | 功能完成 | |
| [✅] | 财务管理 | 财务提现（提现申请） | `doc/prd.md` → `3.3.4 财务管理` + `3.2.7 财务管理`（门店结算） | 功能完成 | 已在 tea-api 与 Admin-FE 中提供门店钱包/提现自助界面（StoreFinance 页），支持门店按自身门店维度查看余额并发起提现 |
| [x] | 系统设置 | 管理员（权限组/管理员列表/编辑） | `doc/prd.md` → `3.3.3 门店设置`（店员管理）+ `3.2.8 系统设置`（权限管理） | 已在 PRD 设计 | 门店管理员视作门店级角色 |
| [x] | 系统设置 | 门店信息（名称/门头图/地址/营业时间/联系电话/环境图/证照） | `doc/prd.md` → `3.3.3 门店设置`（基本信息管理） | 已在 PRD 设计 | |

---

## 总结：需补充 PRD 的关键点

1. **平台后台 - 客服管理 / 投诉建议**  
   - 需求来源：功能清单 5.2 中「客服管理」「投诉建议」。  
   - 现状：用户端入口（客服电话/意见反馈/帮助）已在 `3.1.4` 描述，但后台侧尚未有独立小节说明客服记录与投诉工单的管理。  
   - 建议：新增 `3.2.9 客服与投诉管理` 小节，抽象为一个轻量的工单系统（工单状态、分派、处理记录、回访等），并与消息/通知系统集成。  
   - 状态：**需补充 PRD**。

2. **门店后台 - 营销管理（活动管理增强 & 报名列表）** ✅
   - 需求来源：功能清单 5.3 中「营销管理-活动管理/优惠券」，以及「门店活动 → 报名列表」。  
   - 现状：已在 tea-api 中为 Activity 增加门店维度字段，并提供门店活动列表/创建/编辑接口（`/api/v1/stores/{id}/activities`）；同时实现 ActivityRegistration 报名模型、与订单/支付联动的报名状态（已报名/已支付/已退款），并在 Admin-FE「门店活动」页面（StoreActivities）中提供报名列表 Drawer（含状态筛选、退款标记、CSV 导出、订单 ID/订单状态展示）。  
   - 建议：后续如需更复杂的报名审核流、批量退款规则及多维度统计报表，可在平台活动引擎中扩展，并为门店裁剪可配置字段子集。  
   - 状态：**已实现（2025-12，门店活动报名收费闭环 & 报名列表）**。

3. **门店营销 - 优惠券细化** ✅
   - 需求来源：5.3 中优惠券管理字段较多。  
   - 现状：已在 tea-api 与 Admin-FE 中落地门店专属优惠券创建/编辑/禁用能力（`/api/v1/stores/{id}/coupons` + 「门店优惠券」页面），门店可在本店维度自助配置和管理优惠券。  
   - 建议：如后续需要更复杂的人群/渠道规则，可在平台营销引擎中扩展字段，并同步裁剪门店可见字段子集。  
   - 状态：**已实现（2025-12，门店优惠券最小闭环）**。

> 如需，我可以在 `doc/prd.md` 中继续追加 `3.2.9 客服与投诉管理` 与门店活动管理的补充小节，使本对照表中的「需补充 PRD」项全部关闭。
