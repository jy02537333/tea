- MySQL: `root:gs963852@tcp(127.0.0.1:3308)/tea_shop?charset=utf8mb4&parseTime=True&loc=Local`
- Redis: `127.0.0.1:6379` 密码 `123456`
- RabbitMQ: `amqp://guest:guest@127.0.0.1:5672/`

tea-api 启动在9292
admin-fe 启动在9094
wx-fe 启动在9093

> 说明：以上环境与端口配置应与 `doc/prd.md` 中「1.1 环境与端口配置」保持一致，如有调整请优先更新 PRD 再同步本文件。
>
> curl -X POST http://localhost:9292/api/v1/user/dev-login \
  -H 'Content-Type: application/json' \
  -d '{"openid":"admin_openid"}'

export TOKEN='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VyX2lkIjozLCJvcGVuX2lkIjoiYWRtaW5fb3BlbmlkIiwicm9sZSI6ImFkbWluIiwiaXNzIjoidGVhLXNob3AiLCJleHAiOjE3NjUyNjkxODcsIm5iZiI6MTc2NTE4Mjc4NywiaWF0IjoxNzY1MTgyNzg3fQ.3W8yKGXlD52Hvn7xCCqs02_kc3qI-a8nvK-uOQQL8KQ'
export BASE_URL='http://localhost:9292/api/v1'
cd /home/frederic/project/tea/tea-api
go run ./cmd/e2e_single_sku_order

> 说明：若未导出 `TOKEN`，脚本会自动调用 `/user/dev-login` 以 `openid=admin_openid` 获取临时管理员 token。

## Linux/macOS 一键启动 API 并验证

1. 在仓库根目录执行启动脚本（会自动构建 `cmd/server/main_no_migrate.go` 并写入日志到 `build-ci-logs/`）：

  ```bash
  cd /home/frederic/project/tea
  ./run-tea-api.sh
  ```

  若提示 `address already in use`，可用 `lsof -i :9292` 查到旧 PID 并 `kill <PID>` 后重试。

1. 启动成功后运行单 SKU 下单 E2E 回归，确保 `/cart`→下单→支付链路可用：

  ```bash
  cd /home/frederic/project/tea/tea-api
  unset TOKEN
  export BASE_URL='http://localhost:9292/api/v1'
  go run ./cmd/e2e_single_sku_order
  ```

  输出包含 `E2E single SKU order flow finished.` 即代表链路正常。

  需要自定义参数时可直接使用 CLI flag 覆盖环境变量，例如：

  ```bash
  go run ./cmd/e2e_single_sku_order \
    -base-url 'http://localhost:9292/api/v1' \
    -token "$TOKEN" \
    -product-id 87 \
    -quantity 2 \
    -dev-openid admin_openid
  ```

## 自动打包

后端可通过脚本打包生成可分发的 tarball：

```bash
cd /home/frederic/project/tea/tea-api
scripts/package-tea-api.sh --os linux --arch amd64 --version sprint-a
# 产物：tea-api/dist/tea-api-sprint-a-linux-amd64.tar.gz
```

不传参数时默认读取当前 `go env GOOS/GOARCH` 并使用 `git describe --tags --always` 结果作为版本号，支持 `--entry`/`--output` 覆盖主入口与输出目录。
