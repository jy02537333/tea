# PRD 未完备功能点 Backlog

> 目的：集中列出当前 PRD 中标记为 `[]` 的功能点，作为后续产品迭代与设计补充的待办列表，避免每次翻大文档查找。
>
> 说明：
> - `[]` 表示「设计未完全收敛或实现前需再细化」，非当前迭代必须项；
> - `[x]` 可在将来补完设计后手动勾选；
> - 建议将这里的条目同步到项目管理工具（飞书多维表/禅道/Notion 等）。

---

## 1. 平台后台（3.2）

### 1.1 客服与投诉管理（3.2.9） [x]

- **PRD 位置**：`doc/prd.md` → `3.2.9 客服与投诉管理（平台端） [x]`
- **当前状态**：
  - 已在 3.2.9 中补充完整的客服工单系统 PRD：
    - 明确 Ticket 模型字段（`id, type, source, user_id, order_id, store_id, title, content, attachments, status, priority, assignee_id, created_by, remark, reject_reason, created_at, updated_at, resolved_at, closed_at` 等）；
    - 定义 6 态状态机（`new/pending/waiting_customer/resolved/rejected/closed`）及基本流转规则；
    - 描述后台工单列表与详情页的核心字段与操作（接单、分配、状态更新、内部备注等）；
    - 约定最小闭环管理接口：`GET/POST/PUT /api/v1/admin/tickets*`；
    - 预留与首页待办 `GET /api/v1/admin/dashboard/todos` 的联动字段（待处理工单数）。
- **后续建议动作**：
  - 按 PRD 在 `tea-api` 中落地 Ticket 模型、迁移与 `/api/v1/admin/tickets` 后台接口；
  - 在 Admin-FE 中新增「客服工单」页面，接入上述接口，支持按状态/类型筛选与状态流转；
  - 在工作台待办卡片中追加「待处理工单数」展示，并链接至工单列表（可作为后续迭代）。

---

## 2. 门店后台（3.3）

### 2.1 门店商品分类类型细化（3.3.2） [x]

- **PRD 位置**：`doc/prd.md` → `3.3.2 商品管理` 中的「商品分类（服务商品/外卖商品/其他） [x] — 门店商品业务类型」。
- **当前状态**：
  - 已在 PRD 中明确门店商品的业务类型字段 `biz_type`（tinyint，默认 1），取值含义：`1=服务商品（堂食/到店服务）`、`2=外卖商品（外送/打包）`、`3=其他（如会员卡、虚拟权益、礼盒等非就餐类商品）`；
  - 约定在 `store_products` 表中为每条门店商品记录写入对应的 `biz_type`，并在门店后台商品列表/编辑页中提供该字段的选择与筛选能力；
  - 前台映射关系已给出基础规则：堂食点单页默认展示 `biz_type IN (1,3)`，外卖点单页默认展示 `biz_type IN (2,3)`，为后续更细粒度展示策略预留扩展空间。
- **后续建议动作**：
  - 在具体实现阶段，按上述 PRD 约定补充后端字段与接口（`store_products.biz_type`），并在 Admin-FE 的门店商品管理页中增加「商品类型」列与筛选条件；
  - 如后续需要更复杂的商品类型层级（例如服务大类/子类），可在现有 `biz_type` 枚举之上另行扩展门店内部分类表，但不影响当前最小可用方案。

### 2.2 门店营销与活动管理（3.3.8） [x]

- **PRD 位置**：`doc/prd.md` → `3.3.8 门店营销与活动管理（补充说明） [x]`。
- **当前状态**：
  - 已在 3.3.8 中明确门店可用的营销能力子集：
    - 门店优惠券：基于统一 `Coupon` 模型增加 `store_id`，门店可在本店维度创建/编辑/禁用满减/折扣/免单券，字段范围与平台券保持一致但复杂人群/渠道规则由平台裁剪；
    - 门店活动：在 `Activity` 模型上增加 `store_id`，门店可创建/编辑本店活动（名称、类型、起止时间、规则 JSON、状态、优先级、描述等），形成门店自建活动最小闭环；
  - 已在 Admin-FE 中通过「门店优惠券」（StoreCoupons）与「门店活动」（StoreActivities）页面落地上述能力，并约定所有底层规则/风控仍由平台 `3.2.6 营销管理` 统一控制。
- **备注**：如后续需要更复杂的报名/退费或高级人群规则，可在不改变 3.3.8 既有约束的前提下，于平台营销模块追加字段，并为门店裁剪可见子集。

### 2.3 门店优惠券配置细节（门店发券能力） [x]

- **PRD 位置**：
  - `doc/prd.md` → `3.3.8.1 门店优惠券（已实现 — 最小闭环）`；
  - 关联功能清单：5.3 中「营销管理-优惠券」。
- **当前状态**：
  - 在 3.3.8.1 中已明确：门店侧优惠券字段沿用平台 `Coupon` 模型的核心字段（券类型、门槛金额、优惠金额/折扣、总量、状态、有效期、描述等），并通过 `store_id` 限定为本店券；
  - 门店仅能在本店维度创建/管理优惠券，复杂人群/渠道/风控规则仍由平台营销模块掌控，必要时通过隐藏字段或固定策略下发给门店；
  - Admin-FE 的「门店优惠券」页面已经按该字段子集实现创建/编辑/禁用与复制新建。
- **备注**：如后续需要允许门店单独配置使用范围（如仅本店指定商品），可在 `rules`/`scope` 相关字段上追加细化设计，但不影响当前最小可用能力。

### 2.4 门店财务提现/结算流程（3.3.4） [x]

- **PRD 位置**：`doc/prd.md` → `3.3.4 财务管理` 中的「财务提现（提现申请）」。
- **当前状态**：
  - 平台侧财务与门店结算能力在 `3.2.7 财务管理` 已有说明；
  - 门店侧已在 tea-api 与 Admin-FE 中落地：
    - 提供门店钱包汇总接口与门店提现申请/记录接口；
    - 后台新增「门店财务」页面（StoreFinance），支持按门店查看钱包、发起提现与查看记录；
    - 结算周期/审核流按平台提现管理对齐，后续如需更细化可在新版本 PRD 中扩展。
- **备注**：2025-12 已实现最小可用的门店财务提现功能，后续如需单独的「结算单」模型可在新迭代再补充设计。

---

## 使用建议

- 本文件只作为「设计未完全收敛点」的导航；
- 当你在某一迭代准备启动上述任一功能时，可以：
  1. 在 `doc/prd.md` 中补充相应小节或字段表；
  2. 更新这里对应条目为 `[x]`，并在备注中简要写上补充日期与 PRD 小节编号；
  3. 如有需要，再拆分为更细的技术设计文档或开发任务。
