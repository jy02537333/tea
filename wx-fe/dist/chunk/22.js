"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[22],{"8870":function(e,n,i){i.d(n,{"I8":function(){return s},"cr":function(){return r},"gT":function(){return o},"i5":function(){return t},"os":function(){return l},"vY":function(){return a}});var t="提示：设为当前门店仅用于筛选/浏览，您暂无门店管理权限",o="当前为只读模式，您暂无门店收款账户权限",l="当前为只读模式，您暂无门店财务权限",a="暂无门店管理权限",s="暂无门店收款账户权限",r="暂无门店财务权限"},"228":function(e,n,i){i.d(n,{"A":function(){return usePermission}});var t=i(8646),o=i(6673),l=i(9866),a=i(7378),s=i(4368);function usePermission(){var e=(0,a.useState)(null),n=(0,l.A)(e,2),i=n[0],r=n[1],d=(0,a.useState)(!0),c=(0,l.A)(d,2),u=c[0],h=c[1],f=(0,a.useCallback)((0,o.A)((0,t.A)().m(function _callee(){var e;return(0,t.A)().w(function(n){for(;;)switch(n.p=n.n){case 0:return h(!0),n.p=1,n.n=2,(0,s.$)();case 2:e=n.v,r((null==e?void 0:e.user)||null),n.n=4;break;case 3:n.p=3,n.v,r(null);case 4:return n.p=4,h(!1),n.f(4);case 5:return n.a(2)}},_callee,null,[[1,3,4,5]])})),[]);(0,a.useEffect)(function(){f()},[f]);var g=((null==i?void 0:i.role)||"").toLowerCase(),p=!!g&&g.includes("admin"),v=!!g&&(g.includes("admin")||g.includes("store:accounts")||g.includes("store")),y=!!g&&(g.includes("admin")||g.includes("store:finance")||g.includes("store"));return{"user":i,"role":g,"loading":u,"isAdmin":p,"allowedStoreMgmt":v||y,"allowedStoreAccounts":v,"allowedStoreFinance":y,"canManageStores":function canManageStores(e){var n=((null==e?void 0:e.role)||g||"").toLowerCase();return!!n&&(n.includes("admin")||n.includes("store"))},"canManageStoreAccounts":function canManageStoreAccounts(e){var n=((null==e?void 0:e.role)||g||"").toLowerCase();return!!n&&(n.includes("admin")||n.includes("store:accounts")||n.includes("store"))},"canManageStoreFinance":function canManageStoreFinance(e){var n=((null==e?void 0:e.role)||g||"").toLowerCase();return!!n&&(n.includes("admin")||n.includes("store:finance")||n.includes("store"))},"refresh":f}}},"8022":function(e,n,i){i.r(n),i.d(n,{"default":function(){return ProfilePage}});var t=i(8646),o=i(6673),l=i(9866),a=i(7378),s=i(4657),r=i(8785),d=i(2489),c=i(9624),u=i(6244),h=i(4368),f=i(7356),g=i(228),p=i(8870),v=i(6106);function ProfilePage(){var e,n,i,y,m,b,x,S,k,w,A,j,T=(0,a.useState)(null),_=(0,l.A)(T,2),M=_[0],E=_[1],Y=(0,a.useState)(!1),C=(0,l.A)(Y,2),L=C[0],P=C[1],z=(0,a.useState)(null),V=(0,l.A)(z,2),W=V[0],I=V[1];function loadProfile(){return _loadProfile.apply(this,arguments)}function _loadProfile(){return(_loadProfile=(0,o.A)((0,t.A)().m(function _callee(){var e,n;return(0,t.A)().w(function(i){for(;;)switch(i.p=i.n){case 0:return P(!0),i.p=1,i.n=2,(0,h.$)();case 2:e=i.v,E(e),I(null),i.n=4;break;case 3:i.p=3,n=i.v,E(null),I((null==n?void 0:n.message)||"未登录");case 4:return i.p=4,P(!1),(0,d.r)(),i.f(4);case 5:return i.a(2)}},_callee,null,[[1,3,4,5]])}))).apply(this,arguments)}function handleLoginNavigate(){r.Ay.navigateTo({"url":"/pages/login/index"}).catch(function(){r.Ay.switchTab({"url":"/pages/index/index"}).catch(function(){})})}(0,a.useEffect)(function(){loadProfile()},[]),r.Ay.usePullDownRefresh(function(){loadProfile()});var B=null==M?void 0:M.user,R=(0,g.A)();function ensureLoggedIn(){return!!B||((0,c.P0)({"title":"请先登录","icon":"none"}),handleLoginNavigate(),!1)}function handleViewOrders(){ensureLoggedIn()&&r.Ay.navigateTo({"url":"/pages/orders/index"}).catch(function(){})}function handleViewCoupons(){ensureLoggedIn()&&r.Ay.navigateTo({"url":"/pages/coupons/index"}).catch(function(){})}function handleViewWallet(){ensureLoggedIn()&&r.Ay.navigateTo({"url":"/pages/wallet/index"}).catch(function(){})}function handleViewPoints(){ensureLoggedIn()&&r.Ay.navigateTo({"url":"/pages/points/index"}).catch(function(){})}function handleShareCenter(){ensureLoggedIn()&&r.Ay.navigateTo({"url":"/pages/share/index"}).catch(function(){})}function handleManageAddresses(){ensureLoggedIn()&&r.Ay.navigateTo({"url":"/pages/address/index"}).catch(function(){})}function handleServiceTickets(){ensureLoggedIn()&&r.Ay.navigateTo({"url":"/pages/after-sale/index"}).catch(function(){})}function handleMyTickets(){ensureLoggedIn()&&r.Ay.navigateTo({"url":"/pages/after-sale/index"}).catch(function(){})}function handleFeedback(){ensureLoggedIn()&&r.Ay.navigateTo({"url":"/pages/feedback/index"}).catch(function(){})}function handleHelpDocs(){r.Ay.navigateTo({"url":"/pages/help/index"}).catch(function(){})}function handleSettings(){r.Ay.navigateTo({"url":"/pages/settings/index"}).catch(function(){})}function handleStoreManagement(){if(ensureLoggedIn())if(R.allowedStoreMgmt){var e=null;try{var n=(0,u.JF)("current_store_id"),i=Number(n);Number.isFinite(i)&&i>0&&(e=i)}catch(e){}e?r.Ay.navigateTo({"url":"/pages/store-accounts/index?store_id=".concat(e)}).catch(function(){r.Ay.navigateTo({"url":"/pages/stores/index"}).catch(function(){})}):r.Ay.navigateTo({"url":"/pages/stores/index"}).catch(function(){})}else(0,c.P0)({"title":p.vY,"icon":"none"})}function handleViewMembership(){ensureLoggedIn()&&r.Ay.navigateTo({"url":"/pages/membership/index"}).catch(function(){})}var F=(0,a.useMemo)(function(){var e=[{"key":"orders","title":"订单","desc":"查看全部订单","action":handleViewOrders},{"key":"my_tickets","title":"我的工单","desc":"查看反馈与售后","action":handleMyTickets},{"key":"service","title":"售后服务","desc":"进度&售后操作","action":handleServiceTickets},{"key":"wallet","title":"钱包","desc":"余额/提现/茶币","action":handleViewWallet},{"key":"points","title":"积分","desc":"积分与成长值","action":handleViewPoints},{"key":"coupons","title":"优惠券","desc":"查看可用权益","action":handleViewCoupons},{"key":"share","title":"分享推广","desc":"推广数据与收益","action":handleShareCenter},{"key":"address","title":"收货地址","desc":"管理常用地址","action":handleManageAddresses},{"key":"membership","title":"会员权益","desc":B?"查看会员与权益":"登录后可同步权益","action":handleViewMembership},{"key":"feedback","title":"意见反馈","desc":"提交工单反馈","action":handleFeedback},{"key":"help","title":"帮助文档","desc":"常见问题说明","action":handleHelpDocs},{"key":"settings","title":"设置","desc":"账号/登录/地址/关于","action":handleSettings}];return R.allowedStoreMgmt&&e.splice(6,0,{"key":"store_mgmt","title":"门店管理","desc":"门店与收款账户","action":handleStoreManagement}),e},[handleViewOrders,handleViewWallet,handleViewPoints,handleViewCoupons,handleShareCenter,handleManageAddresses,handleViewMembership,handleMyTickets,handleServiceTickets,handleFeedback,handleHelpDocs,handleSettings,handleStoreManagement,R.allowedStoreMgmt]);function yuan(e){return"number"!=typeof e?"--":(e/100).toFixed(2)}return(0,v.jsxs)(s.Ss,{"style":{"minHeight":"100vh","backgroundColor":"#f5f6f8","padding":20},"children":[(0,v.jsxs)(s.Ss,{"style":{"backgroundColor":"#fff","borderRadius":16,"padding":20,"display":"flex","alignItems":"center"},"children":[(0,v.jsx)(s._V,{"src":(null==B?void 0:B.avatar)||"https://dummyimage.com/120x120/dcdcdc/333333&text=Tea","style":{"width":80,"height":80,"borderRadius":40,"marginRight":16}}),(0,v.jsxs)(s.Ss,{"style":{"flex":1},"children":[(0,v.jsx)(s.EY,{"style":{"fontSize":20,"fontWeight":"bold","display":"block"},"children":B?B.nickname||"微信用户":"未登录用户"}),(null==B?void 0:B.phone)&&(0,v.jsx)(s.EY,{"style":{"color":"#666","display":"block","marginTop":6},"children":B.phone}),W&&(0,v.jsx)(s.EY,{"style":{"color":"#ff4d4f","display":"block","marginTop":6},"children":L?"加载中...":W})]}),B?(0,v.jsx)(s.$n,{"size":"mini","onClick":function handleLogout(){(0,f.WG)(null),E(null),(0,c.P0)({"title":"已退出","icon":"none"})},"children":"退出"}):(0,v.jsx)(s.$n,{"size":"mini","onClick":handleLoginNavigate,"loading":L,"children":"去登录"})]}),(0,v.jsxs)(s.Ss,{"style":{"backgroundColor":"#fff","borderRadius":16,"padding":20,"marginTop":16},"children":[(0,v.jsx)(s.EY,{"style":{"fontSize":16,"fontWeight":"bold"},"children":"资产概览"}),(0,v.jsxs)(s.Ss,{"style":{"display":"flex","flexWrap":"wrap","marginTop":12},"children":[(0,v.jsxs)(s.Ss,{"style":{"width":"50%","paddingTop":8,"paddingBottom":8},"children":[(0,v.jsx)(s.EY,{"style":{"color":"#999"},"children":"余额（¥）"}),(0,v.jsx)(s.EY,{"style":{"fontSize":18,"fontWeight":"bold"},"children":yuan(null==M||null===(e=M.wallet)||void 0===e?void 0:e.balance_cents)})]}),(0,v.jsxs)(s.Ss,{"style":{"width":"50%","paddingTop":8,"paddingBottom":8},"children":[(0,v.jsx)(s.EY,{"style":{"color":"#999"},"children":"茶币"}),(0,v.jsx)(s.EY,{"style":{"fontSize":18,"fontWeight":"bold"},"children":null!==(n=null==M||null===(i=M.wallet)||void 0===i?void 0:i.tea_coins)&&void 0!==n?n:"--"})]}),(0,v.jsxs)(s.Ss,{"style":{"width":"50%","paddingTop":8,"paddingBottom":8},"children":[(0,v.jsx)(s.EY,{"style":{"color":"#999"},"children":"积分"}),(0,v.jsx)(s.EY,{"style":{"fontSize":18,"fontWeight":"bold"},"children":null!==(y=null==M||null===(m=M.points)||void 0===m?void 0:m.balance)&&void 0!==y?y:"--"})]}),(0,v.jsxs)(s.Ss,{"style":{"width":"50%","paddingTop":8,"paddingBottom":8},"children":[(0,v.jsx)(s.EY,{"style":{"color":"#999"},"children":"可用佣金（¥）"}),(0,v.jsx)(s.EY,{"style":{"fontSize":18,"fontWeight":"bold"},"children":yuan(null==M||null===(b=M.share)||void 0===b?void 0:b.available_commission_cents)})]}),(0,v.jsxs)(s.Ss,{"style":{"width":"50%","paddingTop":8,"paddingBottom":8},"children":[(0,v.jsx)(s.EY,{"style":{"color":"#999"},"children":"冻结佣金（¥）"}),(0,v.jsx)(s.EY,{"style":{"fontSize":18,"fontWeight":"bold"},"children":yuan(null==M||null===(x=M.share)||void 0===x?void 0:x.frozen_commission_cents)})]}),(0,v.jsxs)(s.Ss,{"style":{"width":"50%","paddingTop":8,"paddingBottom":8},"children":[(0,v.jsx)(s.EY,{"style":{"color":"#999"},"children":"累计佣金（¥）"}),(0,v.jsx)(s.EY,{"style":{"fontSize":18,"fontWeight":"bold"},"children":yuan(null==M||null===(S=M.share)||void 0===S?void 0:S.total_commission_cents)})]}),(0,v.jsxs)(s.Ss,{"style":{"width":"100%","paddingTop":8,"paddingBottom":8},"children":[(0,v.jsx)(s.EY,{"style":{"color":"#999"},"children":"推广规模（直属/团队）"}),(0,v.jsx)(s.EY,{"style":{"fontSize":16},"children":(null!==(k=null==M||null===(w=M.share)||void 0===w?void 0:w.direct_count)&&void 0!==k?k:0)+" / "+(null!==(A=null==M||null===(j=M.share)||void 0===j?void 0:j.team_count)&&void 0!==A?A:0)})]})]})]}),(0,v.jsxs)(s.Ss,{"style":{"backgroundColor":"#fff","borderRadius":16,"padding":20,"marginTop":16},"children":[(0,v.jsx)(s.EY,{"style":{"fontSize":16,"fontWeight":"bold"},"children":"我的服务"}),(0,v.jsx)(s.Ss,{"style":{"display":"grid","gridTemplateColumns":"repeat(2, 1fr)","marginTop":12,"borderTop":"1px solid #f0f0f0","borderLeft":"1px solid #f0f0f0","borderRadius":12,"overflow":"hidden"},"children":F.map(function(e){return(0,v.jsxs)(s.Ss,{"style":{"paddingTop":14,"paddingBottom":14,"paddingLeft":8,"paddingRight":8,"textAlign":"center","borderRight":"1px solid #f0f0f0","borderBottom":"1px solid #f0f0f0"},"onClick":e.action,"children":[(0,v.jsx)(s.EY,{"style":{"display":"block","fontSize":16,"fontWeight":"bold"},"children":e.title}),(0,v.jsx)(s.EY,{"style":{"color":"#999","fontSize":12},"children":e.desc})]},e.key)})})]}),(0,v.jsxs)(s.Ss,{"style":{"backgroundColor":"#fff","borderRadius":16,"padding":20,"marginTop":16},"children":[(0,v.jsx)(s.EY,{"style":{"fontSize":16,"fontWeight":"bold"},"children":"账号操作"}),(0,v.jsx)(s.$n,{"style":{"marginTop":12},"onClick":handleLoginNavigate,"loading":L,"children":B?"切换账号":"登录 / 注册"}),(0,v.jsx)(s.$n,{"style":{"marginTop":12},"onClick":function handleContactSupport(){(0,c.P0)({"title":"联系客服：400-888-8888","icon":"none"})},"children":"联系客服"})]})]})}},"4368":function(e,n,i){i.d(n,{"$":function(){return getMeSummary}});var t=i(8646),o=i(3846),l=i(6673),a=i(7356);function getMeSummary(){return _getMeSummary.apply(this,arguments)}function _getMeSummary(){return(_getMeSummary=(0,l.A)((0,t.A)().m(function _callee(){var e,n,i,l,s,r,d,c,u,h,f,g,p,v,y,m,b,x,S,k,w,A;return(0,t.A)().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,a.Ay.get("/api/v1/users/me/summary");case 1:if(e=t.v,!(n=(0,a.Bm)(e))||"object"!==(0,o.A)(n)){t.n=6;break}if(!n.user||"object"!==(0,o.A)(n.user)){t.n=2;break}return t.a(2,n);case 2:if(void 0===(s=null!==(i=null!==(l=n.user_id)&&void 0!==l?l:n.uid)&&void 0!==i?i:n.id)){t.n=3;break}return c={"id":Number(s)||0,"nickname":null!==(r=null!==(d=n.nickname)&&void 0!==d?d:n.name)&&void 0!==r?r:"","phone":n.phone,"avatar":n.avatar,"role":n.role||"user"},u=n.wallet_balance,h={"balance_cents":"number"==typeof u?Math.round(100*u):void 0},f={"balance":"number"==typeof n.points?n.points:void 0},g={"available_count":"number"==typeof n.coupons?n.coupons:void 0},t.a(2,{"user":c,"wallet":h,"points":f,"coupons":g});case 3:return t.p=3,t.n=4,a.Ay.get("/api/v1/user/info");case 4:return b=t.v,x=(0,a.Bm)(b),S={"id":Number(null!==(p=null!==(v=x.id)&&void 0!==v?v:x.uid)&&void 0!==p?p:0)||0,"nickname":null!==(y=null!==(m=x.nickname)&&void 0!==m?m:x.name)&&void 0!==y?y:"","phone":x.phone,"avatar":x.avatar,"role":x.role||"user"},t.a(2,{"user":S});case 5:t.p=5,t.v;case 6:return t.a(2,n);case 7:return t.p=7,A=t.v,t.p=8,t.n=9,a.Ay.get("/api/v1/user/info");case 9:return k=t.v,w=(0,a.Bm)(k),t.a(2,{"user":{"id":null==w?void 0:w.id,"uid":null==w?void 0:w.uid,"open_id":null==w?void 0:w.open_id,"nickname":null==w?void 0:w.nickname,"avatar":null==w?void 0:w.avatar,"phone":null==w?void 0:w.phone,"gender":null==w?void 0:w.gender,"balance":null==w?void 0:w.balance,"points":null==w?void 0:w.points,"role":null==w?void 0:w.role},"wallet":{"balance_cents":"number"==typeof(null==w?void 0:w.balance)?Math.round(100*w.balance):void 0},"points":{"balance":null==w?void 0:w.points}});case 10:throw t.p=10,t.v,A;case 11:return t.a(2)}},_callee,null,[[8,10],[3,5],[0,7]])}))).apply(this,arguments)}}}]);