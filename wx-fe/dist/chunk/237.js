"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[237],{"3237":function(t,n,e){e.r(n),e.d(n,{"default":function(){return CartPage}});var r=e(6045),c=e(8646),a=e(6673),o=e(9866),i=e(7378),u=e(4657),s=e(6244),l=e(9624),p=e(8785),f=e(768),d=e(8414),A=e(4088),h=e(6106);function CartPage(){var t=(0,i.useState)([]),n=(0,o.A)(t,2),e=n[0],_=n[1],m=(0,i.useState)(!1),v=(0,o.A)(m,2),y=v[0],S=v[1],g=(0,i.useState)(null),C=(0,o.A)(g,2),w=C[0],x=C[1];function _loadCurrentStore(){return(_loadCurrentStore=(0,a.A)((0,c.A)().m(function _callee(){var t,n,e;return(0,c.A)().w(function(r){for(;;)switch(r.p=r.n){case 0:if(r.p=0,t=(0,s.JF)("current_store_id"),n=t?Number(t):NaN,Number.isNaN(n)||!(n>0)){r.n=2;break}return r.n=1,(0,A.KA)(n);case 1:e=r.v,x(e);case 2:r.n=4;break;case 3:r.p=3,r.v;case 4:return r.a(2)}},_callee,null,[[0,3]])}))).apply(this,arguments)}function _fetchCart(){return(_fetchCart=(0,a.A)((0,c.A)().m(function _callee2(){var t,n,e,a,o,i,u;return(0,c.A)().w(function(c){for(;;)switch(c.p=c.n){case 0:return S(!0),c.p=1,c.n=2,(0,f.Fx)();case 2:return t=c.v,n=t||[],c.n=3,(0,d.d$)({"page":1,"limit":200});case 3:e=c.v,a=e,o=Array.isArray(null==a?void 0:a.data)?a.data:Array.isArray(null==a?void 0:a.items)?a.items:Array.isArray(a)?a:[],i=n.map(function(t){return(0,r.A)((0,r.A)({},t),{},{"product":o.find(function(n){return n.id===t.product_id})})}),_(i),c.n=5;break;case 4:c.p=4,u=c.v,console.error("load cart failed",u);case 5:return c.p=5,S(!1),c.f(5);case 6:return c.a(2)}},_callee2,null,[[1,4,5,6]])}))).apply(this,arguments)}function handleQuantityChange(t,n){return _handleQuantityChange.apply(this,arguments)}function _handleQuantityChange(){return(_handleQuantityChange=(0,a.A)((0,c.A)().m(function _callee3(t,n){var e;return(0,c.A)().w(function(c){for(;;)switch(c.p=c.n){case 0:if(!(n<=0)){c.n=1;break}return c.a(2);case 1:return c.p=1,c.n=2,(0,f.V2)(t,n);case 2:_(function(e){return e.map(function(e){return e.id===t?(0,r.A)((0,r.A)({},e),{},{"quantity":n}):e})}),c.n=4;break;case 3:c.p=3,e=c.v,console.error("update cart failed",e);case 4:return c.a(2)}},_callee3,null,[[1,3]])}))).apply(this,arguments)}function _handleRemove(){return(_handleRemove=(0,a.A)((0,c.A)().m(function _callee4(t){var n;return(0,c.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return e.p=0,e.n=1,(0,f.SM)(t);case 1:_(function(n){return n.filter(function(n){return n.id!==t})}),e.n=3;break;case 2:e.p=2,n=e.v,console.error("remove cart item failed",n);case 3:return e.a(2)}},_callee4,null,[[0,2]])}))).apply(this,arguments)}return(0,i.useEffect)(function(){!function fetchCart(){return _fetchCart.apply(this,arguments)}(),function loadCurrentStore(){return _loadCurrentStore.apply(this,arguments)}()},[]),(0,h.jsxs)(u.Ss,{"style":{"padding":12},"children":[w&&(0,h.jsx)(u.Ss,{"style":{"marginBottom":8,"padding":"6px 10px","borderWidth":1,"borderStyle":"solid","borderColor":"#07c160","borderRadius":16,"display":"inline-block","backgroundColor":"#f6ffed"},"children":(0,h.jsxs)(u.EY,{"style":{"color":"#389e0d"},"children":["当前门店：",w.name]})}),y&&(0,h.jsx)(u.EY,{"children":"加载中..."}),!y&&!e.length&&(0,h.jsx)(u.EY,{"children":"购物车为空"}),e.map(function(t){var n;return(0,h.jsxs)(u.Ss,{"style":{"marginBottom":12,"borderBottomWidth":1,"borderStyle":"solid","borderColor":"#eee","paddingBottom":8},"children":[(0,h.jsx)(u.EY,{"style":{"fontSize":16,"fontWeight":"bold"},"children":(null===(n=t.product)||void 0===n?void 0:n.name)||"商品#".concat(t.product_id)}),(0,h.jsxs)(u.EY,{"children":[" 数量: ",t.quantity]}),(0,h.jsxs)(u.Ss,{"style":{"marginTop":4,"display":"flex","flexDirection":"row"},"children":[(0,h.jsx)(u.$n,{"size":"mini","onClick":function onClick(){return handleQuantityChange(t.id,t.quantity-1)},"children":"-"}),(0,h.jsx)(u.$n,{"size":"mini","onClick":function onClick(){return handleQuantityChange(t.id,t.quantity+1)},"style":{"marginLeft":8},"children":"+"}),(0,h.jsx)(u.$n,{"size":"mini","type":"warn","style":{"marginLeft":8},"onClick":function onClick(){return function handleRemove(t){return _handleRemove.apply(this,arguments)}(t.id)},"children":"删除"})]})]},t.id)}),e.length>0&&(0,h.jsxs)(u.Ss,{"style":{"marginTop":12},"children":[(0,h.jsxs)(u.EY,{"children":["合计: ",function calcTotal(){return e.reduce(function(t,n){var e,r;return t+(Number(null!==(e=null===(r=n.product)||void 0===r?void 0:r.price)&&void 0!==e?e:0)||0)*n.quantity},0)}()]}),(0,h.jsx)(u.Ss,{"style":{"marginTop":8,"display":"flex","flexDirection":"row"},"children":(0,h.jsx)(u.$n,{"style":{"marginLeft":8},"type":"primary","onClick":function goCheckout(){e.length?p.Ay.navigateTo({"url":"/pages/checkout/index"}):(0,l.P0)({"title":"购物车为空","icon":"none","duration":1500})},"children":"去结算"})})]})]})}},"768":function(t,n,e){e.d(n,{"Fx":function(){return listCart},"SM":function(){return removeCartItem},"V2":function(){return updateCartItem},"bR":function(){return addCartItem}});var r=e(8646),c=e(6673),a=e(7356);function listCart(){return _listCart.apply(this,arguments)}function _listCart(){return(_listCart=(0,c.A)((0,r.A)().m(function _callee(){var t;return(0,r.A)().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,a.Ay.get("/api/v1/cart");case 1:return t=n.v,n.a(2,(0,a.Bm)(t))}},_callee)}))).apply(this,arguments)}function addCartItem(t,n,e){return _addCartItem.apply(this,arguments)}function _addCartItem(){return(_addCartItem=(0,c.A)((0,r.A)().m(function _callee2(t,n,e){var c;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,a.Ay.post("/api/v1/cart/items",{"product_id":t,"sku_id":n,"quantity":e});case 1:return c=r.v,r.a(2,(0,a.Bm)(c))}},_callee2)}))).apply(this,arguments)}function updateCartItem(t,n){return _updateCartItem.apply(this,arguments)}function _updateCartItem(){return(_updateCartItem=(0,c.A)((0,r.A)().m(function _callee3(t,n){var e;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,a.Ay.put("/api/v1/cart/items/".concat(t),{"quantity":n});case 1:return e=r.v,r.a(2,(0,a.Bm)(e))}},_callee3)}))).apply(this,arguments)}function removeCartItem(t){return _removeCartItem.apply(this,arguments)}function _removeCartItem(){return(_removeCartItem=(0,c.A)((0,r.A)().m(function _callee4(t){var n;return(0,r.A)().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,a.Ay.delete("/api/v1/cart/items/".concat(t));case 1:return n=e.v,e.a(2,(0,a.Bm)(n))}},_callee4)}))).apply(this,arguments)}},"8414":function(t,n,e){e.d(n,{"Pt":function(){return o},"d$":function(){return getProducts},"oo":function(){return getProduct}});var r=e(8646),c=e(6673),a=e(7356);function getProducts(){return _getProducts.apply(this,arguments)}function _getProducts(){return _getProducts=(0,c.A)((0,r.A)().m(function _callee(){var t,n,e=arguments;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return t=e.length>0&&void 0!==e[0]?e[0]:{},r.n=1,a.Ay.get("/api/v1/products",{"params":t});case 1:return n=r.v,r.a(2,(0,a.Bm)(n))}},_callee)})),_getProducts.apply(this,arguments)}function getProduct(t,n){return _getProduct.apply(this,arguments)}function _getProduct(){return(_getProduct=(0,c.A)((0,r.A)().m(function _callee2(t,n){var e;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,a.Ay.get("/api/v1/products/".concat(t),{"params":n?{"store_id":n}:{}});case 1:return e=r.v,r.a(2,(0,a.Bm)(e))}},_callee2)}))).apply(this,arguments)}var o=getProducts},"4088":function(t,n,e){e.d(n,{"EC":function(){return listStoreAccounts},"FS":function(){return listStoreFinanceTransactions},"KA":function(){return getStore},"KW":function(){return updateStoreAccount},"Rr":function(){return listStores},"gg":function(){return deleteStoreAccount},"iR":function(){return listStoreExclusiveProducts},"jE":function(){return exportStoreFinanceTransactions},"n9":function(){return createStoreAccount}});var r=e(8646),c=e(6673),a=e(7356);function listStores(){return _listStores.apply(this,arguments)}function _listStores(){return _listStores=(0,c.A)((0,r.A)().m(function _callee(){var t,n,e=arguments;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return t=e.length>0&&void 0!==e[0]?e[0]:{},r.n=1,a.Ay.get("/api/v1/stores",{"params":t});case 1:return n=r.v,r.a(2,(0,a.Bm)(n))}},_callee)})),_listStores.apply(this,arguments)}function getStore(t){return _getStore.apply(this,arguments)}function _getStore(){return(_getStore=(0,c.A)((0,r.A)().m(function _callee2(t){var n;return(0,r.A)().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,a.Ay.get("/api/v1/stores/".concat(t));case 1:return n=e.v,e.a(2,(0,a.Bm)(n))}},_callee2)}))).apply(this,arguments)}function listStoreExclusiveProducts(t){return _listStoreExclusiveProducts.apply(this,arguments)}function _listStoreExclusiveProducts(){return _listStoreExclusiveProducts=(0,c.A)((0,r.A)().m(function _callee3(t){var n,e,c=arguments;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:{},r.n=1,a.Ay.get("/api/v1/stores/".concat(t,"/exclusive-products"),{"params":n});case 1:return e=r.v,r.a(2,(0,a.Bm)(e))}},_callee3)})),_listStoreExclusiveProducts.apply(this,arguments)}function listStoreAccounts(t){return _listStoreAccounts.apply(this,arguments)}function _listStoreAccounts(){return(_listStoreAccounts=(0,c.A)((0,r.A)().m(function _callee4(t){var n;return(0,r.A)().w(function(e){for(;;)switch(e.n){case 0:return e.n=1,a.Ay.get("/api/v1/stores/".concat(t,"/accounts"));case 1:return n=e.v,e.a(2,(0,a.Bm)(n))}},_callee4)}))).apply(this,arguments)}function createStoreAccount(t,n){return _createStoreAccount.apply(this,arguments)}function _createStoreAccount(){return(_createStoreAccount=(0,c.A)((0,r.A)().m(function _callee5(t,n){var e;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,a.Ay.post("/api/v1/stores/".concat(t,"/accounts"),n);case 1:return e=r.v,r.a(2,(0,a.Bm)(e))}},_callee5)}))).apply(this,arguments)}function updateStoreAccount(t,n,e){return _updateStoreAccount.apply(this,arguments)}function _updateStoreAccount(){return(_updateStoreAccount=(0,c.A)((0,r.A)().m(function _callee6(t,n,e){var c;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,a.Ay.put("/api/v1/stores/".concat(t,"/accounts/").concat(n),e);case 1:return c=r.v,r.a(2,(0,a.Bm)(c))}},_callee6)}))).apply(this,arguments)}function deleteStoreAccount(t,n){return _deleteStoreAccount.apply(this,arguments)}function _deleteStoreAccount(){return(_deleteStoreAccount=(0,c.A)((0,r.A)().m(function _callee7(t,n){var e;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,a.Ay.delete("/api/v1/stores/".concat(t,"/accounts/").concat(n));case 1:return e=r.v,r.a(2,(0,a.Bm)(e))}},_callee7)}))).apply(this,arguments)}function listStoreFinanceTransactions(t){return _listStoreFinanceTransactions.apply(this,arguments)}function _listStoreFinanceTransactions(){return _listStoreFinanceTransactions=(0,c.A)((0,r.A)().m(function _callee8(t){var n,e,c=arguments;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return n=c.length>1&&void 0!==c[1]?c[1]:{},r.n=1,a.Ay.get("/api/v1/stores/".concat(t,"/finance/transactions"),{"params":n});case 1:return e=r.v,r.a(2,(0,a.Bm)(e))}},_callee8)})),_listStoreFinanceTransactions.apply(this,arguments)}function exportStoreFinanceTransactions(t){return _exportStoreFinanceTransactions.apply(this,arguments)}function _exportStoreFinanceTransactions(){return _exportStoreFinanceTransactions=(0,c.A)((0,r.A)().m(function _callee9(t){var n,e=arguments;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return n=e.length>1&&void 0!==e[1]?e[1]:{},r.n=1,a.Ay.get("/api/v1/stores/".concat(t,"/finance/transactions/export"),{"params":n,"responseType":"blob"});case 1:return r.a(2)}},_callee9)})),_exportStoreFinanceTransactions.apply(this,arguments)}}}]);