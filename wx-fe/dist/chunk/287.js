"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[287],{"4287":function(r,e,n){n.r(e),n.d(e,{"default":function(){return MembershipOrdersPage}});var t=n(3356),a=n(8646),c=n(6673),o=n(9866),i=n(7378),s=n(4657),l=n(8785),u=n(9624),d=n(2489),f=n(6287),p=n(6106);function MembershipOrdersPage(){var r=(0,i.useState)([]),e=(0,o.A)(r,2),n=e[0],h=e[1],_=(0,i.useState)(1),y=(0,o.A)(_,2),A=y[0],m=y[1],v=(0,i.useState)(!0),g=(0,o.A)(v,2),O=g[0],w=g[1],b=(0,i.useState)(!1),x=(0,o.A)(b,2),j=x[0],C=x[1];function reload(){return _reload.apply(this,arguments)}function _reload(){return(_reload=(0,c.A)((0,a.A)().m(function _callee(){return(0,a.A)().w(function(r){for(;;)switch(r.n){case 0:return m(1),w(!0),h([]),r.n=1,fetchPage(1,!0);case 1:return r.a(2)}},_callee)}))).apply(this,arguments)}function _loadMore(){return(_loadMore=(0,c.A)((0,a.A)().m(function _callee2(){var r;return(0,a.A)().w(function(e){for(;;)switch(e.n){case 0:return r=A+1,e.n=1,fetchPage(r,!1);case 1:return e.a(2)}},_callee2)}))).apply(this,arguments)}function fetchPage(r,e){return _fetchPage.apply(this,arguments)}function _fetchPage(){return(_fetchPage=(0,c.A)((0,a.A)().m(function _callee3(r,e){var c,o,i,s,l;return(0,a.A)().w(function(a){for(;;)switch(a.p=a.n){case 0:return C(!0),a.p=1,a.n=2,(0,f.MV)({"page":r,"limit":20,"status":0});case 2:c=a.v,o=Array.isArray(c.data)?c.data:[],i=o.filter(function(r){return 4===Number(r.order_type)}),s=e?i:[].concat((0,t.A)(n),(0,t.A)(i)),h(s),m(r),w(i.length>=20),a.n=4;break;case 3:a.p=3,l=a.v,console.error("load membership orders failed",l),(0,u.P0)({"title":"加载会员订单失败","icon":"none"});case 4:return a.p=4,C(!1),(0,d.r)(),a.f(4);case 5:return a.a(2)}},_callee3,null,[[1,3,4,5]])}))).apply(this,arguments)}return(0,i.useEffect)(function(){reload()},[]),l.Ay.usePullDownRefresh(function(){reload()}),l.Ay.useReachBottom(function(){!j&&O&&function loadMore(){return _loadMore.apply(this,arguments)}()}),(0,p.jsxs)(s.Ss,{"style":{"minHeight":"100vh","backgroundColor":"#f5f6f8"},"children":[(0,p.jsx)(s.Ss,{"style":{"padding":16},"children":(0,p.jsx)(s.EY,{"style":{"fontSize":18,"fontWeight":"bold"},"children":"我的会员订单"})}),(0,p.jsxs)(s.BM,{"scrollY":!0,"style":{"height":"calc(100vh - 48px)","padding":16},"lowerThreshold":60,"children":[0===n.length&&!j&&(0,p.jsx)(s.EY,{"style":{"color":"#999"},"children":"暂无会员订单"}),n.map(function(r){return(0,p.jsxs)(s.Ss,{"style":{"marginBottom":12,"padding":12,"borderRadius":8,"backgroundColor":"#fff","borderWidth":1,"borderColor":"#eee"},"children":[(0,p.jsxs)(s.EY,{"style":{"fontSize":14,"color":"#333"},"children":["订单号：",r.order_no]}),(0,p.jsxs)(s.EY,{"style":{"marginTop":4,"color":"#666"},"children":["金额：￥",(a=r.pay_amount,Number(a||0).toFixed(2))]}),(0,p.jsxs)(s.EY,{"style":{"marginTop":4,"color":"#666"},"children":["状态：",(e=r,n=Number(e.status||e.order_status||0),t=Number(e.pay_status||0),5===n?"已取消":2!==t||2!==n&&4!==n?1===n&&1===t?"待支付":"处理中":"已支付")]}),(0,p.jsxs)(s.EY,{"style":{"marginTop":4,"color":"#999","fontSize":12},"children":["下单时间：",r.created_at||""]})]},r.id);var e,n,t,a}),j&&(0,p.jsx)(s.EY,{"style":{"color":"#999"},"children":"加载中..."}),!j&&O&&n.length>0&&(0,p.jsx)(s.EY,{"style":{"color":"#999"},"children":"上拉加载更多..."}),!j&&!O&&n.length>0&&(0,p.jsx)(s.EY,{"style":{"color":"#999"},"children":"已无更多订单"})]})]})}},"6287":function(r,e,n){n.d(e,{"Ad":function(){return confirmReceive},"MV":function(){return listOrders},"N4":function(){return cancelOrder},"SK":function(){return getAvailableCouponsForOrder},"Tg":function(){return payOrder},"X9":function(){return createOrderFromCart},"r$":function(){return getOrder}});var t=n(8646),a=n(6673),c=n(7356);function createOrderFromCart(r){return _createOrderFromCart.apply(this,arguments)}function _createOrderFromCart(){return(_createOrderFromCart=(0,a.A)((0,t.A)().m(function _callee(r){var e;return(0,t.A)().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,c.Ay.post("/api/v1/orders/from-cart",r);case 1:return e=n.v,n.a(2,(0,c.Bm)(e))}},_callee)}))).apply(this,arguments)}function listOrders(){return _listOrders.apply(this,arguments)}function _listOrders(){return _listOrders=(0,a.A)((0,t.A)().m(function _callee2(){var r,e,n=arguments;return(0,t.A)().w(function(t){for(;;)switch(t.n){case 0:return r=n.length>0&&void 0!==n[0]?n[0]:{},t.n=1,c.Ay.get("/api/v1/orders",{"params":r});case 1:return e=t.v,t.a(2,(0,c.Bm)(e))}},_callee2)})),_listOrders.apply(this,arguments)}function getOrder(r){return _getOrder.apply(this,arguments)}function _getOrder(){return(_getOrder=(0,a.A)((0,t.A)().m(function _callee3(r){var e,n;return(0,t.A)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,c.Ay.get("/api/v1/orders/".concat(r));case 1:return e=t.v,n=(0,c.Bm)(e),t.a(2,{"order":null==n?void 0:n.order,"items":Array.isArray(null==n?void 0:n.items)?n.items:[]})}},_callee3)}))).apply(this,arguments)}function cancelOrder(r,e){return _cancelOrder.apply(this,arguments)}function _cancelOrder(){return(_cancelOrder=(0,a.A)((0,t.A)().m(function _callee4(r,e){var n;return(0,t.A)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,c.Ay.post("/api/v1/orders/".concat(r,"/cancel"),{"reason":e});case 1:n=t.v,(0,c.Bm)(n);case 2:return t.a(2)}},_callee4)}))).apply(this,arguments)}function payOrder(r){return _payOrder.apply(this,arguments)}function _payOrder(){return(_payOrder=(0,a.A)((0,t.A)().m(function _callee5(r){var e;return(0,t.A)().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,c.Ay.post("/api/v1/orders/".concat(r,"/pay"));case 1:e=n.v,(0,c.Bm)(e);case 2:return n.a(2)}},_callee5)}))).apply(this,arguments)}function confirmReceive(r){return _confirmReceive.apply(this,arguments)}function _confirmReceive(){return(_confirmReceive=(0,a.A)((0,t.A)().m(function _callee6(r){var e;return(0,t.A)().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,c.Ay.post("/api/v1/orders/".concat(r,"/receive"));case 1:e=n.v,(0,c.Bm)(e);case 2:return n.a(2)}},_callee6)}))).apply(this,arguments)}function getAvailableCouponsForOrder(r){return _getAvailableCouponsForOrder.apply(this,arguments)}function _getAvailableCouponsForOrder(){return(_getAvailableCouponsForOrder=(0,a.A)((0,t.A)().m(function _callee7(r){var e;return(0,t.A)().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,c.Ay.post("/api/v1/orders/available-coupons",r);case 1:return e=n.v,n.a(2,(0,c.Bm)(e))}},_callee7)}))).apply(this,arguments)}}}]);