"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[3],{"8384":function(e,r,t){t.r(r),t.d(r,{"default":function(){return CheckoutPage}});var n=t(6045),a=t(8646),c=t(6673),o=t(9866),i=t(7378),u=t(4657),s=t(6244),l=t(9624),d=t(8785),f=t(768),p=t(6287),A=t(5225),_=t(4088),v=t(5219),m=t(9918),h=t(6106);function CheckoutPage(){var e=(0,i.useState)([]),r=(0,o.A)(e,2),t=r[0],y=r[1],S=(0,i.useState)(0),b=(0,o.A)(S,2),w=b[0],g=b[1],C=(0,i.useState)(""),x=(0,o.A)(C,2),k=x[0],O=x[1],D=(0,i.useState)(""),F=(0,o.A)(D,2),I=F[0],N=F[1],j=(0,i.useState)(!1),T=(0,o.A)(j,2),B=T[0],P=T[1],E=(0,i.useState)("暂不使用优惠券"),R=(0,o.A)(E,2),L=R[0],J=R[1],Y=(0,i.useState)(void 0),z=(0,o.A)(Y,2),q=z[0],K=z[1],M=(0,i.useState)([]),U=(0,o.A)(M,2),$=U[0],W=U[1],V=(0,i.useState)(!1),X=(0,o.A)(V,2),G=X[0],H=X[1],Q=(0,i.useState)(null),Z=(0,o.A)(Q,2),ee=Z[0],re=Z[1];function _loadCurrentStore(){return(_loadCurrentStore=(0,c.A)((0,a.A)().m(function _callee(){var e,r,t;return(0,a.A)().w(function(n){for(;;)switch(n.p=n.n){case 0:if(n.p=0,e=(0,s.JF)("current_store_id"),r=e?Number(e):NaN,Number.isNaN(r)||!(r>0)){n.n=2;break}return n.n=1,(0,_.KA)(r);case 1:t=n.v,re(t);case 2:n.n=4;break;case 3:n.p=3,n.v;case 4:return n.a(2)}},_callee,null,[[0,3]])}))).apply(this,arguments)}function _fetchCart(){return(_fetchCart=(0,c.A)((0,a.A)().m(function _callee2(){var e,r,t,n;return(0,a.A)().w(function(a){for(;;)switch(a.p=a.n){case 0:return a.p=0,a.n=1,(0,f.Fx)();case 1:e=a.v,y(r=e||[]),t=Array.isArray(r)?r.reduce(function(e,r){var t,n,a=Number(null!==(t=r.price)&&void 0!==t?t:0),c=Number(null!==(n=r.quantity)&&void 0!==n?n:0);return Number.isFinite(a)&&Number.isFinite(c)?e+a*c:e},0):0,g(t),refreshAvailableCoupons(t),a.n=3;break;case 2:a.p=2,n=a.v,console.error("load cart for checkout failed",n);case 3:return a.a(2)}},_callee2,null,[[0,2]])}))).apply(this,arguments)}function refreshAvailableCoupons(e){return _refreshAvailableCoupons.apply(this,arguments)}function _refreshAvailableCoupons(){return(_refreshAvailableCoupons=(0,c.A)((0,a.A)().m(function _callee3(e){var r,t,n,c,o,i,u,l;return(0,a.A)().w(function(a){for(;;)switch(a.p=a.n){case 0:if(a.p=0,e&&!(e<=0)){a.n=1;break}return J("暂无可用优惠券"),K(void 0),W([]),a.a(2);case 1:return r=(0,s.JF)("current_store_id"),t=r?Number(r):void 0,n={"order_amount":String(e)},t&&Number.isFinite(t)&&t>0&&(n.store_id=t),a.n=2,(0,p.SK)(n);case 2:c=a.v,o=c.available||[],W(o),o.length>0?(i=o[0],u=buildCouponLabel(i),K(i.id),J("已自动选择：".concat(u))):(K(void 0),J("暂无可用优惠券")),a.n=4;break;case 3:a.p=3,l=a.v,console.error("load available coupons for order failed",l),J("优惠券加载失败，可稍后重试"),K(void 0),W([]);case 4:return a.a(2)}},_callee3,null,[[0,3]])}))).apply(this,arguments)}function _preloadAddress(){return(_preloadAddress=(0,c.A)((0,a.A)().m(function _callee4(){var e,r,t;return(0,a.A)().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,(0,v.OT)();case 1:(e=n.v)&&(r=e.full||(0,v.M0)(e))&&!k&&O(r),n.n=3;break;case 2:n.p=2,t=n.v,console.error("load default address failed",t);case 3:return n.a(2)}},_callee4,null,[[0,2]])}))).apply(this,arguments)}function buildCouponLabel(e){var r=e.coupon,t=r.name;return 1===r.type&&r.amount?t="".concat(r.name," - 满减¥").concat(r.amount):2===r.type&&r.discount&&(t="".concat(r.name," - 折扣").concat(r.discount)),t}function _handleSubmit(){return(_handleSubmit=(0,c.A)((0,a.A)().m(function _callee5(){var e,r,c,o,i,u,f,_,h,y,S,b,w,g,C,x,O;return(0,a.A)().w(function(a){for(;;)switch(a.p=a.n){case 0:if(t.length){a.n=1;break}return(0,l.P0)({"title":"购物车为空","icon":"none","duration":1500}),a.a(2);case 1:return P(!0),a.p=2,e=(0,s.JF)("current_store_id"),r=e?Number(e):void 0,c=(0,s.JF)("current_table_id"),o=c?Number(c):void 0,i=(0,s.JF)("current_table_no"),u=i?String(i).trim():void 0,f=!!u||!!o&&Number.isFinite(o)&&o>0,_=(0,m.j)({"storeId":r,"requireStoreId":!0}),h=(0,n.A)({"delivery_type":f?1:2,"address_info":k||void 0,"remark":I||void 0,"user_coupon_id":q,"store_id":r&&Number.isFinite(r)&&r>0?r:void 0,"order_type":f?2:void 0,"table_id":o&&Number.isFinite(o)&&o>0?o:void 0,"table_no":u||void 0},_),a.n=3,(0,p.X9)(h);case 3:if(y=a.v,!k.trim()){a.n=4;break}return a.n=4,(0,v.ns)({"full":k.trim(),"detail":k.trim(),"orderId":null==y?void 0:y.id,"orderNo":null==y?void 0:y.order_no,"updatedAt":(new Date).toISOString(),"timestamp":Date.now()});case 4:if(null==y||!y.id){a.n=10;break}return a.p=5,a.n=6,(0,A.v)(y.id);case 6:return S=a.v,a.n=7,(0,A.e)(S.payment_no);case 7:(0,l.P0)({"title":"支付成功（模拟）","icon":"success","duration":1500}),b=r&&Number.isFinite(r)&&r>0?r:void 0,w=b?"/pages/order-detail/index?id=".concat(y.id,"&store_id=").concat(b):"/pages/order-detail/index?id=".concat(y.id),d.Ay.navigateTo({"url":w}),a.n=9;break;case 8:a.p=8,x=a.v,console.error("unified order or callback failed",x),(0,l.P0)({"title":"下单成功，支付模拟失败","icon":"none","duration":2e3}),g=r&&Number.isFinite(r)&&r>0?r:void 0,C=g?"/pages/order-detail/index?id=".concat(y.id,"&store_id=").concat(g):"/pages/order-detail/index?id=".concat(y.id),d.Ay.navigateTo({"url":C});case 9:a.n=11;break;case 10:(0,l.P0)({"title":"下单成功","icon":"success","duration":1500});case 11:a.n=13;break;case 12:a.p=12,O=a.v,console.error("create order failed",O),(0,l.P0)({"title":"下单失败","icon":"none","duration":1500});case 13:return a.p=13,P(!1),a.f(13);case 14:return a.a(2)}},_callee5,null,[[5,8],[2,12,13,14]])}))).apply(this,arguments)}return(0,i.useEffect)(function(){!function fetchCart(){return _fetchCart.apply(this,arguments)}(),function preloadAddress(){return _preloadAddress.apply(this,arguments)}(),function loadCurrentStore(){return _loadCurrentStore.apply(this,arguments)}()},[]),(0,h.jsxs)(u.Ss,{"style":{"padding":12},"children":[ee&&(0,h.jsx)(u.Ss,{"style":{"marginBottom":8,"padding":"6px 10px","borderWidth":1,"borderStyle":"solid","borderColor":"#07c160","borderRadius":16,"display":"inline-block","backgroundColor":"#f6ffed"},"children":(0,h.jsxs)(u.EY,{"style":{"color":"#389e0d"},"children":["当前门店：",ee.name]})}),(0,h.jsx)(u.EY,{"style":{"fontSize":12,"color":"#999","marginBottom":8},"children":"温馨提示：如购物车含多门店商品，系统将自动拆分为多张订单。"}),(0,h.jsxs)(u.EY,{"children":["确认订单（共 ",t.length," 件）"]}),(0,h.jsxs)(u.EY,{"children":["金额（示意）: ",function calcTotal(){return w||t.length}()]}),(0,h.jsxs)(u.Ss,{"style":{"marginTop":8},"children":[(0,h.jsxs)(u.EY,{"children":["优惠券：",L]}),(0,h.jsx)(u.EY,{"style":{"fontSize":12,"color":"#999","marginTop":2},"children":"可点击下方按钮查看本单可用优惠券并手动选择"}),(0,h.jsxs)(u.Ss,{"style":{"marginTop":4,"display":"flex","flexDirection":"row","flexWrap":"wrap","gap":4},"children":[$.length>0&&(0,h.jsx)(u.$n,{"size":"mini","onClick":function onClick(){return H(function(e){return!e})},"type":"primary","children":G?"收起本单可用优惠券":"本单可用优惠券（".concat($.length,"）")}),q?(0,h.jsx)(u.$n,{"size":"mini","onClick":function onClick(){K(void 0),J("暂不使用优惠券")},"children":"不使用优惠券"}):null]}),G&&$.length>0&&(0,h.jsx)(u.Ss,{"style":{"marginTop":8},"children":$.map(function(e){var r=buildCouponLabel(e),t=e.id===q;return(0,h.jsx)(u.$n,{"size":"mini","type":t?"primary":"default","style":{"marginRight":8,"marginBottom":4},"onClick":function onClick(){K(e.id),J("已选择：".concat(r)),H(!1)},"children":r},e.id)})})]}),(0,h.jsxs)(u.Ss,{"style":{"marginTop":12},"children":[(0,h.jsx)(u.EY,{"children":"收货地址"}),(0,h.jsx)(u.pd,{"type":"text","placeholder":"请输入收货地址","value":k,"onInput":function onInput(e){return O(e.detail.value)}}),(0,h.jsx)(u.EY,{"style":{"fontSize":12,"color":"#999"},"children":"可在“我的-收货地址”设置默认地址"})]}),(0,h.jsxs)(u.Ss,{"style":{"marginTop":12},"children":[(0,h.jsx)(u.EY,{"children":"备注"}),(0,h.jsx)(u.pd,{"type":"text","placeholder":"可填写口味、送达时间等","value":I,"onInput":function onInput(e){return N(e.detail.value)}})]}),(0,h.jsx)(u.Ss,{"style":{"marginTop":16},"children":(0,h.jsx)(u.$n,{"type":"primary","disabled":B,"onClick":function handleSubmit(){return _handleSubmit.apply(this,arguments)},"children":B?"提交中...":"提交订单"})})]})}},"768":function(e,r,t){t.d(r,{"Fx":function(){return listCart},"SM":function(){return removeCartItem},"V2":function(){return updateCartItem},"bR":function(){return addCartItem}});var n=t(8646),a=t(6673),c=t(7356);function listCart(){return _listCart.apply(this,arguments)}function _listCart(){return(_listCart=(0,a.A)((0,n.A)().m(function _callee(){var e;return(0,n.A)().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,c.Ay.get("/api/v1/cart");case 1:return e=r.v,r.a(2,(0,c.Bm)(e))}},_callee)}))).apply(this,arguments)}function addCartItem(e,r,t){return _addCartItem.apply(this,arguments)}function _addCartItem(){return(_addCartItem=(0,a.A)((0,n.A)().m(function _callee2(e,r,t){var a;return(0,n.A)().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,c.Ay.post("/api/v1/cart/items",{"product_id":e,"sku_id":r,"quantity":t});case 1:return a=n.v,n.a(2,(0,c.Bm)(a))}},_callee2)}))).apply(this,arguments)}function updateCartItem(e,r){return _updateCartItem.apply(this,arguments)}function _updateCartItem(){return(_updateCartItem=(0,a.A)((0,n.A)().m(function _callee3(e,r){var t;return(0,n.A)().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,c.Ay.put("/api/v1/cart/items/".concat(e),{"quantity":r});case 1:return t=n.v,n.a(2,(0,c.Bm)(t))}},_callee3)}))).apply(this,arguments)}function removeCartItem(e){return _removeCartItem.apply(this,arguments)}function _removeCartItem(){return(_removeCartItem=(0,a.A)((0,n.A)().m(function _callee4(e){var r;return(0,n.A)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,c.Ay.delete("/api/v1/cart/items/".concat(e));case 1:return r=t.v,t.a(2,(0,c.Bm)(r))}},_callee4)}))).apply(this,arguments)}},"6287":function(e,r,t){t.d(r,{"Ad":function(){return confirmReceive},"MV":function(){return listOrders},"N4":function(){return cancelOrder},"SK":function(){return getAvailableCouponsForOrder},"Tg":function(){return payOrder},"X9":function(){return createOrderFromCart},"r$":function(){return getOrder}});var n=t(8646),a=t(6673),c=t(7356);function createOrderFromCart(e){return _createOrderFromCart.apply(this,arguments)}function _createOrderFromCart(){return(_createOrderFromCart=(0,a.A)((0,n.A)().m(function _callee(e){var r;return(0,n.A)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,c.Ay.post("/api/v1/orders/from-cart",e);case 1:return r=t.v,t.a(2,(0,c.Bm)(r))}},_callee)}))).apply(this,arguments)}function listOrders(){return _listOrders.apply(this,arguments)}function _listOrders(){return _listOrders=(0,a.A)((0,n.A)().m(function _callee2(){var e,r,t=arguments;return(0,n.A)().w(function(n){for(;;)switch(n.n){case 0:return e=t.length>0&&void 0!==t[0]?t[0]:{},n.n=1,c.Ay.get("/api/v1/orders",{"params":e});case 1:return r=n.v,n.a(2,(0,c.Bm)(r))}},_callee2)})),_listOrders.apply(this,arguments)}function getOrder(e){return _getOrder.apply(this,arguments)}function _getOrder(){return(_getOrder=(0,a.A)((0,n.A)().m(function _callee3(e){var r,t;return(0,n.A)().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,c.Ay.get("/api/v1/orders/".concat(e));case 1:return r=n.v,t=(0,c.Bm)(r),n.a(2,{"order":null==t?void 0:t.order,"items":Array.isArray(null==t?void 0:t.items)?t.items:[]})}},_callee3)}))).apply(this,arguments)}function cancelOrder(e,r){return _cancelOrder.apply(this,arguments)}function _cancelOrder(){return(_cancelOrder=(0,a.A)((0,n.A)().m(function _callee4(e,r){var t;return(0,n.A)().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,c.Ay.post("/api/v1/orders/".concat(e,"/cancel"),{"reason":r});case 1:t=n.v,(0,c.Bm)(t);case 2:return n.a(2)}},_callee4)}))).apply(this,arguments)}function payOrder(e){return _payOrder.apply(this,arguments)}function _payOrder(){return(_payOrder=(0,a.A)((0,n.A)().m(function _callee5(e){var r;return(0,n.A)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,c.Ay.post("/api/v1/orders/".concat(e,"/pay"));case 1:r=t.v,(0,c.Bm)(r);case 2:return t.a(2)}},_callee5)}))).apply(this,arguments)}function confirmReceive(e){return _confirmReceive.apply(this,arguments)}function _confirmReceive(){return(_confirmReceive=(0,a.A)((0,n.A)().m(function _callee6(e){var r;return(0,n.A)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,c.Ay.post("/api/v1/orders/".concat(e,"/receive"));case 1:r=t.v,(0,c.Bm)(r);case 2:return t.a(2)}},_callee6)}))).apply(this,arguments)}function getAvailableCouponsForOrder(e){return _getAvailableCouponsForOrder.apply(this,arguments)}function _getAvailableCouponsForOrder(){return(_getAvailableCouponsForOrder=(0,a.A)((0,n.A)().m(function _callee7(e){var r;return(0,n.A)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,c.Ay.post("/api/v1/orders/available-coupons",e);case 1:return r=t.v,t.a(2,(0,c.Bm)(r))}},_callee7)}))).apply(this,arguments)}},"5225":function(e,r,t){t.d(r,{"e":function(){return mockPayCallback},"v":function(){return createUnifiedOrder}});var n=t(8646),a=t(6673),c=t(7356);function createUnifiedOrder(e){return _createUnifiedOrder.apply(this,arguments)}function _createUnifiedOrder(){return(_createUnifiedOrder=(0,a.A)((0,n.A)().m(function _callee(e){var r;return(0,n.A)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,c.Ay.post("/api/v1/payments/unified-order",{"order_id":e,"method":1,"trade_type":"JSAPI","notify_url":""});case 1:return r=t.v,t.a(2,(0,c.Bm)(r))}},_callee)}))).apply(this,arguments)}function mockPayCallback(e){return _mockPayCallback.apply(this,arguments)}function _mockPayCallback(){return(_mockPayCallback=(0,a.A)((0,n.A)().m(function _callee2(e){var r;return(0,n.A)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,c.Ay.post("/api/v1/payment/mock-callback",{"payment_no":e});case 1:return r=t.v,t.a(2,(0,c.Bm)(r))}},_callee2)}))).apply(this,arguments)}},"9918":function(e,r,t){t.d(r,{"j":function(){return buildOrderShareAttributionParams}});var n=t(6244);function buildOrderShareAttributionParams(e){var r=function readPositiveIntFromStorage(e){try{var r=(0,n.JF)(e);if(null==r)return;var t=Number(r);if(!Number.isFinite(t)||t<=0)return;return Math.floor(t)}catch(e){return}}("referrer_id");if(!r)return{};var t=null==e?void 0:e.storeId,a=!!t&&Number.isFinite(t)&&t>0;return null!=e&&e.requireStoreId?a?{"sharer_uid":r,"share_store_id":t}:{}:{"sharer_uid":r,"share_store_id":a?t:0}}},"4088":function(e,r,t){t.d(r,{"EC":function(){return listStoreAccounts},"FS":function(){return listStoreFinanceTransactions},"KA":function(){return getStore},"KW":function(){return updateStoreAccount},"Rr":function(){return listStores},"gg":function(){return deleteStoreAccount},"iR":function(){return listStoreExclusiveProducts},"jE":function(){return exportStoreFinanceTransactions},"n9":function(){return createStoreAccount}});var n=t(8646),a=t(6673),c=t(7356);function listStores(){return _listStores.apply(this,arguments)}function _listStores(){return _listStores=(0,a.A)((0,n.A)().m(function _callee(){var e,r,t=arguments;return(0,n.A)().w(function(n){for(;;)switch(n.n){case 0:return e=t.length>0&&void 0!==t[0]?t[0]:{},n.n=1,c.Ay.get("/api/v1/stores",{"params":e});case 1:return r=n.v,n.a(2,(0,c.Bm)(r))}},_callee)})),_listStores.apply(this,arguments)}function getStore(e){return _getStore.apply(this,arguments)}function _getStore(){return(_getStore=(0,a.A)((0,n.A)().m(function _callee2(e){var r;return(0,n.A)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,c.Ay.get("/api/v1/stores/".concat(e));case 1:return r=t.v,t.a(2,(0,c.Bm)(r))}},_callee2)}))).apply(this,arguments)}function listStoreExclusiveProducts(e){return _listStoreExclusiveProducts.apply(this,arguments)}function _listStoreExclusiveProducts(){return _listStoreExclusiveProducts=(0,a.A)((0,n.A)().m(function _callee3(e){var r,t,a=arguments;return(0,n.A)().w(function(n){for(;;)switch(n.n){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},n.n=1,c.Ay.get("/api/v1/stores/".concat(e,"/exclusive-products"),{"params":r});case 1:return t=n.v,n.a(2,(0,c.Bm)(t))}},_callee3)})),_listStoreExclusiveProducts.apply(this,arguments)}function listStoreAccounts(e){return _listStoreAccounts.apply(this,arguments)}function _listStoreAccounts(){return(_listStoreAccounts=(0,a.A)((0,n.A)().m(function _callee4(e){var r;return(0,n.A)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,c.Ay.get("/api/v1/stores/".concat(e,"/accounts"));case 1:return r=t.v,t.a(2,(0,c.Bm)(r))}},_callee4)}))).apply(this,arguments)}function createStoreAccount(e,r){return _createStoreAccount.apply(this,arguments)}function _createStoreAccount(){return(_createStoreAccount=(0,a.A)((0,n.A)().m(function _callee5(e,r){var t;return(0,n.A)().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,c.Ay.post("/api/v1/stores/".concat(e,"/accounts"),r);case 1:return t=n.v,n.a(2,(0,c.Bm)(t))}},_callee5)}))).apply(this,arguments)}function updateStoreAccount(e,r,t){return _updateStoreAccount.apply(this,arguments)}function _updateStoreAccount(){return(_updateStoreAccount=(0,a.A)((0,n.A)().m(function _callee6(e,r,t){var a;return(0,n.A)().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,c.Ay.put("/api/v1/stores/".concat(e,"/accounts/").concat(r),t);case 1:return a=n.v,n.a(2,(0,c.Bm)(a))}},_callee6)}))).apply(this,arguments)}function deleteStoreAccount(e,r){return _deleteStoreAccount.apply(this,arguments)}function _deleteStoreAccount(){return(_deleteStoreAccount=(0,a.A)((0,n.A)().m(function _callee7(e,r){var t;return(0,n.A)().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,c.Ay.delete("/api/v1/stores/".concat(e,"/accounts/").concat(r));case 1:return t=n.v,n.a(2,(0,c.Bm)(t))}},_callee7)}))).apply(this,arguments)}function listStoreFinanceTransactions(e){return _listStoreFinanceTransactions.apply(this,arguments)}function _listStoreFinanceTransactions(){return _listStoreFinanceTransactions=(0,a.A)((0,n.A)().m(function _callee8(e){var r,t,a=arguments;return(0,n.A)().w(function(n){for(;;)switch(n.n){case 0:return r=a.length>1&&void 0!==a[1]?a[1]:{},n.n=1,c.Ay.get("/api/v1/stores/".concat(e,"/finance/transactions"),{"params":r});case 1:return t=n.v,n.a(2,(0,c.Bm)(t))}},_callee8)})),_listStoreFinanceTransactions.apply(this,arguments)}function exportStoreFinanceTransactions(e){return _exportStoreFinanceTransactions.apply(this,arguments)}function _exportStoreFinanceTransactions(){return _exportStoreFinanceTransactions=(0,a.A)((0,n.A)().m(function _callee9(e){var r,t=arguments;return(0,n.A)().w(function(n){for(;;)switch(n.n){case 0:return r=t.length>1&&void 0!==t[1]?t[1]:{},n.n=1,c.Ay.get("/api/v1/stores/".concat(e,"/finance/transactions/export"),{"params":r,"responseType":"blob"});case 1:return n.a(2)}},_callee9)})),_exportStoreFinanceTransactions.apply(this,arguments)}},"5219":function(e,r,t){t.d(r,{"M0":function(){return formatAddress},"OT":function(){return loadDefaultAddress},"es":function(){return parseAddressInfo},"ns":function(){return saveDefaultAddress}});var n=t(8646),a=t(6045),c=t(6673),o=t(3846),i=t(6244),u=t(7356);function fetchDefaultAddress(){return _fetchDefaultAddress.apply(this,arguments)}function _fetchDefaultAddress(){return(_fetchDefaultAddress=(0,c.A)((0,n.A)().m(function _callee(){var e;return(0,n.A)().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,u.Ay.get("/api/v1/user/default-address");case 1:return e=r.v,r.a(2,(0,u.Bm)(e))}},_callee)}))).apply(this,arguments)}function updateDefaultAddress(e){return _updateDefaultAddress.apply(this,arguments)}function _updateDefaultAddress(){return(_updateDefaultAddress=(0,c.A)((0,n.A)().m(function _callee2(e){var r;return(0,n.A)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,u.Ay.put("/api/v1/user/default-address",{"address":e});case 1:return r=t.v,t.a(2,(0,u.Bm)(r))}},_callee2)}))).apply(this,arguments)}var s="tea_default_address";function parseAddressInfo(e){if(!e)return null;var r=e;if("string"==typeof r){var t=r.trim();if(!t)return null;try{r=JSON.parse(t)}catch(e){return{"detail":t,"full":t}}}if("object"===(0,o.A)(r)&&null!==r){var n=r.name||r.contact||r.receiver||r.consignee||r.userName,a=r.phone||r.mobile||r.tel||r.telNumber,c=[r.province,r.city,r.county,r.area,r.street,r.detail,r.detailInfo,r.address,r.full].filter(function(e){return"string"==typeof e&&e.trim().length>0}).map(function(e){return e.trim()}),i=r.detail||r.detailInfo||r.address||c.join(""),u=r.full||i||c.join("");return{"contact":n,"phone":a,"detail":i||u,"full":u||i}}return null}function formatAddress(e){return e?[e.contact,e.phone,e.detail||e.full].filter(function(e){return!!e}).join(" · "):""}function loadLocalDefaultAddress(){return _loadLocalDefaultAddress.apply(this,arguments)}function _loadLocalDefaultAddress(){return(_loadLocalDefaultAddress=(0,c.A)((0,n.A)().m(function _callee(){var e;return(0,n.A)().w(function(r){for(;;)switch(r.p=r.n){case 0:return r.p=0,r.n=1,(0,i.c7)({"key":s});case 1:return e=r.v,r.a(2,e.data);case 2:return r.p=2,r.v,r.a(2,null)}},_callee,null,[[0,2]])}))).apply(this,arguments)}function saveLocalDefaultAddress(e){return _saveLocalDefaultAddress.apply(this,arguments)}function _saveLocalDefaultAddress(){return(_saveLocalDefaultAddress=(0,c.A)((0,n.A)().m(function _callee2(e){return(0,n.A)().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,(0,i.cT)({"key":s,"data":e});case 1:return r.a(2)}},_callee2)}))).apply(this,arguments)}function toStoredAddress(e,r){var t=parseAddressInfo(e);if(!t)return null;var n=(0,a.A)((0,a.A)({},t),{},{"full":t.full||t.detail,"detail":t.detail||t.full,"updatedAt":null==r?void 0:r.updatedAt,"timestamp":Date.now(),"source":null==r?void 0:r.source});if(e&&"object"===(0,o.A)(e)){var c=e;c.orderId&&(n.orderId=Number(c.orderId)),c.orderNo&&(n.orderNo=String(c.orderNo))}return n}function fetchRemoteDefaultAddress(){return _fetchRemoteDefaultAddress.apply(this,arguments)}function _fetchRemoteDefaultAddress(){return(_fetchRemoteDefaultAddress=(0,c.A)((0,n.A)().m(function _callee3(){var e;return(0,n.A)().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,fetchDefaultAddress();case 1:if(null!=(e=r.v)&&e.address){r.n=2;break}return r.a(2,null);case 2:return r.a(2,toStoredAddress(e.address,{"updatedAt":e.updated_at||void 0,"source":"server"}))}},_callee3)}))).apply(this,arguments)}function loadDefaultAddress(e){return _loadDefaultAddress.apply(this,arguments)}function _loadDefaultAddress(){return(_loadDefaultAddress=(0,c.A)((0,n.A)().m(function _callee4(e){var r,t;return(0,n.A)().w(function(n){for(;;)switch(n.p=n.n){case 0:if(!1===(null==e?void 0:e.refreshRemote)){n.n=6;break}return n.p=1,n.n=2,fetchRemoteDefaultAddress();case 2:if(!(r=n.v)){n.n=4;break}return n.n=3,saveLocalDefaultAddress(r);case 3:return n.a(2,r);case 4:n.n=6;break;case 5:n.p=5,t=n.v,console.error("load remote default address failed",t);case 6:return n.a(2,loadLocalDefaultAddress())}},_callee4,null,[[1,5]])}))).apply(this,arguments)}function saveDefaultAddress(e,r){return _saveDefaultAddress.apply(this,arguments)}function _saveDefaultAddress(){return(_saveDefaultAddress=(0,c.A)((0,n.A)().m(function _callee5(e,r){var t,c;return(0,n.A)().w(function(n){for(;;)switch(n.p=n.n){case 0:return t=(0,a.A)((0,a.A)({},e),{},{"timestamp":Date.now()}),n.n=1,saveLocalDefaultAddress(t);case 1:if(!1!==(null==r?void 0:r.syncRemote)){n.n=2;break}return n.a(2);case 2:return n.p=2,n.n=3,updateDefaultAddress({"contact":t.contact,"phone":t.phone,"detail":t.detail,"full":t.full,"orderId":t.orderId,"orderNo":t.orderNo,"updatedAt":t.updatedAt||(new Date).toISOString()});case 3:n.n=5;break;case 4:n.p=4,c=n.v,console.error("sync default address to server failed",c);case 5:return n.a(2)}},_callee5,null,[[2,4]])}))).apply(this,arguments)}}}]);