"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[501],{"8870":function(n,e,t){t.d(e,{"I8":function(){return i},"cr":function(){return s},"gT":function(){return o},"i5":function(){return r},"os":function(){return c},"vY":function(){return a}});var r="提示：设为当前门店仅用于筛选/浏览，您暂无门店管理权限",o="当前为只读模式，您暂无门店收款账户权限",c="当前为只读模式，您暂无门店财务权限",a="暂无门店管理权限",i="暂无门店收款账户权限",s="暂无门店财务权限"},"228":function(n,e,t){t.d(e,{"A":function(){return usePermission}});var r=t(8646),o=t(6673),c=t(9866),a=t(7378),i=t(4368);function usePermission(){var n=(0,a.useState)(null),e=(0,c.A)(n,2),t=e[0],s=e[1],u=(0,a.useState)(!0),l=(0,c.A)(u,2),d=l[0],p=l[1],f=(0,a.useCallback)((0,o.A)((0,r.A)().m(function _callee(){var n;return(0,r.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return p(!0),e.p=1,e.n=2,(0,i.$)();case 2:n=e.v,s((null==n?void 0:n.user)||null),e.n=4;break;case 3:e.p=3,e.v,s(null);case 4:return e.p=4,p(!1),e.f(4);case 5:return e.a(2)}},_callee,null,[[1,3,4,5]])})),[]);(0,a.useEffect)(function(){f()},[f]);var v=((null==t?void 0:t.role)||"").toLowerCase(),A=!!v&&v.includes("admin"),S=!!v&&(v.includes("admin")||v.includes("store:accounts")||v.includes("store")),m=!!v&&(v.includes("admin")||v.includes("store:finance")||v.includes("store"));return{"user":t,"role":v,"loading":d,"isAdmin":A,"allowedStoreMgmt":S||m,"allowedStoreAccounts":S,"allowedStoreFinance":m,"canManageStores":function canManageStores(n){var e=((null==n?void 0:n.role)||v||"").toLowerCase();return!!e&&(e.includes("admin")||e.includes("store"))},"canManageStoreAccounts":function canManageStoreAccounts(n){var e=((null==n?void 0:n.role)||v||"").toLowerCase();return!!e&&(e.includes("admin")||e.includes("store:accounts")||e.includes("store"))},"canManageStoreFinance":function canManageStoreFinance(n){var e=((null==n?void 0:n.role)||v||"").toLowerCase();return!!e&&(e.includes("admin")||e.includes("store:finance")||e.includes("store"))},"refresh":f}}},"9501":function(n,e,t){t.r(e),t.d(e,{"default":function(){return StoresPage}});var r=t(8646),o=t(6673),c=t(9866),a=t(7378),i=t(4657),s=t(9624),u=t(8785),l=t(6244),d=t(4088),p=t(228),f=t(8870),v=t(6106);function StoresPage(){var n=(0,p.A)(),e=(0,a.useState)([]),t=(0,c.A)(e,2),A=t[0],S=t[1],m=(0,a.useState)(!1),y=(0,c.A)(m,2),_=y[0],h=y[1];function _fetchStores(){return(_fetchStores=(0,o.A)((0,r.A)().m(function _callee(){var n,e,t,o;return(0,r.A)().w(function(r){for(;;)switch(r.p=r.n){case 0:return h(!0),r.p=1,r.n=2,(0,d.Rr)({"page":1,"limit":50});case 2:n=r.v,e=n,t=Array.isArray(null==e?void 0:e.data)?e.data:Array.isArray(null==e?void 0:e.items)?e.items:Array.isArray(e)?e:[],S(t),r.n=4;break;case 3:r.p=3,o=r.v,console.error("load stores failed",o),(0,s.P0)({"title":"加载门店失败","icon":"none"});case 4:return r.p=4,h(!1),r.f(4);case 5:return r.a(2)}},_callee,null,[[1,3,4,5]])}))).apply(this,arguments)}return(0,a.useEffect)(function(){!function fetchStores(){return _fetchStores.apply(this,arguments)}()},[]),(0,v.jsxs)(i.Ss,{"style":{"padding":12},"children":[(0,v.jsx)(i.EY,{"style":{"fontSize":16,"fontWeight":"bold"},"children":"门店列表"}),!n.allowedStoreMgmt&&(0,v.jsx)(i.EY,{"style":{"display":"block","marginTop":6,"color":"#999"},"children":f.i5}),_&&(0,v.jsx)(i.EY,{"style":{"display":"block","marginTop":8},"children":"加载中..."}),!_&&!A.length&&(0,v.jsx)(i.EY,{"style":{"display":"block","marginTop":8},"children":"暂无门店"}),A.map(function(e){return(0,v.jsxs)(i.Ss,{"style":{"marginTop":12,"paddingBottom":8,"borderBottom":"1px solid #eee"},"children":[(0,v.jsx)(i.EY,{"style":{"display":"block","fontSize":16},"children":e.name}),e.address&&(0,v.jsxs)(i.EY,{"style":{"display":"block","color":"#666"},"children":["地址：",e.address]}),(0,v.jsxs)(i.Ss,{"style":{"marginTop":8,"display":"flex","gap":8},"children":[(0,v.jsx)(i.$n,{"size":"mini","type":"primary","onClick":function onClick(){return function goDetail(n){u.Ay.navigateTo({"url":"/pages/store-detail/index?store_id=".concat(n)})}(e.id)},"children":"查看详情"}),(0,v.jsx)(i.$n,{"size":"mini","onClick":function onClick(){return function setCurrent(e){try{(0,l.$c)("current_store_id",String(e))}catch(n){}var t=n.allowedStoreFinance;n.allowedStoreMgmt?(0,s.P0)({"title":t?"已设为当前门店，可在财务页使用":"已设为当前门店（财务页需权限）","icon":t?"success":"none"}):(0,s.P0)({"title":"已设为当前门店（仅用于前端上下文），财务页需权限","icon":"none"})}(e.id)},"children":"设为当前门店"}),(0,v.jsx)(i.$n,{"size":"mini","onClick":function onClick(){n.allowedStoreFinance?u.Ay.navigateTo({"url":"/pages/store-finance/index?store_id=".concat(e.id)}):(0,s.P0)({"title":f.cr,"icon":"none"})},"children":"财务流水"}),!n.allowedStoreFinance&&(0,v.jsx)(i.EY,{"style":{"color":"#999","fontSize":12},"children":"（需权限）"})]})]},e.id)})]})}},"4368":function(n,e,t){t.d(e,{"$":function(){return getMeSummary}});var r=t(8646),o=t(3846),c=t(6673),a=t(7356);function getMeSummary(){return _getMeSummary.apply(this,arguments)}function _getMeSummary(){return(_getMeSummary=(0,c.A)((0,r.A)().m(function _callee(){var n,e,t,c,i,s,u,l,d,p,f,v,A,S,m,y,_,h,g,w,b,x;return(0,r.A)().w(function(r){for(;;)switch(r.p=r.n){case 0:return r.p=0,r.n=1,a.Ay.get("/api/v1/users/me/summary");case 1:if(n=r.v,!(e=(0,a.Bm)(n))||"object"!==(0,o.A)(e)){r.n=6;break}if(!e.user||"object"!==(0,o.A)(e.user)){r.n=2;break}return r.a(2,e);case 2:if(void 0===(i=null!==(t=null!==(c=e.user_id)&&void 0!==c?c:e.uid)&&void 0!==t?t:e.id)){r.n=3;break}return l={"id":Number(i)||0,"nickname":null!==(s=null!==(u=e.nickname)&&void 0!==u?u:e.name)&&void 0!==s?s:"","phone":e.phone,"avatar":e.avatar,"role":e.role||"user"},d=e.wallet_balance,p={"balance_cents":"number"==typeof d?Math.round(100*d):void 0},f={"balance":"number"==typeof e.points?e.points:void 0},v={"available_count":"number"==typeof e.coupons?e.coupons:void 0},r.a(2,{"user":l,"wallet":p,"points":f,"coupons":v});case 3:return r.p=3,r.n=4,a.Ay.get("/api/v1/user/info");case 4:return _=r.v,h=(0,a.Bm)(_),g={"id":Number(null!==(A=null!==(S=h.id)&&void 0!==S?S:h.uid)&&void 0!==A?A:0)||0,"nickname":null!==(m=null!==(y=h.nickname)&&void 0!==y?y:h.name)&&void 0!==m?m:"","phone":h.phone,"avatar":h.avatar,"role":h.role||"user"},r.a(2,{"user":g});case 5:r.p=5,r.v;case 6:return r.a(2,e);case 7:return r.p=7,x=r.v,r.p=8,r.n=9,a.Ay.get("/api/v1/user/info");case 9:return w=r.v,b=(0,a.Bm)(w),r.a(2,{"user":{"id":null==b?void 0:b.id,"uid":null==b?void 0:b.uid,"open_id":null==b?void 0:b.open_id,"nickname":null==b?void 0:b.nickname,"avatar":null==b?void 0:b.avatar,"phone":null==b?void 0:b.phone,"gender":null==b?void 0:b.gender,"balance":null==b?void 0:b.balance,"points":null==b?void 0:b.points,"role":null==b?void 0:b.role},"wallet":{"balance_cents":"number"==typeof(null==b?void 0:b.balance)?Math.round(100*b.balance):void 0},"points":{"balance":null==b?void 0:b.points}});case 10:throw r.p=10,r.v,x;case 11:return r.a(2)}},_callee,null,[[8,10],[3,5],[0,7]])}))).apply(this,arguments)}},"4088":function(n,e,t){t.d(e,{"EC":function(){return listStoreAccounts},"FS":function(){return listStoreFinanceTransactions},"KA":function(){return getStore},"KW":function(){return updateStoreAccount},"Rr":function(){return listStores},"gg":function(){return deleteStoreAccount},"iR":function(){return listStoreExclusiveProducts},"jE":function(){return exportStoreFinanceTransactions},"n9":function(){return createStoreAccount}});var r=t(8646),o=t(6673),c=t(7356);function listStores(){return _listStores.apply(this,arguments)}function _listStores(){return _listStores=(0,o.A)((0,r.A)().m(function _callee(){var n,e,t=arguments;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return n=t.length>0&&void 0!==t[0]?t[0]:{},r.n=1,c.Ay.get("/api/v1/stores",{"params":n});case 1:return e=r.v,r.a(2,(0,c.Bm)(e))}},_callee)})),_listStores.apply(this,arguments)}function getStore(n){return _getStore.apply(this,arguments)}function _getStore(){return(_getStore=(0,o.A)((0,r.A)().m(function _callee2(n){var e;return(0,r.A)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,c.Ay.get("/api/v1/stores/".concat(n));case 1:return e=t.v,t.a(2,(0,c.Bm)(e))}},_callee2)}))).apply(this,arguments)}function listStoreExclusiveProducts(n){return _listStoreExclusiveProducts.apply(this,arguments)}function _listStoreExclusiveProducts(){return _listStoreExclusiveProducts=(0,o.A)((0,r.A)().m(function _callee3(n){var e,t,o=arguments;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return e=o.length>1&&void 0!==o[1]?o[1]:{},r.n=1,c.Ay.get("/api/v1/stores/".concat(n,"/exclusive-products"),{"params":e});case 1:return t=r.v,r.a(2,(0,c.Bm)(t))}},_callee3)})),_listStoreExclusiveProducts.apply(this,arguments)}function listStoreAccounts(n){return _listStoreAccounts.apply(this,arguments)}function _listStoreAccounts(){return(_listStoreAccounts=(0,o.A)((0,r.A)().m(function _callee4(n){var e;return(0,r.A)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,c.Ay.get("/api/v1/stores/".concat(n,"/accounts"));case 1:return e=t.v,t.a(2,(0,c.Bm)(e))}},_callee4)}))).apply(this,arguments)}function createStoreAccount(n,e){return _createStoreAccount.apply(this,arguments)}function _createStoreAccount(){return(_createStoreAccount=(0,o.A)((0,r.A)().m(function _callee5(n,e){var t;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,c.Ay.post("/api/v1/stores/".concat(n,"/accounts"),e);case 1:return t=r.v,r.a(2,(0,c.Bm)(t))}},_callee5)}))).apply(this,arguments)}function updateStoreAccount(n,e,t){return _updateStoreAccount.apply(this,arguments)}function _updateStoreAccount(){return(_updateStoreAccount=(0,o.A)((0,r.A)().m(function _callee6(n,e,t){var o;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,c.Ay.put("/api/v1/stores/".concat(n,"/accounts/").concat(e),t);case 1:return o=r.v,r.a(2,(0,c.Bm)(o))}},_callee6)}))).apply(this,arguments)}function deleteStoreAccount(n,e){return _deleteStoreAccount.apply(this,arguments)}function _deleteStoreAccount(){return(_deleteStoreAccount=(0,o.A)((0,r.A)().m(function _callee7(n,e){var t;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,c.Ay.delete("/api/v1/stores/".concat(n,"/accounts/").concat(e));case 1:return t=r.v,r.a(2,(0,c.Bm)(t))}},_callee7)}))).apply(this,arguments)}function listStoreFinanceTransactions(n){return _listStoreFinanceTransactions.apply(this,arguments)}function _listStoreFinanceTransactions(){return _listStoreFinanceTransactions=(0,o.A)((0,r.A)().m(function _callee8(n){var e,t,o=arguments;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return e=o.length>1&&void 0!==o[1]?o[1]:{},r.n=1,c.Ay.get("/api/v1/stores/".concat(n,"/finance/transactions"),{"params":e});case 1:return t=r.v,r.a(2,(0,c.Bm)(t))}},_callee8)})),_listStoreFinanceTransactions.apply(this,arguments)}function exportStoreFinanceTransactions(n){return _exportStoreFinanceTransactions.apply(this,arguments)}function _exportStoreFinanceTransactions(){return _exportStoreFinanceTransactions=(0,o.A)((0,r.A)().m(function _callee9(n){var e,t=arguments;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return e=t.length>1&&void 0!==t[1]?t[1]:{},r.n=1,c.Ay.get("/api/v1/stores/".concat(n,"/finance/transactions/export"),{"params":e,"responseType":"blob"});case 1:return r.a(2)}},_callee9)})),_exportStoreFinanceTransactions.apply(this,arguments)}}}]);