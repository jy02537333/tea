"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[716],{"2716":function(e,t,n){n.r(t),n.d(t,{"default":function(){return ActivitiesPage}});var r=n(6045),i=n(8646),a=n(6673),c=n(9866),o=n(7378),s=n(4657),u=n(1473),l=n(6244),d=n(9624),p=n(8785),f=n(7356);function listActivities(e){return _listActivities.apply(this,arguments)}function _listActivities(){return(_listActivities=(0,a.A)((0,i.A)().m(function _callee(e){var t;return(0,i.A)().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,f.Ay.get("/api/v1/activities",{"params":e});case 1:return t=n.v,n.a(2,(0,f.Bm)(t))}},_callee)}))).apply(this,arguments)}function registerActivityWithOrder(e,t){return _registerActivityWithOrder.apply(this,arguments)}function _registerActivityWithOrder(){return(_registerActivityWithOrder=(0,a.A)((0,i.A)().m(function _callee3(e,t){var n;return(0,i.A)().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,f.Ay.post("/api/v1/activities/".concat(e,"/register-with-order"),t);case 1:return n=r.v,r.a(2,(0,f.Bm)(n))}},_callee3)}))).apply(this,arguments)}var v=n(5225),A=n(4088),h=n(9918),_=n(6106);function ActivitiesPage(){var e=(0,o.useState)(void 0),t=(0,c.A)(e,2),n=t[0],f=t[1],m=(0,o.useState)([]),y=(0,c.A)(m,2),S=y[0],g=y[1],b=(0,o.useState)(!1),x=(0,c.A)(b,2),w=x[0],k=x[1],j=(0,o.useState)(""),P=(0,c.A)(j,2),T=P[0],N=P[1],E=(0,o.useState)(""),F=(0,c.A)(E,2),I=F[0],C=F[1],B=(0,o.useState)(null),O=(0,c.A)(B,2),R=O[0],W=O[1],Y=(0,o.useState)(""),J=(0,c.A)(Y,2),U=J[0],z=J[1],K=(0,o.useState)(null),q=(0,c.A)(K,2),$=q[0],M=q[1],D=(0,o.useState)(!1),G=(0,c.A)(D,2),H=G[0],L=G[1],Q=(0,o.useState)(!1),V=(0,c.A)(Q,2),X=V[0],Z=V[1],ee=(0,o.useState)(null),te=(0,c.A)(ee,2),ne=te[0],re=te[1];function _fetchActivities(){return(_fetchActivities=(0,a.A)((0,i.A)().m(function _callee(e){var t,n,r,a;return(0,i.A)().w(function(i){for(;;)switch(i.p=i.n){case 0:return k(!0),i.p=1,i.n=2,listActivities({"store_id":e});case 2:t=i.v,n=[],r=t,Array.isArray(null==r?void 0:r.data)?n=r.data:Array.isArray(null==r?void 0:r.items)?n=r.items:Array.isArray(r)&&(n=r),g(n),i.n=4;break;case 3:i.p=3,a=i.v,console.error("load activities failed",a),(0,d.P0)({"title":"活动加载失败","icon":"none"});case 4:return i.p=4,k(!1),i.f(4);case 5:return i.a(2)}},_callee,null,[[1,3,4,5]])}))).apply(this,arguments)}(0,o.useEffect)(function(){var e,t,n,r,i,a,c,o,s=(0,u.nI)().router,p=null==s||null===(e=s.params)||void 0===e?void 0:e.store_id,v=(null==s||null===(t=s.params)||void 0===t?void 0:t.name)||"",A=(null==s||null===(n=s.params)||void 0===n?void 0:n.phone)||"",h=(null==s||null===(r=s.params)||void 0===r?void 0:r.fee)||"",_="1"===(null==s||null===(i=s.params)||void 0===i?void 0:i.auto),m=null!=s&&null!==(a=s.params)&&void 0!==a&&a.activity_id?Number(null==s||null===(c=s.params)||void 0===c?void 0:c.activity_id):NaN;if(v&&N(v),A&&C(A),h&&z(h),_&&Z(!0),!Number.isNaN(m)&&m>0&&re(m),p){var y=Number(p);!Number.isNaN(y)&&y>0&&(o=y)}if(!o)try{var S=(0,l.JF)("current_store_id"),g=Number(S);Number.isFinite(g)&&g>0&&(o=g)}catch(e){}o?(f(o),function fetchActivities(e){return _fetchActivities.apply(this,arguments)}(o),function fetchStoreInfo(e){return _fetchStoreInfo.apply(this,arguments)}(o)):(0,d.P0)({"title":"缺少门店信息，请从门店列表进入","icon":"none"})},[]),(0,o.useEffect)(function(){var e;if(X&&!H&&0!==S.length){var t=ne||(null===(e=S[0])||void 0===e?void 0:e.id);t&&(L(!0),handleRegister(t))}},[X,H,S,ne]);var ie=(0,o.useState)(null),ae=(0,c.A)(ie,2),ce=ae[0],oe=ae[1];function _fetchStoreInfo(){return(_fetchStoreInfo=(0,a.A)((0,i.A)().m(function _callee2(e){var t;return(0,i.A)().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,(0,A.KA)(e);case 1:t=n.v,oe(t),n.n=3;break;case 2:n.p=2,n.v;case 3:return n.a(2)}},_callee2,null,[[0,2]])}))).apply(this,arguments)}function handleRegister(e){return _handleRegister.apply(this,arguments)}function _handleRegister(){return(_handleRegister=(0,a.A)((0,i.A)().m(function _callee3(e){var t,a,c,o,s,u,l,p,f;return(0,i.A)().w(function(i){for(;;)switch(i.p=i.n){case 0:if(n){i.n=1;break}return(0,d.P0)({"title":"缺少门店信息","icon":"none"}),i.a(2);case 1:if(T.trim()){i.n=2;break}return(0,d.P0)({"title":"请输入姓名","icon":"none"}),i.a(2);case 2:if(I.trim()){i.n=3;break}return(0,d.P0)({"title":"请输入手机号","icon":"none"}),i.a(2);case 3:if(t=U.trim()?Number(U.trim()):0,!(Number.isNaN(t)||t<0)){i.n=4;break}return(0,d.P0)({"title":"报名费用格式错误","icon":"none"}),i.a(2);case 4:return W(e),i.p=5,a=(0,h.j)({"storeId":n,"requireStoreId":!0}),i.n=6,registerActivityWithOrder(e,(0,r.A)({"name":T.trim(),"phone":I.trim(),"fee":t},a));case 6:if(c=i.v,(o=null==c?void 0:c.order)&&0!==Number(o.pay_amount)||(M(e),(0,d.P0)({"title":"报名成功","icon":"success"})),!(o&&Number(o.pay_amount)>0)){i.n=12;break}return i.p=7,i.n=8,(0,v.v)(o.id);case 8:if(null==(s=i.v)||!s.payment_no){i.n=10;break}return i.n=9,(0,v.e)(s.payment_no);case 9:M(e),(0,d.P0)({"title":"报名并支付成功","icon":"success"});case 10:i.n=12;break;case 11:i.p=11,p=i.v,console.error("pay activity order failed",p),(0,d.P0)({"title":"支付失败，请稍后重试","icon":"none"});case 12:i.n=14;break;case 13:i.p=13,f=i.v,console.error("register activity failed",f),l=(null==f||null===(u=f.response)||void 0===u||null===(u=u.data)||void 0===u?void 0:u.message)||"报名失败，请稍后重试",(0,d.P0)({"title":l,"icon":"none"});case 14:return i.p=14,W(null),N(""),C(""),i.f(14);case 15:return i.a(2)}},_callee3,null,[[7,11],[5,13,14,15]])}))).apply(this,arguments)}return(0,_.jsxs)(s.Ss,{"style":{"padding":12},"children":[ce&&(0,_.jsx)(s.Ss,{"style":{"marginBottom":8,"padding":"6px 10px","borderWidth":1,"borderStyle":"solid","borderColor":"#07c160","borderRadius":16,"display":"inline-block","backgroundColor":"#f6ffed"},"children":(0,_.jsxs)(s.EY,{"style":{"color":"#389e0d"},"children":["当前门店：",ce.name]})}),(0,_.jsx)(s.Ss,{"style":{"marginBottom":8},"children":(0,_.jsx)(s.$n,{"size":"mini","onClick":function onClick(){return p.Ay.navigateTo({"url":"/pages/stores/index"})},"children":"切换门店"})}),(0,_.jsx)(s.EY,{"style":{"fontSize":18,"fontWeight":"bold"},"children":"活动报名"}),(0,_.jsxs)(s.Ss,{"style":{"marginTop":12},"children":[(0,_.jsx)(s.EY,{"children":"姓名"}),(0,_.jsx)(s.pd,{"placeholder":"请输入姓名","value":T,"onInput":function onInput(e){return N(e.detail.value)}})]}),(0,_.jsxs)(s.Ss,{"style":{"marginTop":12},"children":[(0,_.jsx)(s.EY,{"children":"手机号"}),(0,_.jsx)(s.pd,{"placeholder":"请输入手机号","value":I,"onInput":function onInput(e){return C(e.detail.value)}})]}),(0,_.jsxs)(s.Ss,{"style":{"marginTop":12},"children":[(0,_.jsx)(s.EY,{"children":"报名费用（元，可选）"}),(0,_.jsx)(s.pd,{"placeholder":"不填则视为免费活动","value":U,"onInput":function onInput(e){return z(e.detail.value)}})]}),(0,_.jsxs)(s.Ss,{"style":{"marginTop":16},"children":[w&&(0,_.jsx)(s.EY,{"children":"活动加载中..."}),!w&&0===S.length&&(0,_.jsx)(s.EY,{"children":"当前门店暂无可报名活动"}),S.map(function(e){return(0,_.jsxs)(s.Ss,{"style":{"marginTop":12,"padding":12,"borderRadius":8,"borderWidth":1,"borderStyle":"solid","borderColor":"#eee"},"children":[(0,_.jsx)(s.EY,{"style":{"fontSize":16,"fontWeight":"bold"},"children":e.name}),$===e.id&&(0,_.jsx)(s.Ss,{"style":{"marginTop":4,"display":"inline-block","padding":"2px 8px","backgroundColor":"#f6ffed","borderRadius":12,"borderWidth":1,"borderStyle":"solid","borderColor":"#b7eb8f"},"children":(0,_.jsx)(s.EY,{"style":{"color":"#389e0d"},"children":"已报名成功"})}),(0,_.jsx)(s.Ss,{"style":{"marginTop":4},"children":(0,_.jsxs)(s.EY,{"children":["时间：",e.start_time," - ",e.end_time]})}),e.description&&(0,_.jsx)(s.Ss,{"style":{"marginTop":4},"children":(0,_.jsxs)(s.EY,{"children":["说明：",e.description]})}),(0,_.jsx)(s.$n,{"style":{"marginTop":8},"type":"primary","loading":R===e.id,"onClick":function onClick(){return handleRegister(e.id)},"children":R===e.id?"报名中...":U.trim()&&Number(U)>0?"报名并支付":"报名参加"})]},e.id)})]})]})}},"5225":function(e,t,n){n.d(t,{"e":function(){return mockPayCallback},"v":function(){return createUnifiedOrder}});var r=n(8646),i=n(6673),a=n(7356);function createUnifiedOrder(e){return _createUnifiedOrder.apply(this,arguments)}function _createUnifiedOrder(){return(_createUnifiedOrder=(0,i.A)((0,r.A)().m(function _callee(e){var t;return(0,r.A)().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,a.Ay.post("/api/v1/payments/unified-order",{"order_id":e,"method":1,"trade_type":"JSAPI","notify_url":""});case 1:return t=n.v,n.a(2,(0,a.Bm)(t))}},_callee)}))).apply(this,arguments)}function mockPayCallback(e){return _mockPayCallback.apply(this,arguments)}function _mockPayCallback(){return(_mockPayCallback=(0,i.A)((0,r.A)().m(function _callee2(e){var t;return(0,r.A)().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,a.Ay.post("/api/v1/payment/mock-callback",{"payment_no":e});case 1:return t=n.v,n.a(2,(0,a.Bm)(t))}},_callee2)}))).apply(this,arguments)}},"9918":function(e,t,n){n.d(t,{"j":function(){return buildOrderShareAttributionParams}});var r=n(6244);function buildOrderShareAttributionParams(e){var t=function readPositiveIntFromStorage(e){try{var t=(0,r.JF)(e);if(null==t)return;var n=Number(t);if(!Number.isFinite(n)||n<=0)return;return Math.floor(n)}catch(e){return}}("referrer_id");if(!t)return{};var n=null==e?void 0:e.storeId,i=!!n&&Number.isFinite(n)&&n>0;return null!=e&&e.requireStoreId?i?{"sharer_uid":t,"share_store_id":n}:{}:{"sharer_uid":t,"share_store_id":i?n:0}}},"4088":function(e,t,n){n.d(t,{"EC":function(){return listStoreAccounts},"FS":function(){return listStoreFinanceTransactions},"KA":function(){return getStore},"KW":function(){return updateStoreAccount},"Rr":function(){return listStores},"gg":function(){return deleteStoreAccount},"iR":function(){return listStoreExclusiveProducts},"jE":function(){return exportStoreFinanceTransactions},"n9":function(){return createStoreAccount}});var r=n(8646),i=n(6673),a=n(7356);function listStores(){return _listStores.apply(this,arguments)}function _listStores(){return _listStores=(0,i.A)((0,r.A)().m(function _callee(){var e,t,n=arguments;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return e=n.length>0&&void 0!==n[0]?n[0]:{},r.n=1,a.Ay.get("/api/v1/stores",{"params":e});case 1:return t=r.v,r.a(2,(0,a.Bm)(t))}},_callee)})),_listStores.apply(this,arguments)}function getStore(e){return _getStore.apply(this,arguments)}function _getStore(){return(_getStore=(0,i.A)((0,r.A)().m(function _callee2(e){var t;return(0,r.A)().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,a.Ay.get("/api/v1/stores/".concat(e));case 1:return t=n.v,n.a(2,(0,a.Bm)(t))}},_callee2)}))).apply(this,arguments)}function listStoreExclusiveProducts(e){return _listStoreExclusiveProducts.apply(this,arguments)}function _listStoreExclusiveProducts(){return _listStoreExclusiveProducts=(0,i.A)((0,r.A)().m(function _callee3(e){var t,n,i=arguments;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return t=i.length>1&&void 0!==i[1]?i[1]:{},r.n=1,a.Ay.get("/api/v1/stores/".concat(e,"/exclusive-products"),{"params":t});case 1:return n=r.v,r.a(2,(0,a.Bm)(n))}},_callee3)})),_listStoreExclusiveProducts.apply(this,arguments)}function listStoreAccounts(e){return _listStoreAccounts.apply(this,arguments)}function _listStoreAccounts(){return(_listStoreAccounts=(0,i.A)((0,r.A)().m(function _callee4(e){var t;return(0,r.A)().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,a.Ay.get("/api/v1/stores/".concat(e,"/accounts"));case 1:return t=n.v,n.a(2,(0,a.Bm)(t))}},_callee4)}))).apply(this,arguments)}function createStoreAccount(e,t){return _createStoreAccount.apply(this,arguments)}function _createStoreAccount(){return(_createStoreAccount=(0,i.A)((0,r.A)().m(function _callee5(e,t){var n;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,a.Ay.post("/api/v1/stores/".concat(e,"/accounts"),t);case 1:return n=r.v,r.a(2,(0,a.Bm)(n))}},_callee5)}))).apply(this,arguments)}function updateStoreAccount(e,t,n){return _updateStoreAccount.apply(this,arguments)}function _updateStoreAccount(){return(_updateStoreAccount=(0,i.A)((0,r.A)().m(function _callee6(e,t,n){var i;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,a.Ay.put("/api/v1/stores/".concat(e,"/accounts/").concat(t),n);case 1:return i=r.v,r.a(2,(0,a.Bm)(i))}},_callee6)}))).apply(this,arguments)}function deleteStoreAccount(e,t){return _deleteStoreAccount.apply(this,arguments)}function _deleteStoreAccount(){return(_deleteStoreAccount=(0,i.A)((0,r.A)().m(function _callee7(e,t){var n;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,a.Ay.delete("/api/v1/stores/".concat(e,"/accounts/").concat(t));case 1:return n=r.v,r.a(2,(0,a.Bm)(n))}},_callee7)}))).apply(this,arguments)}function listStoreFinanceTransactions(e){return _listStoreFinanceTransactions.apply(this,arguments)}function _listStoreFinanceTransactions(){return _listStoreFinanceTransactions=(0,i.A)((0,r.A)().m(function _callee8(e){var t,n,i=arguments;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return t=i.length>1&&void 0!==i[1]?i[1]:{},r.n=1,a.Ay.get("/api/v1/stores/".concat(e,"/finance/transactions"),{"params":t});case 1:return n=r.v,r.a(2,(0,a.Bm)(n))}},_callee8)})),_listStoreFinanceTransactions.apply(this,arguments)}function exportStoreFinanceTransactions(e){return _exportStoreFinanceTransactions.apply(this,arguments)}function _exportStoreFinanceTransactions(){return _exportStoreFinanceTransactions=(0,i.A)((0,r.A)().m(function _callee9(e){var t,n=arguments;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return t=n.length>1&&void 0!==n[1]?n[1]:{},r.n=1,a.Ay.get("/api/v1/stores/".concat(e,"/finance/transactions/export"),{"params":t,"responseType":"blob"});case 1:return r.a(2)}},_callee9)})),_exportStoreFinanceTransactions.apply(this,arguments)}}}]);