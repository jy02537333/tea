"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[824],{"8870":function(n,e,t){t.d(e,{"I8":function(){return a},"cr":function(){return s},"gT":function(){return o},"i5":function(){return r},"os":function(){return i},"vY":function(){return c}});var r="提示：设为当前门店仅用于筛选/浏览，您暂无门店管理权限",o="当前为只读模式，您暂无门店收款账户权限",i="当前为只读模式，您暂无门店财务权限",c="暂无门店管理权限",a="暂无门店收款账户权限",s="暂无门店财务权限"},"228":function(n,e,t){t.d(e,{"A":function(){return usePermission}});var r=t(8646),o=t(6673),i=t(9866),c=t(7378),a=t(4368);function usePermission(){var n=(0,c.useState)(null),e=(0,i.A)(n,2),t=e[0],s=e[1],l=(0,c.useState)(!0),u=(0,i.A)(l,2),d=u[0],p=u[1],f=(0,c.useCallback)((0,o.A)((0,r.A)().m(function _callee(){var n;return(0,r.A)().w(function(e){for(;;)switch(e.p=e.n){case 0:return p(!0),e.p=1,e.n=2,(0,a.$)();case 2:n=e.v,s((null==n?void 0:n.user)||null),e.n=4;break;case 3:e.p=3,e.v,s(null);case 4:return e.p=4,p(!1),e.f(4);case 5:return e.a(2)}},_callee,null,[[1,3,4,5]])})),[]);(0,c.useEffect)(function(){f()},[f]);var v=((null==t?void 0:t.role)||"").toLowerCase(),h=!!v&&v.includes("admin"),m=!!v&&(v.includes("admin")||v.includes("store:accounts")||v.includes("store")),A=!!v&&(v.includes("admin")||v.includes("store:finance")||v.includes("store"));return{"user":t,"role":v,"loading":d,"isAdmin":h,"allowedStoreMgmt":m||A,"allowedStoreAccounts":m,"allowedStoreFinance":A,"canManageStores":function canManageStores(n){var e=((null==n?void 0:n.role)||v||"").toLowerCase();return!!e&&(e.includes("admin")||e.includes("store"))},"canManageStoreAccounts":function canManageStoreAccounts(n){var e=((null==n?void 0:n.role)||v||"").toLowerCase();return!!e&&(e.includes("admin")||e.includes("store:accounts")||e.includes("store"))},"canManageStoreFinance":function canManageStoreFinance(n){var e=((null==n?void 0:n.role)||v||"").toLowerCase();return!!e&&(e.includes("admin")||e.includes("store:finance")||e.includes("store"))},"refresh":f}}},"8824":function(n,e,t){t.r(e),t.d(e,{"default":function(){return StoreDetailPage}});var r=t(8646),o=t(6487),i=t(6673),c=t(9866),a=t(7378),s=t(4657),l=t(8785),u=t(6244),d=t(9624),p=t(4016),f=t(9217),v=t(4106),h=t(4088),m=t(228),A=t(8870),y=t(6106);function StoreDetailPage(){var n=l.Ay.useRouter(),e=(0,a.useState)(null),t=(0,c.A)(e,2),S=t[0],g=t[1],_=(0,a.useState)(!1),x=(0,c.A)(_,2),b=x[0],w=x[1],k=(0,m.A)();function _loadStore(){return(_loadStore=(0,i.A)((0,r.A)().m(function _callee(){var e,t,o,i,c;return(0,r.A)().w(function(r){for(;;)switch(r.p=r.n){case 0:if(t=null==n||null===(e=n.params)||void 0===e?void 0:e.store_id,o=t?Number(t):NaN,!(Number.isNaN(o)||o<=0)){r.n=1;break}return r.a(2);case 1:return w(!0),r.p=2,r.n=3,(0,h.KA)(o);case 3:i=r.v,g(i);try{(0,u.$c)("current_store_id",String(o))}catch(n){}r.n=5;break;case 4:r.p=4,c=r.v,console.error("load store failed",c),(0,d.P0)({"title":"门店加载失败","icon":"none"});case 5:return r.p=5,w(!1),r.f(5);case 6:return r.a(2)}},_callee,null,[[2,4,5,6]])}))).apply(this,arguments)}(0,a.useEffect)(function(){!function loadStore(){return _loadStore.apply(this,arguments)}()},[]);var j,T=k.allowedStoreAccounts,E=k.allowedStoreFinance;function getLicenseUrls(){if(!S)return[];var n=[];if(Array.isArray(S.licenses)){var e,t=(0,o.A)(S.licenses);try{for(t.s();!(e=t.n()).done;){var r=e.value;"string"==typeof r?n.push(r):r&&"string"==typeof r.url&&n.push(r.url)}}catch(n){t.e(n)}finally{t.f()}}if(Array.isArray(S.license_images)){var i,c=(0,o.A)(S.license_images);try{for(c.s();!(i=c.n()).done;){var a=i.value;"string"==typeof a&&n.push(a)}}catch(n){c.e(n)}finally{c.f()}}return n}return b&&!S?(0,y.jsx)(s.EY,{"children":"加载中..."}):S?(0,y.jsxs)(s.Ss,{"style":{"padding":12},"children":[(0,y.jsx)(s.Ss,{"style":{"marginBottom":8,"padding":"6px 10px","borderWidth":1,"borderStyle":"solid","borderColor":"#07c160","borderRadius":16,"display":"inline-block","backgroundColor":"#f6ffed"},"children":(0,y.jsxs)(s.EY,{"style":{"color":"#389e0d"},"children":["当前门店：",S.name]})}),(0,y.jsxs)(s.Ss,{"style":{"marginTop":8},"children":[(0,y.jsxs)(s.EY,{"style":{"display":"block"},"children":["地址：",S.address||"未设置"]}),(0,y.jsx)(s.EY,{"style":{"display":"block","color":"#999","fontSize":12},"children":"如提供定位信息，可一键导航"})]}),(0,y.jsx)(s.EY,{"style":{"display":"block","color":"#999","fontSize":12,"marginTop":6},"children":"提示：可通过右上角入口查看财务流水或管理收款账户"}),S.phone&&(0,y.jsxs)(s.Ss,{"style":{"marginTop":8},"children":[(0,y.jsxs)(s.EY,{"style":{"display":"block"},"children":["联系电话：",S.phone]}),(0,y.jsx)(s.EY,{"style":{"display":"block","color":"#999","fontSize":12},"children":"可直接拨打联系门店"})]}),(0,y.jsxs)(s.Ss,{"style":{"marginTop":12,"display":"flex","gap":8,"flexWrap":"wrap"},"children":[(0,y.jsx)(s.$n,{"size":"mini","type":"primary","onClick":function goNavigate(){if(S){var n=S.latitude,e=S.longitude;"number"==typeof n&&"number"==typeof e?(0,p.so)({"latitude":n,"longitude":e,"name":S.name,"address":S.address||""}).catch(function(){(0,d.P0)({"title":"导航打开失败","icon":"none"})}):(0,d.P0)({"title":"该门店暂未提供定位信息","icon":"none"})}},"children":"导航到门店"}),(0,y.jsx)(s.$n,{"size":"mini","onClick":function goDial(){null!=S&&S.phone?(0,f.V)({"phoneNumber":S.phone}).catch(function(){(0,d.P0)({"title":"拨号失败","icon":"none"})}):(0,d.P0)({"title":"暂无联系电话","icon":"none"})},"children":"拨打电话"}),(0,y.jsx)(s.$n,{"size":"mini","onClick":function goStoreProducts(){if(S){var n=S.id;l.Ay.navigateTo({"url":"/pages/category/index?store_id=".concat(n)})}},"children":"查看本店商品"}),S&&(0,y.jsx)(s.$n,{"size":"mini","onClick":function onClick(){return l.Ay.navigateTo({"url":"/pages/activities/index?store_id=".concat(S.id)})},"children":"查看活动/报名"}),T&&S&&(0,y.jsx)(y.Fragment,{"children":(0,y.jsx)(s.$n,{"size":"mini","onClick":function onClick(){return l.Ay.navigateTo({"url":"/pages/store-accounts/index?store_id=".concat(S.id)})},"children":"管理收款账户"})}),S&&(0,y.jsxs)(y.Fragment,{"children":[(0,y.jsx)(s.$n,{"size":"mini","onClick":function onClick(){E?l.Ay.navigateTo({"url":"/pages/store-finance/index?store_id=".concat(S.id)}):(0,d.P0)({"title":A.cr,"icon":"none"})},"children":"查看财务流水"}),!E&&(0,y.jsx)(s.EY,{"style":{"color":"#999","fontSize":12},"children":"（需权限）"})]})]}),(j=getLicenseUrls(),j.length?(0,y.jsxs)(s.Ss,{"style":{"marginTop":16},"children":[(0,y.jsx)(s.EY,{"style":{"display":"block","fontWeight":"bold"},"children":"门店证照"}),(0,y.jsx)(s.Ss,{"style":{"marginTop":8,"display":"flex","flexWrap":"wrap","gap":8},"children":j.map(function(n,e){return(0,y.jsx)(s.Ss,{"onClick":function onClick(){return function previewLicense(n){var e=getLicenseUrls();e.length&&(0,v.o)({"current":n,"urls":e}).catch(function(){})}(n)},"children":(0,y.jsx)(s._V,{"src":n,"style":{"width":"120px","height":"90px","borderRadius":6},"mode":"aspectFill"})},"".concat(n,"-").concat(e))})})]}):null)]}):(0,y.jsx)(s.EY,{"children":"未找到门店信息"})}},"4368":function(n,e,t){t.d(e,{"$":function(){return getMeSummary}});var r=t(8646),o=t(3846),i=t(6673),c=t(7356);function getMeSummary(){return _getMeSummary.apply(this,arguments)}function _getMeSummary(){return(_getMeSummary=(0,i.A)((0,r.A)().m(function _callee(){var n,e,t,i,a,s,l,u,d,p,f,v,h,m,A,y,S,g,_,x,b,w;return(0,r.A)().w(function(r){for(;;)switch(r.p=r.n){case 0:return r.p=0,r.n=1,c.Ay.get("/api/v1/users/me/summary");case 1:if(n=r.v,!(e=(0,c.Bm)(n))||"object"!==(0,o.A)(e)){r.n=6;break}if(!e.user||"object"!==(0,o.A)(e.user)){r.n=2;break}return r.a(2,e);case 2:if(void 0===(a=null!==(t=null!==(i=e.user_id)&&void 0!==i?i:e.uid)&&void 0!==t?t:e.id)){r.n=3;break}return u={"id":Number(a)||0,"nickname":null!==(s=null!==(l=e.nickname)&&void 0!==l?l:e.name)&&void 0!==s?s:"","phone":e.phone,"avatar":e.avatar,"role":e.role||"user"},d=e.wallet_balance,p={"balance_cents":"number"==typeof d?Math.round(100*d):void 0},f={"balance":"number"==typeof e.points?e.points:void 0},v={"available_count":"number"==typeof e.coupons?e.coupons:void 0},r.a(2,{"user":u,"wallet":p,"points":f,"coupons":v});case 3:return r.p=3,r.n=4,c.Ay.get("/api/v1/user/info");case 4:return S=r.v,g=(0,c.Bm)(S),_={"id":Number(null!==(h=null!==(m=g.id)&&void 0!==m?m:g.uid)&&void 0!==h?h:0)||0,"nickname":null!==(A=null!==(y=g.nickname)&&void 0!==y?y:g.name)&&void 0!==A?A:"","phone":g.phone,"avatar":g.avatar,"role":g.role||"user"},r.a(2,{"user":_});case 5:r.p=5,r.v;case 6:return r.a(2,e);case 7:return r.p=7,w=r.v,r.p=8,r.n=9,c.Ay.get("/api/v1/user/info");case 9:return x=r.v,b=(0,c.Bm)(x),r.a(2,{"user":{"id":null==b?void 0:b.id,"uid":null==b?void 0:b.uid,"open_id":null==b?void 0:b.open_id,"nickname":null==b?void 0:b.nickname,"avatar":null==b?void 0:b.avatar,"phone":null==b?void 0:b.phone,"gender":null==b?void 0:b.gender,"balance":null==b?void 0:b.balance,"points":null==b?void 0:b.points,"role":null==b?void 0:b.role},"wallet":{"balance_cents":"number"==typeof(null==b?void 0:b.balance)?Math.round(100*b.balance):void 0},"points":{"balance":null==b?void 0:b.points}});case 10:throw r.p=10,r.v,w;case 11:return r.a(2)}},_callee,null,[[8,10],[3,5],[0,7]])}))).apply(this,arguments)}},"4088":function(n,e,t){t.d(e,{"EC":function(){return listStoreAccounts},"FS":function(){return listStoreFinanceTransactions},"KA":function(){return getStore},"KW":function(){return updateStoreAccount},"Rr":function(){return listStores},"gg":function(){return deleteStoreAccount},"iR":function(){return listStoreExclusiveProducts},"jE":function(){return exportStoreFinanceTransactions},"n9":function(){return createStoreAccount}});var r=t(8646),o=t(6673),i=t(7356);function listStores(){return _listStores.apply(this,arguments)}function _listStores(){return _listStores=(0,o.A)((0,r.A)().m(function _callee(){var n,e,t=arguments;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return n=t.length>0&&void 0!==t[0]?t[0]:{},r.n=1,i.Ay.get("/api/v1/stores",{"params":n});case 1:return e=r.v,r.a(2,(0,i.Bm)(e))}},_callee)})),_listStores.apply(this,arguments)}function getStore(n){return _getStore.apply(this,arguments)}function _getStore(){return(_getStore=(0,o.A)((0,r.A)().m(function _callee2(n){var e;return(0,r.A)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,i.Ay.get("/api/v1/stores/".concat(n));case 1:return e=t.v,t.a(2,(0,i.Bm)(e))}},_callee2)}))).apply(this,arguments)}function listStoreExclusiveProducts(n){return _listStoreExclusiveProducts.apply(this,arguments)}function _listStoreExclusiveProducts(){return _listStoreExclusiveProducts=(0,o.A)((0,r.A)().m(function _callee3(n){var e,t,o=arguments;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return e=o.length>1&&void 0!==o[1]?o[1]:{},r.n=1,i.Ay.get("/api/v1/stores/".concat(n,"/exclusive-products"),{"params":e});case 1:return t=r.v,r.a(2,(0,i.Bm)(t))}},_callee3)})),_listStoreExclusiveProducts.apply(this,arguments)}function listStoreAccounts(n){return _listStoreAccounts.apply(this,arguments)}function _listStoreAccounts(){return(_listStoreAccounts=(0,o.A)((0,r.A)().m(function _callee4(n){var e;return(0,r.A)().w(function(t){for(;;)switch(t.n){case 0:return t.n=1,i.Ay.get("/api/v1/stores/".concat(n,"/accounts"));case 1:return e=t.v,t.a(2,(0,i.Bm)(e))}},_callee4)}))).apply(this,arguments)}function createStoreAccount(n,e){return _createStoreAccount.apply(this,arguments)}function _createStoreAccount(){return(_createStoreAccount=(0,o.A)((0,r.A)().m(function _callee5(n,e){var t;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,i.Ay.post("/api/v1/stores/".concat(n,"/accounts"),e);case 1:return t=r.v,r.a(2,(0,i.Bm)(t))}},_callee5)}))).apply(this,arguments)}function updateStoreAccount(n,e,t){return _updateStoreAccount.apply(this,arguments)}function _updateStoreAccount(){return(_updateStoreAccount=(0,o.A)((0,r.A)().m(function _callee6(n,e,t){var o;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,i.Ay.put("/api/v1/stores/".concat(n,"/accounts/").concat(e),t);case 1:return o=r.v,r.a(2,(0,i.Bm)(o))}},_callee6)}))).apply(this,arguments)}function deleteStoreAccount(n,e){return _deleteStoreAccount.apply(this,arguments)}function _deleteStoreAccount(){return(_deleteStoreAccount=(0,o.A)((0,r.A)().m(function _callee7(n,e){var t;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return r.n=1,i.Ay.delete("/api/v1/stores/".concat(n,"/accounts/").concat(e));case 1:return t=r.v,r.a(2,(0,i.Bm)(t))}},_callee7)}))).apply(this,arguments)}function listStoreFinanceTransactions(n){return _listStoreFinanceTransactions.apply(this,arguments)}function _listStoreFinanceTransactions(){return _listStoreFinanceTransactions=(0,o.A)((0,r.A)().m(function _callee8(n){var e,t,o=arguments;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return e=o.length>1&&void 0!==o[1]?o[1]:{},r.n=1,i.Ay.get("/api/v1/stores/".concat(n,"/finance/transactions"),{"params":e});case 1:return t=r.v,r.a(2,(0,i.Bm)(t))}},_callee8)})),_listStoreFinanceTransactions.apply(this,arguments)}function exportStoreFinanceTransactions(n){return _exportStoreFinanceTransactions.apply(this,arguments)}function _exportStoreFinanceTransactions(){return _exportStoreFinanceTransactions=(0,o.A)((0,r.A)().m(function _callee9(n){var e,t=arguments;return(0,r.A)().w(function(r){for(;;)switch(r.n){case 0:return e=t.length>1&&void 0!==t[1]?t[1]:{},r.n=1,i.Ay.get("/api/v1/stores/".concat(n,"/finance/transactions/export"),{"params":e,"responseType":"blob"});case 1:return r.a(2)}},_callee9)})),_exportStoreFinanceTransactions.apply(this,arguments)}}}]);