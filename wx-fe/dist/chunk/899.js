"use strict";(self.webpackJsonp=self.webpackJsonp||[]).push([[899],{"2899":function(o,n,t){t.r(n),t.d(n,{"default":function(){return MyCouponsPage}});var e=t(8646),r=t(6673),c=t(9866),i=t(7378),s=t(4657),a=t(9624),u=t(7356);function listMyCoupons(){return _listMyCoupons.apply(this,arguments)}function _listMyCoupons(){return(_listMyCoupons=(0,r.A)((0,e.A)().m(function _callee3(){var o;return(0,e.A)().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,u.Ay.get("/api/v1/user/coupons");case 1:return o=n.v,n.a(2,(0,u.Bm)(o))}},_callee3)}))).apply(this,arguments)}var l=t(6106);function MyCouponsPage(){var o=(0,i.useState)([]),n=(0,c.A)(o,2),t=n[0],u=n[1],f=(0,i.useState)(!1),p=(0,c.A)(f,2),d=p[0],m=p[1],y=(0,i.useState)("platform"),h=(0,c.A)(y,2),C=h[0],g=h[1];function _fetchCoupons(){return(_fetchCoupons=(0,r.A)((0,e.A)().m(function _callee(){var o,n;return(0,e.A)().w(function(t){for(;;)switch(t.p=t.n){case 0:return m(!0),t.p=1,t.n=2,listMyCoupons();case 2:o=t.v,u(Array.isArray(o)?o:[]),t.n=4;break;case 3:t.p=3,n=t.v,console.error("load my coupons failed",n),(0,a.P0)({"title":"加载优惠券失败","icon":"none"});case 4:return t.p=4,m(!1),t.f(4);case 5:return t.a(2)}},_callee,null,[[1,3,4,5]])}))).apply(this,arguments)}function switchTab(o){g(o)}(0,i.useEffect)(function(){!function fetchCoupons(){return _fetchCoupons.apply(this,arguments)}()},[]);var x=t.filter(function(o){return!o.coupon.store_id}),b=t.filter(function(o){return!!o.coupon.store_id}),_="platform"===C?x:b;function formatCouponTitle(o){var n=o.coupon;return 1===n.type&&n.amount?"".concat(n.name,"（满减￥").concat(n.amount,"）"):2===n.type&&n.discount?"".concat(n.name,"（折扣").concat(n.discount,"）"):n.name}function formatExpire(o){var n;return"有效期至：".concat(null===(n=o.coupon.end_time)||void 0===n?void 0:n.replace("T"," ").slice(0,16))}return(0,l.jsxs)(s.Ss,{"data-testid":"page-coupons","style":{"padding":12},"children":[(0,l.jsxs)(s.Ss,{"style":{"marginBottom":12,"display":"flex","flexDirection":"row"},"children":[(0,l.jsx)(s.$n,{"size":"mini","onClick":function onClick(){return switchTab("platform")},"style":{"marginRight":8,"backgroundColor":"platform"===C?"#07c160":"#f5f5f5","color":"platform"===C?"#fff":"#333"},"children":"平台券"}),(0,l.jsx)(s.$n,{"size":"mini","onClick":function onClick(){return switchTab("store")},"style":{"backgroundColor":"store"===C?"#07c160":"#f5f5f5","color":"store"===C?"#fff":"#333"},"children":"门店券"})]}),d&&(0,l.jsx)(s.EY,{"children":"加载中..."}),!d&&!_.length&&(0,l.jsx)(s.EY,{"children":"暂无可用优惠券"}),!d&&_.map(function(o){return(0,l.jsxs)(s.Ss,{"style":{"marginBottom":12,"padding":12,"borderRadius":8,"backgroundColor":"#ffffff","boxShadow":"0 2px 6px rgba(0,0,0,0.04)"},"children":[(0,l.jsx)(s.EY,{"style":{"display":"block","fontWeight":"bold","marginBottom":4},"children":formatCouponTitle(o)}),(0,l.jsx)(s.EY,{"style":{"display":"block","fontSize":12,"color":"#666","marginBottom":4},"children":formatExpire(o)}),(0,l.jsx)(s.EY,{"style":{"display":"block","fontSize":12,"color":"#999"},"children":o.coupon.store_id?"门店券（store_id=".concat(o.coupon.store_id,"）"):"平台券（全平台适用或按券规则）"})]},o.id)})]})}}}]);