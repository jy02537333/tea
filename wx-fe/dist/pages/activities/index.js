"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[514],{5165:function(e,n,t){var r=t(7586),i=t(8646),s=t(6673),a=t(9986),o=t(7378),c=t(427),l=t(7168),u=t.n(l),d=t(8773);function p(e){return h.apply(this,arguments)}function h(){return h=(0,s.A)((0,i.A)().m(function e(n){var t;return(0,i.A)().w(function(e){while(1)switch(e.n){case 0:return e.n=1,d.Ay.get("/api/v1/activities",{params:n});case 1:return t=e.v,e.a(2,(0,d.Bm)(t))}},e)})),h.apply(this,arguments)}function v(e,n){return f.apply(this,arguments)}function f(){return f=(0,s.A)((0,i.A)().m(function e(n,t){var r;return(0,i.A)().w(function(e){while(1)switch(e.n){case 0:return e.n=1,d.Ay.post("/api/v1/activities/".concat(n,"/register-with-order"),t);case 1:return r=e.v,e.a(2,(0,d.Bm)(r))}},e)})),f.apply(this,arguments)}var m=t(1994),y=t(6106);function w(){var e=(0,o.useState)(void 0),n=(0,a.A)(e,2),t=n[0],r=n[1],l=(0,o.useState)([]),d=(0,a.A)(l,2),h=d[0],f=d[1],w=(0,o.useState)(!1),A=(0,a.A)(w,2),b=A[0],x=A[1],g=(0,o.useState)(""),j=(0,a.A)(g,2),S=j[0],T=j[1],k=(0,o.useState)(""),E=(0,a.A)(k,2),N=E[0],Y=E[1],_=(0,o.useState)(null),I=(0,a.A)(_,2),C=I[0],W=I[1],z=(0,o.useState)(""),B=(0,a.A)(z,2),J=B[0],O=B[1];function P(e){return R.apply(this,arguments)}function R(){return R=(0,s.A)((0,i.A)().m(function e(n){var t,r,s,a;return(0,i.A)().w(function(e){while(1)switch(e.p=e.n){case 0:return x(!0),e.p=1,e.n=2,p({store_id:n});case 2:t=e.v,r=[],s=t,Array.isArray(null===s||void 0===s?void 0:s.data)?r=s.data:Array.isArray(null===s||void 0===s?void 0:s.items)?r=s.items:Array.isArray(s)&&(r=s),f(r),e.n=4;break;case 3:e.p=3,a=e.v,console.error("load activities failed",a),u().showToast({title:"\u6d3b\u52a8\u52a0\u8f7d\u5931\u8d25",icon:"none"});case 4:return e.p=4,x(!1),e.f(4);case 5:return e.a(2)}},e,null,[[1,3,4,5]])})),R.apply(this,arguments)}function U(e){return $.apply(this,arguments)}function $(){return $=(0,s.A)((0,i.A)().m(function e(n){var r,s,a,o,c,l,d,p;return(0,i.A)().w(function(e){while(1)switch(e.p=e.n){case 0:if(t){e.n=1;break}return u().showToast({title:"\u7f3a\u5c11\u95e8\u5e97\u4fe1\u606f",icon:"none"}),e.a(2);case 1:if(S.trim()){e.n=2;break}return u().showToast({title:"\u8bf7\u8f93\u5165\u59d3\u540d",icon:"none"}),e.a(2);case 2:if(N.trim()){e.n=3;break}return u().showToast({title:"\u8bf7\u8f93\u5165\u624b\u673a\u53f7",icon:"none"}),e.a(2);case 3:if(r=J.trim()?Number(J.trim()):0,!(Number.isNaN(r)||r<0)){e.n=4;break}return u().showToast({title:"\u62a5\u540d\u8d39\u7528\u683c\u5f0f\u9519\u8bef",icon:"none"}),e.a(2);case 4:return W(n),e.p=5,e.n=6,v(n,{name:S.trim(),phone:N.trim(),fee:r});case 6:if(s=e.v,a=null===s||void 0===s?void 0:s.order,u().showToast({title:"\u62a5\u540d\u6210\u529f",icon:"success"}),!(a&&Number(a.pay_amount)>0)){e.n=12;break}return e.p=7,e.n=8,(0,m.v)(a.id);case 8:if(o=e.v,null===o||void 0===o||!o.payment_no){e.n=10;break}return e.n=9,(0,m.e)(o.payment_no);case 9:u().showToast({title:"\u652f\u4ed8\u6210\u529f",icon:"success"});case 10:e.n=12;break;case 11:e.p=11,d=e.v,console.error("pay activity order failed",d),u().showToast({title:"\u652f\u4ed8\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",icon:"none"});case 12:e.n=14;break;case 13:e.p=13,p=e.v,console.error("register activity failed",p),l=(null===p||void 0===p||null===(c=p.response)||void 0===c||null===(c=c.data)||void 0===c?void 0:c.message)||"\u62a5\u540d\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u91cd\u8bd5",u().showToast({title:l,icon:"none"});case 14:return e.p=14,W(null),e.f(14);case 15:return e.a(2)}},e,null,[[7,11],[5,13,14,15]])})),$.apply(this,arguments)}return(0,o.useEffect)(function(){var e,n=u().getCurrentInstance().router,t=null===n||void 0===n||null===(e=n.params)||void 0===e?void 0:e.store_id;if(t){var i=Number(t);!Number.isNaN(i)&&i>0&&(r(i),P(i))}else u().showToast({title:"\u7f3a\u5c11\u95e8\u5e97\u4fe1\u606f\uff0c\u8bf7\u4ece\u9996\u9875\u8fdb\u5165",icon:"none"})},[]),(0,y.jsxs)(c.Ss,{style:{padding:12},children:[(0,y.jsx)(c.EY,{style:{fontSize:18,fontWeight:"bold"},children:"\u6d3b\u52a8\u62a5\u540d"}),(0,y.jsxs)(c.Ss,{style:{marginTop:12},children:[(0,y.jsx)(c.EY,{children:"\u59d3\u540d"}),(0,y.jsx)(c.pd,{placeholder:"\u8bf7\u8f93\u5165\u59d3\u540d",value:S,onInput:function(e){return T(e.detail.value)}})]}),(0,y.jsxs)(c.Ss,{style:{marginTop:12},children:[(0,y.jsx)(c.EY,{children:"\u624b\u673a\u53f7"}),(0,y.jsx)(c.pd,{placeholder:"\u8bf7\u8f93\u5165\u624b\u673a\u53f7",value:N,onInput:function(e){return Y(e.detail.value)}})]}),(0,y.jsxs)(c.Ss,{style:{marginTop:12},children:[(0,y.jsx)(c.EY,{children:"\u62a5\u540d\u8d39\u7528\uff08\u5143\uff0c\u53ef\u9009\uff09"}),(0,y.jsx)(c.pd,{placeholder:"\u4e0d\u586b\u5219\u89c6\u4e3a\u514d\u8d39\u6d3b\u52a8",value:J,onInput:function(e){return O(e.detail.value)}})]}),(0,y.jsxs)(c.Ss,{style:{marginTop:16},children:[b&&(0,y.jsx)(c.EY,{children:"\u6d3b\u52a8\u52a0\u8f7d\u4e2d..."}),!b&&0===h.length&&(0,y.jsx)(c.EY,{children:"\u5f53\u524d\u95e8\u5e97\u6682\u65e0\u53ef\u62a5\u540d\u6d3b\u52a8"}),h.map(function(e){return(0,y.jsxs)(c.Ss,{style:{marginTop:12,padding:12,borderRadius:8,borderWidth:1,borderStyle:"solid",borderColor:"#eee"},children:[(0,y.jsx)(c.EY,{style:{fontSize:16,fontWeight:"bold"},children:e.name}),(0,y.jsx)(c.Ss,{style:{marginTop:4},children:(0,y.jsxs)(c.EY,{children:["\u65f6\u95f4\uff1a",e.start_time," - ",e.end_time]})}),e.description&&(0,y.jsx)(c.Ss,{style:{marginTop:4},children:(0,y.jsxs)(c.EY,{children:["\u8bf4\u660e\uff1a",e.description]})}),(0,y.jsx)(c.$n,{style:{marginTop:8},type:"primary",loading:C===e.id,onClick:function(){return U(e.id)},children:C===e.id?"\u62a5\u540d\u4e2d...":"\u62a5\u540d\u53c2\u52a0"})]},e.id)})]})]})}var A={},b=(0,r.eU)(w,"pages/activities/index",{root:{cn:[]}},A||{});w&&w.behaviors&&(b.behaviors=(b.behaviors||[]).concat(w.behaviors));Page(b)}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[907,96,76],function(){return n(5165)});e.O()}]);