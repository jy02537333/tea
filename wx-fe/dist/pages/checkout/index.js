"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[341],{3333:function(n,e,t){var r=t(7586),i=t(8646),a=t(6673),o=t(9986),s=t(7378),c=t(427),u=t(7168),l=t.n(u),d=t(1243),p=t(8124),f=t(9776),h=t(6106);function v(){var n=(0,s.useState)([]),e=(0,o.A)(n,2),t=e[0],r=e[1],u=(0,s.useState)(0),v=(0,o.A)(u,2),m=v[0],y=v[1],x=(0,s.useState)(""),g=(0,o.A)(x,2),A=g[0],w=g[1],S=(0,s.useState)(""),b=(0,o.A)(S,2),j=b[0],k=b[1],T=(0,s.useState)(!1),E=(0,o.A)(T,2),Y=E[0],_=E[1],z=(0,s.useState)("\u6682\u4e0d\u4f7f\u7528\u4f18\u60e0\u5238"),N=(0,o.A)(z,2),C=N[0],I=N[1],O=(0,s.useState)(void 0),$=(0,o.A)(O,2),D=$[0],F=$[1],J=(0,s.useState)([]),q=(0,o.A)(J,2),B=q[0],K=q[1],M=(0,s.useState)(!1),P=(0,o.A)(M,2),R=P[0],U=P[1];function W(){return X.apply(this,arguments)}function X(){return X=(0,a.A)((0,i.A)().m(function n(){var e,t,a,o;return(0,i.A)().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,n.n=1,(0,d.Fx)();case 1:e=n.v,t=e||[],r(t),a=Array.isArray(t)?t.reduce(function(n,e){var t,r,i=Number(null!==(t=e.price)&&void 0!==t?t:0),a=Number(null!==(r=e.quantity)&&void 0!==r?r:0);return Number.isFinite(i)&&Number.isFinite(a)?n+i*a:n},0):0,y(a),G(a),n.n=3;break;case 2:n.p=2,o=n.v,console.error("load cart for checkout failed",o);case 3:return n.a(2)}},n,null,[[0,2]])})),X.apply(this,arguments)}function G(n){return H.apply(this,arguments)}function H(){return H=(0,a.A)((0,i.A)().m(function n(e){var t,r,a,o,s,c;return(0,i.A)().w(function(n){while(1)switch(n.p=n.n){case 0:if(n.p=0,e&&!(e<=0)){n.n=1;break}return I("\u6682\u65e0\u53ef\u7528\u4f18\u60e0\u5238"),F(void 0),K([]),n.a(2);case 1:return t={order_amount:String(e)},n.n=2,(0,p.SK)(t);case 2:r=n.v,a=r.available||[],K(a),a.length>0?(o=a[0],s=Z(o),F(o.id),I("\u5df2\u81ea\u52a8\u9009\u62e9\uff1a".concat(s))):(F(void 0),I("\u6682\u65e0\u53ef\u7528\u4f18\u60e0\u5238")),n.n=4;break;case 3:n.p=3,c=n.v,console.error("load available coupons for order failed",c),I("\u4f18\u60e0\u5238\u52a0\u8f7d\u5931\u8d25\uff0c\u53ef\u7a0d\u540e\u91cd\u8bd5"),F(void 0),K([]);case 4:return n.a(2)}},n,null,[[0,3]])})),H.apply(this,arguments)}function L(){return Q.apply(this,arguments)}function Q(){return Q=(0,a.A)((0,i.A)().m(function n(){var e,t,r;return(0,i.A)().w(function(n){while(1)switch(n.p=n.n){case 0:return n.p=0,n.n=1,(0,f.OT)();case 1:e=n.v,e&&(t=e.full||(0,f.M0)(e),t&&!A&&w(t)),n.n=3;break;case 2:n.p=2,r=n.v,console.error("load default address failed",r);case 3:return n.a(2)}},n,null,[[0,2]])})),Q.apply(this,arguments)}function V(){return m||t.length}function Z(n){var e=n.coupon,t=e.name;return 1===e.type&&e.amount?t="".concat(e.name," - \u6ee1\u51cf\xa5").concat(e.amount):2===e.type&&e.discount&&(t="".concat(e.name," - \u6298\u6263").concat(e.discount)),t}function nn(){return en.apply(this,arguments)}function en(){return en=(0,a.A)((0,i.A)().m(function n(){var e,r,a;return(0,i.A)().w(function(n){while(1)switch(n.p=n.n){case 0:if(t.length){n.n=1;break}return l().showToast({title:"\u8d2d\u7269\u8f66\u4e3a\u7a7a",icon:"none",duration:1500}),n.a(2);case 1:return _(!0),n.p=2,e={delivery_type:2,address_info:A||void 0,remark:j||void 0,user_coupon_id:D},n.n=3,(0,p.X9)(e);case 3:if(r=n.v,!A.trim()){n.n=4;break}return n.n=4,(0,f.ns)({full:A.trim(),detail:A.trim(),orderId:null===r||void 0===r?void 0:r.id,orderNo:null===r||void 0===r?void 0:r.order_no,updatedAt:(new Date).toISOString(),timestamp:Date.now()});case 4:l().showToast({title:"\u4e0b\u5355\u6210\u529f",icon:"success",duration:1500}),null!==r&&void 0!==r&&r.id&&l().navigateTo({url:"/pages/order-detail/index?id=".concat(r.id)}),n.n=6;break;case 5:n.p=5,a=n.v,console.error("create order failed",a),l().showToast({title:"\u4e0b\u5355\u5931\u8d25",icon:"none",duration:1500});case 6:return n.p=6,_(!1),n.f(6);case 7:return n.a(2)}},n,null,[[2,5,6,7]])})),en.apply(this,arguments)}return(0,s.useEffect)(function(){W(),L()},[]),(0,h.jsxs)(c.Ss,{style:{padding:12},children:[(0,h.jsxs)(c.EY,{children:["\u786e\u8ba4\u8ba2\u5355\uff08\u5171 ",t.length," \u4ef6\uff09"]}),(0,h.jsxs)(c.EY,{children:["\u91d1\u989d\uff08\u793a\u610f\uff09: ",V()]}),(0,h.jsxs)(c.Ss,{style:{marginTop:8},children:[(0,h.jsxs)(c.EY,{children:["\u4f18\u60e0\u5238\uff1a",C]}),(0,h.jsx)(c.EY,{style:{fontSize:12,color:"#999",marginTop:2},children:"\u53ef\u70b9\u51fb\u4e0b\u65b9\u6309\u94ae\u67e5\u770b\u672c\u5355\u53ef\u7528\u4f18\u60e0\u5238\u5e76\u624b\u52a8\u9009\u62e9"}),(0,h.jsxs)(c.Ss,{style:{marginTop:4,display:"flex",flexDirection:"row",flexWrap:"wrap",gap:4},children:[B.length>0&&(0,h.jsx)(c.$n,{size:"mini",onClick:function(){return U(function(n){return!n})},type:"primary",children:R?"\u6536\u8d77\u672c\u5355\u53ef\u7528\u4f18\u60e0\u5238":"\u672c\u5355\u53ef\u7528\u4f18\u60e0\u5238\uff08".concat(B.length,"\uff09")}),D?(0,h.jsx)(c.$n,{size:"mini",onClick:function(){F(void 0),I("\u6682\u4e0d\u4f7f\u7528\u4f18\u60e0\u5238")},children:"\u4e0d\u4f7f\u7528\u4f18\u60e0\u5238"}):null]}),R&&B.length>0&&(0,h.jsx)(c.Ss,{style:{marginTop:8},children:B.map(function(n){var e=Z(n),t=n.id===D;return(0,h.jsx)(c.$n,{size:"mini",type:t?"primary":"default",style:{marginRight:8,marginBottom:4},onClick:function(){F(n.id),I("\u5df2\u9009\u62e9\uff1a".concat(e)),U(!1)},children:e},n.id)})})]}),(0,h.jsxs)(c.Ss,{style:{marginTop:12},children:[(0,h.jsx)(c.EY,{children:"\u6536\u8d27\u5730\u5740"}),(0,h.jsx)(c.pd,{type:"text",placeholder:"\u8bf7\u8f93\u5165\u6536\u8d27\u5730\u5740",value:A,onInput:function(n){return w(n.detail.value)}}),(0,h.jsx)(c.EY,{style:{fontSize:12,color:"#999"},children:"\u53ef\u5728\u201c\u6211\u7684-\u6536\u8d27\u5730\u5740\u201d\u8bbe\u7f6e\u9ed8\u8ba4\u5730\u5740"})]}),(0,h.jsxs)(c.Ss,{style:{marginTop:12},children:[(0,h.jsx)(c.EY,{children:"\u5907\u6ce8"}),(0,h.jsx)(c.pd,{type:"text",placeholder:"\u53ef\u586b\u5199\u53e3\u5473\u3001\u9001\u8fbe\u65f6\u95f4\u7b49",value:j,onInput:function(n){return k(n.detail.value)}})]}),(0,h.jsx)(c.Ss,{style:{marginTop:16},children:(0,h.jsx)(c.$n,{type:"primary",disabled:Y,onClick:nn,children:Y?"\u63d0\u4ea4\u4e2d...":"\u63d0\u4ea4\u8ba2\u5355"})})]})}var m={},y=(0,r.eU)(v,"pages/checkout/index",{root:{cn:[]}},m||{});v&&v.behaviors&&(y.behaviors=(y.behaviors||[]).concat(v.behaviors));Page(y)}},function(n){var e=function(e){return n(n.s=e)};n.O(0,[907,96,76],function(){return e(3333)});n.O()}]);