"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[209],{4499:function(e,n,r){var i=r(7586),t=r(8646),s=r(3561),o=r(6045),a=r(6673),l=r(9986),c=r(7378),u=r(427),d=r(7168),p=r.n(d),h=r(4227),f=r(8773);function m(){return g.apply(this,arguments)}function g(){return g=(0,a.A)((0,t.A)().m(function e(){var n,r,i=arguments;return(0,t.A)().w(function(e){while(1)switch(e.n){case 0:return n=i.length>0&&void 0!==i[0]?i[0]:{},e.n=1,f.Ay.get("/api/v1/membership-packages",{params:n});case 1:return r=e.v,e.a(2,(0,f.Bm)(r))}},e)})),g.apply(this,arguments)}function y(e){return x.apply(this,arguments)}function x(){return x=(0,a.A)((0,t.A)().m(function e(n){var r;return(0,t.A)().w(function(e){while(1)switch(e.n){case 0:return e.n=1,f.Ay.post("/api/v1/membership-orders",n);case 1:return r=e.v,e.a(2,(0,f.Bm)(r))}},e)})),x.apply(this,arguments)}var b=r(1994),v=r(6106),j=["\u672a\u77e5","\u7537","\u5973"];function S(){var e,n,r=(0,c.useState)(null),i=(0,l.A)(r,2),f=i[0],g=i[1],x=(0,c.useState)({nickname:"",gender:0}),S=(0,l.A)(x,2),w=S[0],k=S[1],A=(0,c.useState)(!1),T=(0,l.A)(A,2),E=T[0],Y=T[1],z=(0,c.useState)(!1),C=(0,l.A)(z,2),_=C[0],R=C[1],W=(0,c.useState)(!1),D=(0,l.A)(W,2),P=D[0],$=D[1],B=(0,c.useState)([]),I=(0,l.A)(B,2),N=I[0],F=I[1],J=(0,c.useState)(null),M=(0,l.A)(J,2),O=M[0],U=M[1];(0,c.useEffect)(function(){K(),H()},[]),(0,d.usePullDownRefresh)(function(){K(),H()});var q=(0,c.useMemo)(function(){if(!f)return"\u8bbf\u5ba2";var e=f.points||0;return e>=2e3?"\u9ed1\u91d1\u4f1a\u5458":e>=1e3?"\u94c2\u91d1\u4f1a\u5458":e>=500?"\u9ec4\u91d1\u4f1a\u5458":e>=200?"\u767d\u94f6\u4f1a\u5458":"\u9752\u94dc\u4f1a\u5458"},[f]);function H(){return G.apply(this,arguments)}function G(){return G=(0,a.A)((0,t.A)().m(function e(){var n,r;return(0,t.A)().w(function(e){while(1)switch(e.p=e.n){case 0:return $(!0),e.p=1,e.n=2,m({page:1,limit:20,type:"membership"});case 2:n=e.v,F(n.data||[]),e.n=4;break;case 3:e.p=3,r=e.v,console.error("load membership packages failed",r),p().showToast({title:"\u52a0\u8f7d\u5957\u9910\u5931\u8d25",icon:"none"});case 4:return e.p=4,$(!1),e.f(4);case 5:return e.a(2)}},e,null,[[1,3,4,5]])})),G.apply(this,arguments)}function K(){return L.apply(this,arguments)}function L(){return L=(0,a.A)((0,t.A)().m(function e(){var n,r,i;return(0,t.A)().w(function(e){while(1)switch(e.p=e.n){case 0:return Y(!0),e.p=1,e.n=2,(0,h.ug)();case 2:r=e.v,g(r),k({nickname:r.nickname||"",gender:null!==(n=r.gender)&&void 0!==n?n:0}),e.n=4;break;case 3:e.p=3,i=e.v,console.error("load membership profile failed",i),p().showToast({title:"\u52a0\u8f7d\u5931\u8d25",icon:"none"});case 4:return e.p=4,Y(!1),p().stopPullDownRefresh(),e.f(4);case 5:return e.a(2)}},e,null,[[1,3,4,5]])})),L.apply(this,arguments)}function Q(e){return V.apply(this,arguments)}function V(){return V=(0,a.A)((0,t.A)().m(function e(n){var r,i,s;return(0,t.A)().w(function(e){while(1)switch(e.p=e.n){case 0:if(n.id){e.n=1;break}return e.a(2);case 1:if(!O||O!==n.id){e.n=2;break}return e.a(2);case 2:return U(n.id),e.p=3,e.n=4,y({package_id:n.id});case 4:return r=e.v,e.n=5,(0,b.v)(r.order_id);case 5:return i=e.v,e.n=6,p().requestPayment({timeStamp:String(i.timestamp||i.timeStamp),nonceStr:i.nonce_str||i.nonceStr,package:i.package,signType:"MD5",paySign:i.sign});case 6:return p().showToast({title:"\u5f00\u901a\u6210\u529f",icon:"success"}),e.n=7,K();case 7:return e.n=8,H();case 8:e.n=10;break;case 9:e.p=9,s=e.v,console.error("open membership package failed",s),p().showToast({title:"\u652f\u4ed8\u672a\u5b8c\u6210\uff0c\u53ef\u7a0d\u540e\u91cd\u8bd5",icon:"none"});case 10:return e.p=10,U(null),e.f(10);case 11:return e.a(2)}},e,null,[[3,9,10,11]])})),V.apply(this,arguments)}function X(e,n){k(function(r){return(0,o.A)((0,o.A)({},r),{},(0,s.A)({},e,n))})}function Z(){return ee.apply(this,arguments)}function ee(){return ee=(0,a.A)((0,t.A)().m(function e(){var n;return(0,t.A)().w(function(e){while(1)switch(e.p=e.n){case 0:if(w.nickname.trim()){e.n=1;break}return p().showToast({title:"\u8bf7\u8f93\u5165\u6635\u79f0",icon:"none"}),e.a(2);case 1:return R(!0),e.p=2,e.n=3,(0,h.bu)({nickname:w.nickname.trim(),gender:w.gender});case 3:return p().showToast({title:"\u8d44\u6599\u5df2\u66f4\u65b0",icon:"success"}),e.n=4,K();case 4:e.n=6;break;case 5:e.p=5,n=e.v,console.error("update membership info failed",n),p().showToast({title:"\u66f4\u65b0\u5931\u8d25",icon:"none"});case 6:return e.p=6,R(!1),e.f(6);case 7:return e.a(2)}},e,null,[[2,5,6,7]])})),ee.apply(this,arguments)}return(0,v.jsxs)(u.Ss,{style:{padding:16,backgroundColor:"#f5f6f8",minHeight:"100vh"},children:[(0,v.jsxs)(u.Ss,{style:{backgroundColor:"#fff",borderRadius:12,padding:16},children:[(0,v.jsx)(u.EY,{style:{fontSize:24,fontWeight:"bold"},children:q}),(0,v.jsxs)(u.EY,{style:{color:"#666",marginTop:4},children:["UID\uff1a",(null===f||void 0===f?void 0:f.uid)||"-"]}),(0,v.jsxs)(u.EY,{style:{color:"#666",marginTop:4},children:["\u89d2\u8272\uff1a",(null===f||void 0===f?void 0:f.role)||"user"]}),(0,v.jsxs)(u.Ss,{style:{display:"flex",justifyContent:"space-around",marginTop:16},children:[(0,v.jsxs)(u.Ss,{style:{textAlign:"center"},children:[(0,v.jsx)(u.EY,{style:{fontSize:20,fontWeight:"bold"},children:null!==(e=null===f||void 0===f?void 0:f.points)&&void 0!==e?e:0}),(0,v.jsx)(u.EY,{style:{color:"#999",fontSize:12},children:"\u6210\u957f\u79ef\u5206"})]}),(0,v.jsxs)(u.Ss,{style:{textAlign:"center"},children:[(0,v.jsx)(u.EY,{style:{fontSize:20,fontWeight:"bold"},children:null!==(n=null===f||void 0===f?void 0:f.balance)&&void 0!==n?n:0}),(0,v.jsx)(u.EY,{style:{color:"#999",fontSize:12},children:"\u8d26\u6237\u4f59\u989d"})]})]})]}),(0,v.jsxs)(u.Ss,{style:{backgroundColor:"#fff",borderRadius:12,padding:16,marginTop:16},children:[(0,v.jsx)(u.EY,{style:{fontSize:18,fontWeight:"bold"},children:"\u5b8c\u5584\u8d44\u6599"}),(0,v.jsxs)(u.Ss,{style:{marginTop:12},children:[(0,v.jsx)(u.EY,{children:"\u6635\u79f0"}),(0,v.jsx)(u.pd,{value:w.nickname,onInput:function(e){return X("nickname",e.detail.value)},placeholder:"\u8bf7\u8f93\u5165\u6635\u79f0"})]}),(0,v.jsxs)(u.Ss,{style:{marginTop:12},children:[(0,v.jsx)(u.EY,{children:"\u6027\u522b"}),(0,v.jsx)(u.Ss,{style:{display:"flex",gap:8,marginTop:8},children:j.map(function(e,n){return(0,v.jsx)(u.$n,{size:"mini",type:w.gender===n?"primary":void 0,onClick:function(){return X("gender",n)},children:e},e)})})]}),(0,v.jsx)(u.$n,{style:{marginTop:16},type:"primary",loading:_,onClick:Z,children:_?"\u4fdd\u5b58\u4e2d...":"\u4fdd\u5b58\u8d44\u6599"})]}),(0,v.jsxs)(u.Ss,{style:{backgroundColor:"#fff",borderRadius:12,padding:16,marginTop:16},children:[(0,v.jsx)(u.EY,{style:{fontSize:18,fontWeight:"bold"},children:"\u4f1a\u5458\u6743\u76ca"}),(0,v.jsx)(u.EY,{style:{color:"#666",marginTop:8},children:"\xb7 \u8ba2\u5355\u79ef\u5206\uff1a\u6bcf\u6210\u529f\u652f\u4ed8 1 \u5143\u7d2f\u79ef 1 \u79ef\u5206"}),(0,v.jsx)(u.EY,{style:{color:"#666",marginTop:4},children:"\xb7 \u51bb\u7ed3\u91d1\u989d\uff1a\u552e\u540e\u9000\u6b3e\u4e2d\u7684\u8ba2\u5355\u4f1a\u6682\u65f6\u5f71\u54cd\u79ef\u5206"}),(0,v.jsx)(u.EY,{style:{color:"#666",marginTop:4},children:"\xb7 \u4f1a\u5458\u65e5\uff1a\u79ef\u5206\u8d85\u8fc7 1000 \u53ef\u5728\u4f1a\u5458\u65e5\u4eab\u53d7\u6298\u6263"})]}),(0,v.jsxs)(u.Ss,{style:{backgroundColor:"#fff",borderRadius:12,padding:16,marginTop:16},children:[(0,v.jsx)(u.EY,{style:{fontSize:18,fontWeight:"bold"},children:"\u53ef\u5f00\u901a\u7684\u4f1a\u5458\u5957\u9910"}),P&&(0,v.jsx)(u.EY,{style:{color:"#999",marginTop:8},children:"\u52a0\u8f7d\u4e2d..."}),!P&&0===N.length&&(0,v.jsx)(u.EY,{style:{color:"#999",marginTop:8},children:"\u6682\u672a\u914d\u7f6e\u53ef\u7528\u7684\u4f1a\u5458\u5957\u9910"}),!P&&N.length>0&&(0,v.jsx)(u.Ss,{style:{marginTop:12},children:N.map(function(e){return(0,v.jsxs)(u.Ss,{style:{padding:12,borderRadius:8,borderWidth:1,borderColor:"#eee",marginBottom:8,display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center"},children:[(0,v.jsxs)(u.Ss,{children:[(0,v.jsx)(u.EY,{style:{fontSize:16,fontWeight:"bold"},children:e.name}),(0,v.jsx)(u.Ss,{style:{marginTop:4},children:(0,v.jsxs)(u.EY,{style:{color:"#f56c6c",fontSize:16},children:["\uffe5",Number(e.price||0).toFixed(2)]})}),e.discount_rate&&(0,v.jsxs)(u.EY,{style:{color:"#666",fontSize:12,marginTop:4},children:["\u4f1a\u5458\u6298\u6263\u7ea6\uff1a",(100*Number(e.discount_rate)).toFixed(0)," \u6298"]}),e.tea_coin_award&&(0,v.jsxs)(u.EY,{style:{color:"#666",fontSize:12,marginTop:2},children:["\u5f00\u901a\u8d60\u9001\u8336\u5e01\uff1a",Number(e.tea_coin_award)]})]}),(0,v.jsx)(u.$n,{size:"mini",type:"primary",loading:O===e.id,onClick:function(){Q(e)},children:O===e.id?"\u5f00\u901a\u4e2d...":"\u53bb\u5f00\u901a"})]},e.id)})})]}),(0,v.jsx)(u.$n,{style:{marginTop:24},loading:E||P,onClick:function(){K(),H()},children:"\u91cd\u65b0\u52a0\u8f7d"}),(0,v.jsx)(u.$n,{style:{marginTop:12},onClick:function(){p().navigateTo({url:"/pages/membership-orders/index"})},children:"\u67e5\u770b\u6211\u7684\u4f1a\u5458\u8ba2\u5355"})]})}var w={navigationBarTitleText:"\u4f1a\u5458\u6743\u76ca",enablePullDownRefresh:!0},k=(0,i.eU)(S,"pages/membership/index",{root:{cn:[]}},w||{});S&&S.behaviors&&(k.behaviors=(k.behaviors||[]).concat(S.behaviors));Page(k)}},function(e){var n=function(n){return e(e.s=n)};e.O(0,[907,96,76],function(){return n(4499)});e.O()}]);