"use strict";(wx["webpackJsonp"]=wx["webpackJsonp"]||[]).push([[403],{4940:function(n,e,r){var t=r(7586),i=r(8646),s=r(6673),o=r(9986),a=r(3846),l=r(7378),c=r(427),u=r(7168),d=r.n(u),f=r(8124),p=r(8773);function h(n){return y.apply(this,arguments)}function y(){return y=(0,s.A)((0,i.A)().m(function n(e){var r;return(0,i.A)().w(function(n){while(1)switch(n.n){case 0:return n.n=1,p.Ay.post("/api/v1/tickets",e);case 1:return r=n.v,n.a(2,(0,p.Bm)(r))}},n)})),y.apply(this,arguments)}var m=r(6106),v={1:"\u5f85\u652f\u4ed8",2:"\u5df2\u4ed8\u6b3e",3:"\u914d\u9001\u4e2d",4:"\u5df2\u5b8c\u6210",5:"\u5df2\u53d6\u6d88"};function g(n){if("number"===typeof n)return n;if("string"===typeof n){var e=parseInt(n,10);return Number.isNaN(e)?void 0:e}}function x(n){if(void 0===n||null===n)return"--";var e="string"===typeof n?parseFloat(n):n;return Number.isNaN(e)?"--":e.toFixed(2)}function b(n){if(!n)return null;if("object"===(0,a.A)(n))return n;try{return JSON.parse(n)}catch(e){return{raw:n}}}function j(n){var e,r,t,a,p=n.id,y=(0,u.useRouter)(),j=null!==(e=null===y||void 0===y||null===(r=y.params)||void 0===r?void 0:r.id)&&void 0!==e?e:null===y||void 0===y||null===(t=y.params)||void 0===t?void 0:t.orderId,w=(0,l.useMemo)(function(){if("number"===typeof p&&!Number.isNaN(p))return p;var n=j?Number(j):NaN;return Number.isNaN(n)?void 0:n},[p,j]),k=(0,l.useState)(null),A=(0,o.A)(k,2),S=A[0],E=A[1],_=(0,l.useState)([]),Y=(0,o.A)(_,2),T=Y[0],N=Y[1],C=(0,l.useState)(!1),z=(0,o.A)(C,2),M=z[0],B=z[1],R=(0,l.useState)(null),I=(0,o.A)(R,2),W=I[0],$=I[1],F=(0,l.useState)(null),J=(0,o.A)(F,2),O=J[0],D=J[1],q=(0,l.useState)(""),H=(0,o.A)(q,2),P=H[0],U=H[1],V=(0,l.useState)(!1),G=(0,o.A)(V,2),K=G[0],L=G[1],Q=(0,l.useCallback)((0,s.A)((0,i.A)().m(function n(){var e,r,t;return(0,i.A)().w(function(n){while(1)switch(n.p=n.n){case 0:if(w){n.n=1;break}return n.a(2);case 1:return B(!0),n.p=2,n.n=3,(0,f.r$)(w);case 3:r=n.v,E(r.order),N(Array.isArray(r.items)?r.items:[]),D(b(null===(e=r.order)||void 0===e?void 0:e.address_info)),n.n=5;break;case 4:n.p=4,t=n.v,console.error("load order failed",t),d().showToast({title:(null===t||void 0===t?void 0:t.message)||"\u52a0\u8f7d\u8ba2\u5355\u5931\u8d25",icon:"none"});case 5:return n.p=5,B(!1),n.f(5);case 6:return n.a(2)}},n,null,[[2,4,5,6]])})),[w]);(0,l.useEffect)(function(){w&&Q()},[w,Q]);var X=(0,l.useMemo)(function(){return g(null===S||void 0===S?void 0:S.status)},[null===S||void 0===S?void 0:S.status]),Z=(0,l.useMemo)(function(){var n;return X?v[X]||String(null!==(n=null===S||void 0===S?void 0:S.status)&&void 0!==n?n:"--"):null!==S&&void 0!==S&&S.status?String(S.status):"--"},[X,null===S||void 0===S?void 0:S.status]),nn=(0,l.useMemo)(function(){if(!O)return"string"===typeof(null===S||void 0===S?void 0:S.address_info)&&S.address_info||"--";var n=[];return(O.contact||O.name)&&n.push(O.contact||O.name),O.phone&&n.push(O.phone),(O.full_address||O.detail||O.address)&&n.push(O.full_address||O.detail||O.address),!n.length&&O.raw&&n.push(O.raw),n.join(" / ")||"--"},[O,null===S||void 0===S?void 0:S.address_info]),en=1===X,rn=1===X,tn=3===X,sn=function(){var n=(0,s.A)((0,i.A)().m(function n(e,r,t){var s;return(0,i.A)().w(function(n){while(1)switch(n.p=n.n){case 0:if(w){n.n=1;break}return n.a(2);case 1:return $(e),n.p=2,n.n=3,r();case 3:return d().showToast({title:t,icon:"success"}),n.n=4,Q();case 4:n.n=6;break;case 5:n.p=5,s=n.v,console.error("".concat(e," order failed"),s),d().showToast({title:(null===s||void 0===s?void 0:s.message)||"\u64cd\u4f5c\u5931\u8d25",icon:"none"});case 6:return n.p=6,$(null),n.f(6);case 7:return n.a(2)}},n,null,[[2,5,6,7]])}));return function(e,r,t){return n.apply(this,arguments)}}(),on=function(){return sn("pay",function(){return(0,f.Tg)(w)},"\u652f\u4ed8\u6210\u529f")},an=function(){var n=(0,s.A)((0,i.A)().m(function n(){var e;return(0,i.A)().w(function(n){while(1)switch(n.n){case 0:return n.n=1,d().showModal({title:"\u53d6\u6d88\u8ba2\u5355",content:"\u786e\u8ba4\u8981\u53d6\u6d88\u8be5\u8ba2\u5355\u5417\uff1f"});case 1:if(e=n.v,e.confirm&&w){n.n=2;break}return n.a(2);case 2:return n.n=3,sn("cancel",function(){return(0,f.N4)(w,"\u7528\u6237\u53d6\u6d88")},"\u5df2\u53d6\u6d88");case 3:return n.a(2)}},n)}));return function(){return n.apply(this,arguments)}}(),ln=function(){var n=(0,s.A)((0,i.A)().m(function n(){var e;return(0,i.A)().w(function(n){while(1)switch(n.n){case 0:return n.n=1,d().showModal({title:"\u786e\u8ba4\u6536\u8d27",content:"\u8bf7\u786e\u8ba4\u5df2\u7ecf\u6536\u5230\u5546\u54c1\u5e76\u65e0\u552e\u540e\u95ee\u9898\u3002"});case 1:if(e=n.v,e.confirm&&w){n.n=2;break}return n.a(2);case 2:return n.n=3,sn("confirm",function(){return(0,f.Ad)(w)},"\u5df2\u786e\u8ba4");case 3:return n.a(2)}},n)}));return function(){return n.apply(this,arguments)}}(),cn=function(){var n=(0,s.A)((0,i.A)().m(function n(){var e;return(0,i.A)().w(function(n){while(1)switch(n.p=n.n){case 0:if(w){n.n=1;break}return n.a(2);case 1:if(P.trim()){n.n=2;break}return d().showToast({title:"\u8bf7\u5148\u586b\u5199\u6295\u8bc9\u5185\u5bb9",icon:"none"}),n.a(2);case 2:return L(!0),n.p=3,n.n=4,h({type:"order",source:"miniapp_order",order_id:w,title:"\u8ba2\u5355\u6295\u8bc9 ".concat((null===S||void 0===S?void 0:S.order_no)||"").trim(),content:P.trim()});case 4:d().showToast({title:"\u6295\u8bc9\u5df2\u63d0\u4ea4\uff0c\u6211\u4eec\u4f1a\u5c3d\u5feb\u5904\u7406",icon:"none"}),U(""),n.n=6;break;case 5:n.p=5,e=n.v,console.error("create complaint ticket failed",e),d().showToast({title:(null===e||void 0===e?void 0:e.message)||"\u63d0\u4ea4\u5931\u8d25\uff0c\u8bf7\u7a0d\u540e\u518d\u8bd5",icon:"none"});case 6:return n.p=6,L(!1),n.f(6);case 7:return n.a(2)}},n,null,[[3,5,6,7]])}));return function(){return n.apply(this,arguments)}}();return w?M&&!S?(0,m.jsx)(c.Ss,{style:{padding:16},children:(0,m.jsx)(c.EY,{children:"\u8ba2\u5355\u52a0\u8f7d\u4e2d..."})}):S?(0,m.jsxs)(c.Ss,{style:{padding:16},children:[(0,m.jsxs)(c.Ss,{style:{marginBottom:16},children:[(0,m.jsx)(c.EY,{style:{fontSize:16,fontWeight:"bold"},children:Z}),(0,m.jsxs)(c.EY,{style:{display:"block",marginTop:8},children:["\u8ba2\u5355\u53f7\uff1a",S.order_no]}),(0,m.jsxs)(c.EY,{style:{display:"block",marginTop:4},children:["\u4e0b\u5355\u65f6\u95f4\uff1a",null!==(a=S.created_at)&&void 0!==a?a:"--"]})]}),(0,m.jsxs)(c.Ss,{style:{padding:12,backgroundColor:"#f7f7f7",borderRadius:8,marginBottom:16},children:[(0,m.jsx)(c.EY,{style:{fontWeight:"bold"},children:"\u6536\u8d27\u4fe1\u606f"}),(0,m.jsx)(c.EY,{style:{display:"block",marginTop:6},children:nn}),(0,m.jsxs)(c.EY,{style:{display:"block",marginTop:4},children:["\u914d\u9001\u65b9\u5f0f\uff1a",2===S.delivery_type?"\u914d\u9001":"\u5230\u5e97\u81ea\u53d6"]})]}),(0,m.jsxs)(c.Ss,{style:{marginBottom:16},children:[(0,m.jsx)(c.EY,{style:{fontWeight:"bold"},children:"\u5546\u54c1\u4fe1\u606f"}),T.map(function(n){return(0,m.jsxs)(c.Ss,{style:{marginTop:12,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",gap:12},children:[n.image?(0,m.jsx)(c._V,{src:n.image,style:{width:60,height:60,borderRadius:4},mode:"aspectFill"}):(0,m.jsx)(c.Ss,{style:{width:60,height:60,backgroundColor:"#f2f2f2",borderRadius:4}}),(0,m.jsxs)(c.Ss,{style:{flex:1},children:[(0,m.jsx)(c.EY,{style:{display:"block"},children:n.product_name||"\u5546\u54c1#".concat(n.product_id)}),n.sku_name&&(0,m.jsxs)(c.EY,{style:{display:"block",color:"#999",fontSize:12},children:["\u89c4\u683c\uff1a",n.sku_name]})]}),(0,m.jsxs)(c.Ss,{style:{alignItems:"flex-end",display:"flex",flexDirection:"column"},children:[(0,m.jsxs)(c.EY,{children:["\uffe5",x(n.price||n.amount)]}),(0,m.jsxs)(c.EY,{style:{color:"#666",fontSize:12},children:["x",n.quantity]})]})]},n.id)}),!T.length&&(0,m.jsx)(c.EY,{style:{display:"block",marginTop:8},children:"\u6682\u65e0\u5546\u54c1\u4fe1\u606f"})]}),(0,m.jsxs)(c.Ss,{style:{padding:12,backgroundColor:"#f7f7f7",borderRadius:8,marginBottom:16},children:[(0,m.jsxs)(c.EY,{style:{display:"block"},children:["\u5546\u54c1\u91d1\u989d\uff1a\uffe5",x(S.total_amount)]}),(0,m.jsxs)(c.EY,{style:{display:"block",marginTop:4},children:["\u4f18\u60e0\uff1a-\uffe5",x(S.discount_amount)]}),(0,m.jsxs)(c.EY,{style:{display:"block",marginTop:4},children:["\u914d\u9001\u8d39\uff1a\uffe5",x(S.delivery_fee)]}),(0,m.jsxs)(c.EY,{style:{display:"block",marginTop:8,fontSize:16,fontWeight:"bold"},children:["\u5b9e\u4ed8\u91d1\u989d\uff1a\uffe5",x(S.pay_amount)]})]}),(0,m.jsxs)(c.Ss,{style:{display:"flex",justifyContent:"flex-end",gap:12},children:[rn&&(0,m.jsx)(c.$n,{size:"mini",loading:"cancel"===W,onClick:an,type:"warn",children:"\u53d6\u6d88\u8ba2\u5355"}),en&&(0,m.jsx)(c.$n,{size:"mini",loading:"pay"===W,onClick:on,type:"primary",children:"\u7acb\u5373\u652f\u4ed8"}),tn&&(0,m.jsx)(c.$n,{size:"mini",loading:"confirm"===W,onClick:ln,type:"primary",children:"\u786e\u8ba4\u6536\u8d27"})]}),(0,m.jsxs)(c.Ss,{style:{marginTop:20},children:[(0,m.jsx)(c.EY,{style:{fontWeight:"bold",display:"block",marginBottom:8},children:"\u8ba2\u5355\u6709\u95ee\u9898\uff1f\u63d0\u4ea4\u6295\u8bc9"}),(0,m.jsx)(c.TM,{style:{minHeight:100,padding:8,borderRadius:8,border:"1px solid #ddd"},placeholder:"\u8bf7\u7b80\u5355\u63cf\u8ff0\u60a8\u9047\u5230\u7684\u95ee\u9898\uff0c\u6211\u4eec\u4f1a\u5b89\u6392\u5ba2\u670d\u8ddf\u8fdb",value:P,onInput:function(n){return U(n.detail.value)}}),(0,m.jsx)(c.$n,{style:{marginTop:12},size:"mini",type:"warn",loading:K,disabled:K,onClick:cn,children:"\u63d0\u4ea4\u6295\u8bc9"})]})]}):(0,m.jsx)(c.Ss,{style:{padding:16},children:(0,m.jsx)(c.EY,{children:"\u672a\u627e\u5230\u8ba2\u5355\u4fe1\u606f"})}):(0,m.jsx)(c.Ss,{style:{padding:16},children:(0,m.jsx)(c.EY,{children:"\u672a\u83b7\u53d6\u5230\u6709\u6548\u7684\u8ba2\u5355\u7f16\u53f7"})})}var w={},k=(0,t.eU)(j,"pages/order-detail/index",{root:{cn:[]}},w||{});j&&j.behaviors&&(k.behaviors=(k.behaviors||[]).concat(j.behaviors));Page(k)}},function(n){var e=function(e){return n(n.s=e)};n.O(0,[907,96,76],function(){return e(4940)});n.O()}]);