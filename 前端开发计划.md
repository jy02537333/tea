
**前端开发计划（admin-fe + wx-fe）

**概述**
- **目标**：实现两套前端应用：`admin-fe`（管理后台）与 `wx-fe`（面向微信用户的小程序或跨端实现），通过 `tea-api` 提供的 REST 接口完成用户管理、商品/门店管理、订单与购物流程、报表与权限管理等功能。
- **鉴权**：后端使用 JWT Bearer（测试中出现 `Authorization: Bearer <token>`）。

**技术栈建议**
- **admin-fe**：React 18 + Vite、TypeScript、Ant Design（或 Ant Design Pro）、axios、React Query（或 Redux Toolkit）
- **wx-fe**：Taro（React 语法）或 uni-app（Vue 语法），UI 使用 Vant / WeUI，统一封装请求层
 - **wx-fe 已选方案**：**Taro（React 语法）**（示例页面已按 Taro 组件风格实现）。示例页面与 services 已改为使用具体的 TypeScript 类型（`Product` / `Order`），便于在 Taro/H5/小程序多端复用。
- **工具**：ESLint、Prettier、Vitest/Jest、Storybook（可选）、CI（lint + test）

**从 `tea-api` 已识别的重要接口（待后端确认完整契约）**
- `POST /api/v1/user/dev-login`：登录（测试中用于 admin/user 的 dev-login）
- `GET /api/v1/admin/accrual/summary`：计提汇总（Dashboard）
- `POST /api/v1/admin/accrual/run`：触发计提
- `GET /api/v1/admin/accrual/export`：导出报表
- `GET /api/v1/admin/users`：用户列表
- `GET /api/v1/admin/rbac/user-permissions?user_id=`：查询用户权限
- `POST /api/v1/admin/rbac/role/assign-permissions`：角色分配权限
- `POST /api/v1/stores`：创建门店（测试中出现）
- `POST /api/v1/categories`：创建分类
- `POST /api/v1/products`：创建商品
- `POST /api/v1/cart/items`：加入购物车
- `POST /api/v1/orders/from-cart`：从购物车创建订单

（备注：测试用例中暗示存在 `GET /api/v1/products`、`GET /api/v1/stores`、订单查询等接口，请补充或由我继续解析 `tea-api` 源码以生成完整映射）

**Admin-fe 页面清单与接口映射（建议）**
- **登录页** `#/login`
	- API：`POST /api/v1/user/dev-login`
	- 要点：表单校验、错误提示、token 保存到 `localStorage`、全局 axios 拦截器。
- **仪表盘** `#/dashboard`
	- API：`GET /api/v1/admin/accrual/summary`（可能有更多汇总接口）
	- 组件：汇总卡片、图表（ECharts / AntD Charts）、最近任务。
- **计提/报表** `#/accrual`
	- 查看：`GET /api/v1/admin/accrual/summary`
	- 触发：`POST /api/v1/admin/accrual/run`
	- 导出：`GET /api/v1/admin/accrual/export`
- **用户管理** `#/users`
	- 列表：`GET /api/v1/admin/users`
	- 详情/编辑：依据后端提供的详情/更新接口
- **RBAC 管理** `#/rbac`
	- 查看权限：`GET /api/v1/admin/rbac/user-permissions?user_id=`
	- 分配权限：`POST /api/v1/admin/rbac/role/assign-permissions`
	- 组件：权限树、角色 CRUD、用户角色分配 Modal
- **商品管理** `#/products`
	- 列表：`GET /api/v1/products`（若有）
	- 新建：`POST /api/v1/products`
	- 编辑/上下架：对应 PUT/PATCH（需确认）
- **分类管理** `#/categories`
	- 新建：`POST /api/v1/categories`
	- 列表/编辑：依据后端接口
- **门店管理** `#/stores`
	- 新建：`POST /api/v1/stores`
	- 列表/编辑：依据后端接口
- **订单管理** `#/orders`
	- 列表、详情、状态变更：映射到后端 order API（需补充）

**Wx-fe（微信端）页面清单与接口映射（建议）**
- **首页 / 门店 / 推荐** `pages/index`
	- API：`GET /api/v1/stores`、`GET /api/v1/products`
- **分类 / 商品列表** `pages/category`、`pages/products`
	- API：`GET /api/v1/categories`、`GET /api/v1/products?category_id=`
- **商品详情** `pages/product/[id]`
	- API：`GET /api/v1/products/:id`
	- 添加购物车：`POST /api/v1/cart/items`
- **购物车** `pages/cart`
	- 读取/修改/删除：对应 `cart` 相关接口（需确认）
- **下单 / 结算** `pages/checkout`
	- API：`POST /api/v1/orders/from-cart`
- **我的 / 订单列表** `pages/profile`、`pages/orders`
	- API：用户订单列表/详情（需补充）
- **登录/授权** `pages/login`
	- API：`POST /api/v1/user/dev-login` 或后端提供的微信 code 换 token 接口

**前端代码约定与 API 使用规范**
- axios 封装：`baseURL` 从环境变量读取（`VITE_API_BASE_URL` / `WX_API_BASE_URL`），请求拦截器注入 `Authorization`，响应拦截器统一错误处理（401 跳转登录）
- 错误提示：统一使用 Toast / Message，表单显示字段级错误
- 分页/筛选约定：与后端确认分页参数名（page/size 或 pageNum/pageSize）

**项目目录建议（骨架）**
- `admin-fe/`
	- `src/pages/`：Dashboard, Users, RBAC, Products, Categories, Stores, Orders, Login
	- `src/components/`：DataTable, CrudForm, PermissionTree, Uploader
	- `src/services/`：`api.ts`, `auth.ts`, `products.ts`, `orders.ts`
- `wx-fe/`（Taro/uni-app）
	- `src/pages/`：index, category, product, cart, checkout, profile, login
	- `src/components/`：ProductCard, HeaderBar, CartBadge
	- `src/services/`：`api.js`, `auth.js`

**里程碑与估算（示例）**
- 准备（2 天）：确认 API 列表、技术栈、脚手架初始化
- admin-fe 骨架与登录（3-5 天）：登录、布局、axios、仪表盘占位
- 后台核心页面（7-10 天）：Users、RBAC、Products、Categories、Stores、报表
- wx-fe 核心购物流程（7-10 天）：首页、分类、详情、购物车、结算、订单
- 联调/测试/部署（3-5 天）：E2E、修复、部署脚本与文档
- 粗略总计：4-5 周（2 人并行，视 API 完整性与需求变动）

**最终里程碑与估算（确认版）**
- Sprint 0（准备，2 天）: 初始化 `admin-fe` 与 `wx-fe` 项目骨架，完成 `services/api.ts` 模板、全局 axios 拦截器（Auth token）、以及若干核心 domain types；设置基本的 lint/tsconfig 与 mock 支持（MSW 初始配置）。
- Sprint 1（admin 基本，1.5 周 / 7 个工作日）: 完成登录（A1）、仪表盘（A2）、用户管理（A3）与商品列表（A6 的列表/筛选部分）基础页面与服务，对接后端常用接口，保证关键流程能在本地联调。 
- Sprint 2（admin 完整，1.5 周 / 7 个工作日）: 完成 RBAC（A4）、商品管理（A6 的编辑/新建/库存）、门店管理（A7）与管理端订单（A8）。增加导出/报表功能与后台管理操作。
- Sprint 3（wx 基本，1.5 周 / 7 个工作日）: 实现 wx-fe 首页（W1）、分类/商品列表（W2）、商品详情（W3）与购物车（W4），完成基本下单流程的前端集成。
- Sprint 4（wx 完整 + 联调，1.5 周 / 7 个工作日）: 完成结算/下单（W5）、我的/订单（W6）、优惠券（W7）与门店选择（W8），并进行端到端联调与修复。

交付物与里程碑验收点：
- Sprint 0 完成：`admin-fe` 与 `wx-fe` 仓库骨架、`services` 模板、`auth` 基本拦截器、以及至少两个示例页面（ProductList / OrderDetail）。
- Sprint 1 完成：登录与仪表盘可本地联调；用户与商品基础 CRUD 能正确调用后端并在 UI 显示。
- Sprint 2 完成：RBAC 与门店、订单管理功能可用，导出与计提功能能在 admin 环境触发。
- Sprint 3/4 完成：wx 小程序购物到下单流程完整，用户能查看订单并进行常见操作；联调通过并修复核心缺陷。

注：以上时间为两人并行开发的估算。若只有一人开发，则大致乘以 1.6-1.8 倍；如需要更精确的任务分解与人日估算，我可以把 `tasks/frontend_tasks.md` 中每个卡片拆成更细的子任务并生成 GitHub Issue 模板。

**质量、测试与部署建议**
- 单元测试与接口 mock（Vitest / Jest）
- 集成测试：关键流程（登录、下单、导出）
- E2E：Playwright / Cypress（购物与管理关键流程）
- CI：PR 触发 lint + 单测，主分支触发构建与预发部署

**未决与需确认项**
- 是否使用 Ant Design Pro 作为 `admin-fe` 基础模版？
- `wx-fe` 是否需要同时提供 H5（决定 Taro/uni-app）？
- 请提供完整 API 文档或允许我继续解析 `tea-api` 源码生成完整映射表

**下一步建议（选一）**
- 选项 A：生成 `admin-fe` 与 `wx-fe` 项目骨架并提交示例页面（包含 axios 封装与示例 API 调用）
- 选项 B：继续深度解析 `tea-api` 并生成“端点 -> 前端页面 / 参数 / 示例请求 / 响应”完整映射表（推荐）
- 选项 C：你先确认技术栈与 UI 库，我据此生成更精确的任务分配与时间表

---
文件已由开发计划自动生成。如需我直接 scaffold 项目或继续解析 `tea-api`，请选择上面的某一项，我会立即开始。


**API 映射表（端点 -> 前端页面 / 示例请求 / 示例响应）**

说明：下表基于 `tea-api/internal/router/router.go` 与各 handler 的实现生成。示例请求/响应为简化示例，前端按需在请求中携带 `Authorization: Bearer <token>`（需要登录的接口）。

- 用户 / 登陆
	- POST `/api/v1/user/login`
		- 用途（wx-fe 登录）：使用微信 code、用户名/密码或 openid 流程登录
		- 请求示例：{ "code": "wx_code_abc" }
		- 响应示例：{ "token": "<jwt>", "user": { "id":123, "nickname":"小茶" } }
	- POST `/api/v1/user/dev-login` (dev only)
		- 用途（admin-fe 开发登录或测试）：通过 openid 直接登录（仅 dev/local）
		- 请求示例：{ "openid": "dev-openid-123" }
		- 响应示例：{ "token": "<jwt>", "user": {...} }
	- GET `/api/v1/user/info`
		- 用途（wx-fe 我的页 / admin-fe 用户详情）：获取当前登录用户信息
		- 请求头：`Authorization: Bearer <token>`
		- 响应示例：{ "id":123, "nickname":"小茶", "avatar":"..." }
	- POST `/api/v1/user/password`
		- 用途：修改密码（需登录）
		- 请求示例：{ "old_password":"old","new_password":"new" }

- 商品与分类
	- POST `/api/v1/categories` (需登录)
		- 用途（admin-fe 分类管理 - 新建）
		- 请求示例：{ "name":"饮品", "description":"茶类", "sort":10 }
		- 响应：新建分类对象
	- GET `/api/v1/categories`
		- 用途（wx-fe 分类列表 / admin-fe 列表）
		- 查询参数：`parent_id`, `status`
		- 响应示例：[{ "id":1, "name":"饮品" }, ...]
	- POST `/api/v1/products` (需登录)
		- 用途（admin-fe 新建商品）
		- 请求示例：{
				"name":"茉莉绿茶",
				"category_id":1,
				"price":"12.50",
				"original_price":"15.00",
				"images":"/imgs/1.jpg",
				"stock":100
			}
		- 响应：创建的商品对象（含 id）
	- GET `/api/v1/products` 
		- 用途（wx-fe 商品列表 / admin-fe 列表）
		- 查询参数：`page`, `limit`, `category_id`, `status`, `keyword`, `store_id`
		- 响应：{ "data": [...], "total": 123, "page":1, "limit":20 }
	- GET `/api/v1/products/:id`
		- 用途（wx-fe 商品详情）
		- 可选查询：`store_id`（若传入，返回门店库存覆盖价）
		- 响应：商品详情对象
	- PUT `/api/v1/products/:id` (需登录)
		- 用途（admin-fe 编辑商品）
		- 请求示例：{ "name":"新名", "price":13.0 }

- 购物车（需登录）
	- GET `/api/v1/cart`：获取当前用户购物车条目
		- 响应示例：[{ "id":1, "product_id":10, "quantity":2, "sku_id":0 }, ...]
	- POST `/api/v1/cart/items`：加入购物车
		- 请求示例：{ "product_id": 10, "sku_id": 0, "quantity": 1 }
		- 响应示例：新加的购物车条目
	- PUT `/api/v1/cart/items/:id`：更新数量
		- 请求示例：{ "quantity": 3 }
	- DELETE `/api/v1/cart/items/:id`：删除条目
	- DELETE `/api/v1/cart/clear`：清空购物车

- 订单（需登录）
	- POST `/api/v1/orders/from-cart`
		- 用途（wx-fe 下单）
		- 请求示例: { "delivery_type":2, "address_info":"街道...", "remark":"无糖", "store_id":1 }
		- 响应示例: { "id": 1001, "order_no":"ORD-20251124-0001", "pay_amount":50.0 }
	- GET `/api/v1/orders`：用户订单列表
		- 查询参数：`page`, `limit`, `status`, `store_id`
		- 响应：分页订单数据
	- GET `/api/v1/orders/:id`：订单详情（返回 order + items）
	- POST `/api/v1/orders/:id/cancel`：取消订单（可附带 reason）
	- POST `/api/v1/orders/:id/pay`：模拟支付（标记已支付）
	- POST `/api/v1/orders/:id/receive`：确认收货

- 管理端订单（admin-fe, 需 admin）
	- GET `/api/v1/admin/orders`：管理端订单列表（分页）
	- GET `/api/v1/admin/orders/export`：导出 CSV（返回 attachment）
	- GET `/api/v1/admin/orders/:id`：管理端查看任意订单详情
	- 额外管理操作（需对应权限）：deliver/complete/admin-cancel/refund 等，均为 POST `/api/v1/orders/:id/<action>`

- 计息 / 报表（管理员或有权限角色）
	- POST `/api/v1/admin/accrual/run`：触发计息
		- 请求示例：{ "date":"2025-11-12", "rate": 0.001 }
		- 响应：{ "updated": 123 }
	- GET `/api/v1/admin/accrual/summary`：计息汇总
		- 查询参数：`start`, `end`
		- 响应：{ "record_count":10, "user_count":3, "total_interest":"12.34" }
	- GET `/api/v1/admin/accrual/export`：导出（csv/xlsx/zip，支持 `fields`, `lang`, `zip` 等参数）

- RBAC / 权限管理（admin-fe）
	- GET `/api/v1/admin/rbac/roles`：获取角色列表
	- GET `/api/v1/admin/rbac/permissions`：获取权限列表
	- GET `/api/v1/admin/rbac/role-permissions?role_id=...`：某角色权限
	- GET `/api/v1/admin/rbac/user-permissions?user_id=...`：某用户权限（用于前端按钮/路由控制）
	- POST `/api/v1/admin/rbac/role`：创建角色 { "name":"auditor", "display_name":"审计员" }
	- POST `/api/v1/admin/rbac/role/assign-permissions`：{ "role_id":1, "permission_ids":[1,2,3] }
	- POST `/api/v1/admin/rbac/user/assign-role`：{ "user_id":123, "role_id":2 }

- 门店管理
	- GET `/api/v1/stores`：门店列表（支持分页、lat/lng 附近过滤）
	- GET `/api/v1/stores/:id`：门店详情
	- POST `/api/v1/stores` (需登录)：创建门店
	- PUT `/api/v1/stores/:id` (需登录)：更新
	- DELETE `/api/v1/stores/:id` (需登录)：删除
	- GET `/api/v1/admin/stores/:id/orders/stats`（管理员）: 门店订单统计

- 操作日志 / 导出（admin-fe）
	- GET `/api/v1/admin/logs/operations`：操作日志分页
	- GET `/api/v1/admin/logs/operations/export`：导出
	- GET `/api/v1/admin/logs/access`：访问日志

- 优惠券（部分公开/需登录）
	- GET `/api/v1/coupons`：可用优惠券列表
	- POST `/api/v1/coupons` (需登录)：创建优惠券
	- POST `/api/v1/coupons/grant` (需登录)：发放
	- GET `/api/v1/user/coupons` (需登录)：当前用户优惠券

- 支付模拟
	- POST `/api/v1/payment/intents` (需登录)：创建支付 intent
	- POST `/api/v1/payment/mock-callback`：开发环境模拟回调

---
快速使用建议：
- 在前端 `services/api.ts` 中为每类资源创建封装函数（例如 `products.ts`, `orders.ts`, `auth.ts`），并统一使用 axios 实例处理 baseURL 与拦截器。
- 分页参数默认采用 `page`/`limit`，导出接口返回文件流，前端需使用 `responseType: 'blob'` 下载。
- 需要我把上表转为 CSV 或单独的 `前端_api映射.md` 文件并按页面导出示例请求代码吗？
